<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-99.9.9">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jacob Louis Hoover">
<meta name="dcterms.date" content="2023-05-15">
<meta name="description" content="For The plausibility of sampling as an algorithmic theory of sentence processing, Open Mind, 2023">

<title>Plots</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="make_figures_files/libs/clipboard/clipboard.min.js"></script>
<script src="make_figures_files/libs/quarto-html/quarto.js"></script>
<script src="make_figures_files/libs/quarto-html/popper.min.js"></script>
<script src="make_figures_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="make_figures_files/libs/quarto-html/anchor.min.js"></script>
<link href="make_figures_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="make_figures_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="make_figures_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="make_figures_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="make_figures_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#gam-plots" id="toc-gam-plots" class="nav-link active" data-scroll-target="#gam-plots">GAM plots</a>
  <ul class="collapse">
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#gam-smooths" id="toc-gam-smooths" class="nav-link" data-scroll-target="#gam-smooths">GAM smooths</a>
  <ul class="collapse">
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data">Load data</a></li>
  <li><a href="#plot-smooths" id="toc-plot-smooths" class="nav-link" data-scroll-target="#plot-smooths">Plot smooths</a></li>
  </ul></li>
  <li><a href="#superlinearity" id="toc-superlinearity" class="nav-link" data-scroll-target="#superlinearity">Superlinearity</a>
  <ul class="collapse">
  <li><a href="#superlinearity-vs-perplexity" id="toc-superlinearity-vs-perplexity" class="nav-link" data-scroll-target="#superlinearity-vs-perplexity">Superlinearity vs perplexity</a></li>
  </ul></li>
  <li><a href="#linear-model-coefficients" id="toc-linear-model-coefficients" class="nav-link" data-scroll-target="#linear-model-coefficients">Linear model coefficients</a></li>
  <li><a href="#autocorrelation-plots" id="toc-autocorrelation-plots" class="nav-link" data-scroll-target="#autocorrelation-plots">Autocorrelation plots</a></li>
  </ul></li>
  <li><a href="#schematic-diagram" id="toc-schematic-diagram" class="nav-link" data-scroll-target="#schematic-diagram">Schematic diagram</a>
  <ul class="collapse">
  <li><a href="#fit-gams" id="toc-fit-gams" class="nav-link" data-scroll-target="#fit-gams">Fit GAMs</a></li>
  <li><a href="#plot" id="toc-plot" class="nav-link" data-scroll-target="#plot">Plot</a></li>
  </ul></li>
  <li><a href="#sampling-analysis" id="toc-sampling-analysis" class="nav-link" data-scroll-target="#sampling-analysis">Sampling analysis</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="make_figures.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Plots</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>

<div>
  <div class="description">
    For <em>The plausibility of sampling as an algorithmic theory of sentence processing</em>, Open Mind, 2023
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jacob Louis Hoover </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 15, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="gam-plots" class="level1">
<h1>GAM plots</h1>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Dependencies
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ul>
<li><p>external dependencies (R files, will be sourced)</p>
<pre><code>./utils/prepare_data.R
./utils/my_pacf_plot.R</code></pre></li>
<li><p>data files</p>
<pre><code>./data/surprisal_densities.csv
./data/surprisal_means.csv
./data/GAM_predictions/data_to_plot_NEW_var0_gauss_wprev_N200.csv
./data/GAM_predictions/data_to_plot_NEW_var0_gauss_w3prev_N200.csv
./data/GAM_predictions/data_to_plot_NEW_lin0var_wprev_N200.csv
./data/GAM_predictions/data_to_plot_NEW_linear_wprevm_N200.csv
./data/GAM_predictions/data_to_plot_NEW_wprevm_N200.csv
./data/GAM_predictions/data_to_plot_NEW_datasubsetless6_wprevm_N200.csv
./data/GAM_predictions/data_to_plot_NEW_datasubsetless12_wprevm_N200.csv
./data/model-summaries-NEW-linear-wprevm.rds</code></pre></li>
<li><p>model training data</p>
<pre><code>./data/surps_lms.RTs.perword.rds
./data/surps_lms.RTs.rds</code></pre></li>
<li><p>model file</p>
<pre><code>./data/GAM_models/GPT3-davinci.rds</code></pre></li>
</ul>
</div>
</div>
</div>
<div class="cell">
<details open="">
<summary>options</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Where data lives (plot data from GAM fits, etc)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>datadir <span class="ot">&lt;-</span> <span class="st">"./data/"</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Where to put generated plots</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>figsdir <span class="ot">&lt;-</span> <span class="st">"./figures/"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<div class="cell">
<details>
<summary>Setup</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>())</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_update</span>(<span class="at">plot.title.position =</span> <span class="st">"plot"</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Names</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>context_len_labs <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">max =</span> <span class="st">"maximum"</span>,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">80</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"80 words"</span>,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">bysent =</span> <span class="st">"within sent."</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>est_type_labs <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> <span class="st">"mean"</span>,</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> <span class="st">"variance"</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>term_labs <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">surprisal =</span> <span class="st">"surprisal (on mean)"</span>,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">surprisal.1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"surprisal (on log sd)"</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>model_labs <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">boyce_ngram =</span> <span class="st">"n-gram"</span>,</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">boyce_grnn =</span> <span class="st">"LSTM"</span>,</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TXL"</span> <span class="ot">=</span> <span class="st">"TXL"</span>,</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT2"</span> <span class="ot">=</span> <span class="st">"GPT2"</span>,</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT2-large"</span> <span class="ot">=</span> <span class="st">"GPT2-large"</span>,</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT2-xl"</span> <span class="ot">=</span> <span class="st">"GPT2-xl"</span>,</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT-Neo"</span> <span class="ot">=</span> <span class="st">"GPT-Neo"</span>,</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT-J"</span> <span class="ot">=</span> <span class="st">"GPT-J"</span>,</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT3-ada"</span> <span class="ot">=</span> <span class="st">"GPT3-ada"</span>,</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT3-curie"</span> <span class="ot">=</span> <span class="st">"GPT3-curie"</span>,</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT3-davinci"</span> <span class="ot">=</span> <span class="st">"GPT3-davinci"</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>lm_names <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  <span class="st">"boyce_ngram"</span>, <span class="st">"boyce_grnn"</span>,</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TXL"</span>,</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT2"</span>,</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT2-large"</span>,</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT2-xl"</span>,</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT-Neo"</span>,</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT-J"</span>,</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT3-ada"</span>,</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT3-curie"</span>,</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT3-davinci"</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">set_names</span>(., .)</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a><span class="do">## Utils</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>separate_modelnames <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">modelnames_colname =</span> model, <span class="at">names =</span> lm_names) {</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">separate</span>({{modelnames_colname}},</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>             <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"model"</span>, <span class="st">"by"</span>), <span class="at">sep =</span> <span class="st">"_"</span>, <span class="at">extra =</span> <span class="st">"merge"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">ifelse</span>(model <span class="sc">==</span> <span class="st">"boyce"</span>, <span class="fu">paste0</span>(<span class="st">"boyce_"</span>, by), model)) <span class="sc">%&gt;%</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">context_len =</span> <span class="fu">ifelse</span>(</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(by), <span class="st">"max"</span>, <span class="fu">ifelse</span>(stringr<span class="sc">::</span><span class="fu">str_starts</span>(model, <span class="st">"boyce"</span>), <span class="st">"bysent"</span>, by))</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>by) <span class="sc">%&gt;%</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">context_len =</span> forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(context_len, <span class="fu">c</span>(<span class="st">"max"</span>)),</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>           <span class="at">model =</span> forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(model, lm_names))</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a><span class="co"># for nicer plot labels</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>my_labeller <span class="ot">&lt;-</span> <span class="fu">labeller</span>(</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">context_len =</span> context_len_labs,</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">term =</span> term_labs,</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> model_labs,</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>  <span class="at">est_type=</span><span class="fu">c</span>(<span class="at">mean=</span><span class="st">"mean RT"</span>, <span class="at">var=</span>glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"log(sd RT)"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Options#|</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Whether to only plot two context lengths or all three</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>twocontexts <span class="ot">&lt;-</span> <span class="cn">TRUE</span> <span class="co"># (re-run notebook after modifying)</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (twocontexts) {</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  context_lens <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"max"</span>, <span class="st">"bysent"</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  context_pref <span class="ot">&lt;-</span> <span class="st">"2"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  context_lens <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"max"</span>, <span class="st">"80"</span>, <span class="st">"bysent"</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  context_pref <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="gam-smooths" class="level2">
<h2 class="anchored" data-anchor-id="gam-smooths">GAM smooths</h2>
<p>Plotting the fits of GAM smooths for effect of surprisal on mean and variance in RT.</p>
<section id="load-data" class="level3">
<h3 class="anchored" data-anchor-id="load-data">Load data</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>load_in_data<span class="ot">&lt;-</span> <span class="cf">function</span>(f, <span class="at">with_est_types =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(f,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_names =</span> <span class="cn">TRUE</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">context_len =</span> forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(context_len, <span class="fu">c</span>(<span class="st">"max"</span>)),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">model =</span> forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(model, lm_names))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (with_est_types) d <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">est_type =</span> <span class="fu">factor</span>(est_type))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(d)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># get surprisal means and densities </span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># (from natural-stories-surprisals/EDA_surps_SPRT.Rmd)</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>surprisal_densities <span class="ot">&lt;-</span> <span class="fu">load_in_data</span>(</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"surprisal_densities.csv"</span>), <span class="at">with_est_types =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># there is some odd point at ~37 this makes an unnecessarily long tail</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> lm_names, surprisal <span class="sc">&lt;</span> <span class="dv">25</span>) </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>surprisal_means <span class="ot">&lt;-</span> <span class="fu">load_in_data</span>(</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"surprisal_means.csv"</span>), <span class="at">with_est_types =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> lm_names)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>models_in_desc_PPL_order <span class="ot">&lt;-</span> surprisal_means <span class="sc">%&gt;%</span> </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(context_len <span class="sc">==</span> <span class="st">"max"</span> <span class="sc">|</span> model <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_starts</span>(<span class="st">"boyce"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_surprisal)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(model) <span class="sc">%&gt;%</span> as.vector</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co"># GAMs fit for paper (using fitdata=surps_lms.RTs.rds, and correct lagging)</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="co"># smooth0var: nonlinear gaussian models with constant variance</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>data_to_plot_var0_gauss_wprev <span class="ot">&lt;-</span> <span class="fu">load_in_data</span>(</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"GAM_predictions/data_to_plot_NEW_var0_gauss_wprev_N200.csv"</span>))</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>data_to_plot_var0_gauss_w3prev <span class="ot">&lt;-</span> <span class="fu">load_in_data</span>(</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"GAM_predictions/data_to_plot_NEW_var0_gauss_w3prev_N200.csv"</span>))</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="do">##### Linear control with constant variance, with previous, with family=gaulss()</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>data_to_plot_lin0var_wprev <span class="ot">&lt;-</span> <span class="fu">load_in_data</span>(</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"GAM_predictions/data_to_plot_NEW_lin0var_wprev_N200.csv"</span>))</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="do">##### Linear control with constant variance, with previous, with family=gaulss()</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>data_to_plot_linear_wprevm <span class="ot">&lt;-</span> <span class="fu">load_in_data</span>(</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"GAM_predictions/data_to_plot_NEW_linear_wprevm_N200.csv"</span>))</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="do">##### Main models: Smooth GAMs with previous surprisal predictors for mean only</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>data_to_plot_smooth_wprevm <span class="ot">&lt;-</span> <span class="fu">load_in_data</span>(</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"GAM_predictions/data_to_plot_NEW_wprevm_N200.csv"</span>))</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="do">#### As above (Smooth GAMs with previous surprisal for mean), </span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="do">#### but removing most surprising items</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Note, only for GPT-3 Davinci full-context.</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>data_to_plot_datasubsetless6_smooth_wprevm  <span class="ot">&lt;-</span> <span class="fu">load_in_data</span>(</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"GAM_predictions/data_to_plot_NEW_datasubsetless6_wprevm_N200.csv"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cutoff =</span> <span class="dv">6</span>)</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>data_to_plot_datasubsetless12_smooth_wprevm <span class="ot">&lt;-</span> <span class="fu">load_in_data</span>(</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"GAM_predictions/data_to_plot_NEW_datasubsetless12_wprevm_N200.csv"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cutoff =</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="plot-smooths" class="level3">
<h3 class="anchored" data-anchor-id="plot-smooths">Plot smooths</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    data_to_plot, <span class="at">use_shifted_est=</span><span class="cn">TRUE</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">se.mult=</span><span class="fl">1.96</span>, <span class="co"># use approx qnorm(1 - 0.05/2)</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">trans =</span> I, <span class="co">#transform function to apply to the yvalues</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">controls =</span> <span class="cn">NULL</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">surp_units =</span> <span class="st">"nats"</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">density_df =</span> surprisal_densities,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">static_lty =</span> <span class="cn">NULL</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">additional_controls =</span> <span class="cn">NULL</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">"fitted effect</span><span class="sc">\n</span><span class="st">estimate (+ intercept) ±2*SE"</span>,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    ...) {</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (surp_units <span class="sc">==</span> <span class="st">"bits"</span>) {</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    data_to_plot <span class="ot">&lt;-</span> data_to_plot <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">surprisal =</span> surprisal <span class="sc">/</span> <span class="fu">log</span>(<span class="dv">2</span>))</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(controls)) {</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>      controls <span class="ot">&lt;-</span> controls <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">surprisal =</span> surprisal <span class="sc">/</span> <span class="fu">log</span>(<span class="dv">2</span>))</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    xlab <span class="ot">&lt;-</span> <span class="st">"surprisal (bits)"</span>; xbreaks <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="dv">15</span>)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (surp_units <span class="sc">==</span> <span class="st">"nats"</span>) {</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    xlab <span class="ot">&lt;-</span> <span class="st">"surprisal (nats)"</span>; xbreaks <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">30</span>, <span class="dv">10</span>)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (use_shifted_est) data_to_plot <span class="ot">&lt;-</span> <span class="fu">mutate</span>(data_to_plot, <span class="at">est =</span> est_shifted)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> data_to_plot <span class="sc">%&gt;%</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> surprisal, <span class="at">y =</span> <span class="fu">trans</span>(est),</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>               <span class="at">ymin =</span> <span class="fu">trans</span>(est <span class="sc">-</span> se.mult<span class="sc">*</span>se), <span class="at">ymax =</span> <span class="fu">trans</span>(est <span class="sc">+</span> se.mult<span class="sc">*</span>se),</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> context_len))</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(controls)) {</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add in linear data</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (use_shifted_est) controls <span class="ot">&lt;-</span> <span class="fu">mutate</span>(controls, <span class="at">est =</span> est_shifted)</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_ribbon</span>(<span class="at">data =</span> controls, <span class="fu">aes</span>(<span class="at">y=</span><span class="cn">NULL</span>), </span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> linear_control_color, <span class="at">size =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">data =</span> controls, </span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>                <span class="at">lty=</span> linear_control_lty, <span class="at">color =</span> linear_control_color, </span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> linear_control_lsize, <span class="at">alpha=</span> <span class="fl">1.0</span>)</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(additional_controls)) {</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add in other data</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (use_shifted_est) additional_controls <span class="ot">&lt;-</span> <span class="fu">mutate</span>(</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>      additional_controls, <span class="at">est =</span> est_shifted)</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_ribbon</span>(<span class="at">data =</span> additional_controls, <span class="fu">aes</span>(<span class="at">y=</span><span class="cn">NULL</span>), </span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># fill = additional_control_color, </span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">data =</span> additional_controls, <span class="fu">aes</span>(<span class="at">color =</span> context_len),</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>                <span class="at">lty =</span> additional_control_lty, <span class="co">#color = additional_control_color, </span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> additional_control_lsize, <span class="at">alpha=</span> <span class="fl">1.0</span>)</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(density_df)) {</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>    max_surps <span class="ot">=</span> data_to_plot <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model, context_len) <span class="sc">%&gt;%</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">max_surp=</span><span class="fu">max</span>(surprisal), <span class="at">.groups=</span><span class="st">"drop"</span>)</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>    density_df <span class="ot">&lt;-</span> density_df <span class="sc">%&gt;%</span> </span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>      <span class="fu">full_join</span>(max_surps, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"model"</span>, <span class="st">"context_len"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(surprisal <span class="sc">&lt;=</span> max_surp)</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>    density_ymin <span class="ot">&lt;-</span> <span class="cf">if</span> (use_shifted_est) <span class="dv">312</span> <span class="cf">else</span> <span class="sc">-</span><span class="dv">10</span></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>    density_df <span class="ot">&lt;-</span> <span class="fu">mutate</span>(density_df, <span class="at">density =</span> <span class="dv">120</span> <span class="sc">*</span> density <span class="sc">+</span> density_ymin)</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> density_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">est_type =</span> <span class="st">"mean"</span>), </span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">ymin =</span> <span class="cn">NULL</span>, <span class="at">ymax =</span> <span class="cn">NULL</span>, <span class="at">y =</span> density, <span class="at">x =</span> surprisal, <span class="at">linetype =</span> <span class="cn">NULL</span>), </span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">linetype =</span> <span class="st">"solid"</span>,</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> density_color, <span class="at">alpha=</span>.<span class="dv">35</span>)</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_ribbon</span>(<span class="at">data =</span> density_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">est_type =</span> <span class="st">"mean"</span>),</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">x =</span> surprisal, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="co"># forget the y aesthetic</span></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> density_ymin, <span class="at">ymax =</span> density),</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> density_color, <span class="at">alpha =</span> <span class="fl">0.2</span>)</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">y=</span><span class="cn">NULL</span>), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">size=</span><span class="dv">0</span>)</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(static_lty)) {</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>        p <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span>context_len), <span class="at">linetype =</span> static_lty)</span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>        p <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span>context_len, <span class="at">linetype =</span> est_type))</span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">"context amount"</span>, <span class="at">labels =</span> context_len_labs) <span class="sc">+</span></span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"context amount"</span>, <span class="at">labels =</span> context_len_labs) <span class="sc">+</span></span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linetype_discrete</span>(<span class="at">name =</span> <span class="st">"effect"</span>, <span class="at">labels =</span> est_type_labs) <span class="sc">+</span></span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(..., <span class="at">labeller =</span> my_labeller) <span class="sc">+</span></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> xbreaks) <span class="sc">+</span></span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> xlab, <span class="at">y=</span>ylab)</span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>plot_easy_mean_patch <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>      data_to_plot, data_to_plot_control,</span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>      <span class="at">order_models_by_PPL =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>      <span class="at">ctx_lens =</span> context_lens, <span class="at">density_df =</span> surprisal_densities, </span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>      <span class="at">meanbreaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">25</span>, <span class="dv">500</span>, <span class="dv">25</span>), ...){</span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (order_models_by_PPL) {</span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>      data_to_plot<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>        data_to_plot<span class="sc">$</span>model, <span class="at">levels =</span> models_in_desc_PPL_order)</span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>      data_to_plot_control<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="fu">factor</span>(data_to_plot_control<span class="sc">$</span>model, <span class="at">levels =</span> models_in_desc_PPL_order)</span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>    which_descr <span class="ot">&lt;-</span> <span class="st">"mean RT"</span></span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>    data_to_plot <span class="ot">&lt;-</span> data_to_plot <span class="sc">%&gt;%</span> <span class="fu">filter</span>(est_type<span class="sc">==</span><span class="st">"mean"</span>)</span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>    data_to_plot_control <span class="ot">&lt;-</span> data_to_plot_control <span class="sc">%&gt;%</span> <span class="fu">filter</span>(est_type<span class="sc">==</span><span class="st">"mean"</span>)</span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>    space <span class="ot">&lt;-</span> <span class="st">"free"</span>; ybreaks <span class="ot">&lt;-</span> meanbreaks</span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>    static_lty <span class="ot">=</span> <span class="st">"solid"</span>; ltyguide <span class="ot">&lt;-</span> <span class="st">"none"</span></span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>    data_to_plot <span class="sc">%&gt;%</span> </span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(context_len <span class="sc">%in%</span> ctx_lens) <span class="sc">%&gt;%</span></span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plot_data</span>(<span class="at">controls =</span> data_to_plot_control <span class="sc">%&gt;%</span></span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(context_len <span class="sc">%in%</span> ctx_lens),</span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>                <span class="at">density_df =</span> density_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(context_len <span class="sc">%in%</span> ctx_lens),</span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>                <span class="at">static_lty =</span> static_lty,</span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a>                <span class="at">rows =</span></span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a>                  context_len  <span class="co">#+ est_type</span></span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span>   model,</span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>                <span class="at">scales=</span><span class="st">"free"</span>, <span class="at">space=</span>space,</span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a>                <span class="at">switch=</span><span class="st">"y"</span>,</span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a>                <span class="at">ylab =</span> <span class="st">"mean RT ±2*SE"</span>,</span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a>                ...) <span class="sc">+</span></span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="co">#title = "GAM fits of the effect of surprisal on reading time",</span></span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a>           <span class="at">subtitle =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"Partial effect of surprisal on {which_descr}"</span>)) <span class="sc">+</span></span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement=</span><span class="st">'outside'</span>,</span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axis.title.x = element_blank(), axis.text.x = element_blank(),</span></span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">08</span>,.<span class="dv">7</span>),</span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">size =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"white"</span>)) <span class="sc">+</span></span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a>        <span class="co"># guides(linetype = ltyguide) +</span></span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> ybreaks, <span class="at">position =</span> <span class="st">"right"</span>)</span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a>plot_easy_var_patch <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a>      data_to_plot, data_to_plot_control,</span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a>      <span class="at">order_models_by_PPL =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a>      <span class="at">ctx_lens =</span> context_lens, <span class="at">density_df =</span> surprisal_densities, ...){</span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (order_models_by_PPL) {</span>
<span id="cb9-128"><a href="#cb9-128" aria-hidden="true" tabindex="-1"></a>      data_to_plot<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb9-129"><a href="#cb9-129" aria-hidden="true" tabindex="-1"></a>        data_to_plot<span class="sc">$</span>model, <span class="at">levels =</span> models_in_desc_PPL_order)</span>
<span id="cb9-130"><a href="#cb9-130" aria-hidden="true" tabindex="-1"></a>      data_to_plot_control<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb9-131"><a href="#cb9-131" aria-hidden="true" tabindex="-1"></a>        data_to_plot_control<span class="sc">$</span>model, <span class="at">levels =</span> models_in_desc_PPL_order)</span>
<span id="cb9-132"><a href="#cb9-132" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-133"><a href="#cb9-133" aria-hidden="true" tabindex="-1"></a>    varbreaks <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {<span class="cf">if</span> (<span class="fu">max</span>(x)<span class="sc">&lt;</span><span class="fl">5.3</span>) <span class="fu">seq</span>(<span class="dv">4</span>,<span class="dv">6</span>,.<span class="dv">2</span>) <span class="cf">else</span> <span class="fu">seq</span>(<span class="dv">3</span>,<span class="dv">7</span>, .<span class="dv">5</span>)}</span>
<span id="cb9-134"><a href="#cb9-134" aria-hidden="true" tabindex="-1"></a>    which_descr <span class="ot">&lt;-</span> <span class="st">"log standard deviation in RT"</span></span>
<span id="cb9-135"><a href="#cb9-135" aria-hidden="true" tabindex="-1"></a>    data_to_plot <span class="ot">&lt;-</span> data_to_plot <span class="sc">%&gt;%</span> <span class="fu">filter</span>(est_type<span class="sc">==</span><span class="st">"var"</span>)</span>
<span id="cb9-136"><a href="#cb9-136" aria-hidden="true" tabindex="-1"></a>    data_to_plot_control <span class="ot">&lt;-</span> data_to_plot_control <span class="sc">%&gt;%</span> <span class="fu">filter</span>(est_type<span class="sc">==</span><span class="st">"var"</span>)</span>
<span id="cb9-137"><a href="#cb9-137" aria-hidden="true" tabindex="-1"></a>    space <span class="ot">&lt;-</span> <span class="st">"free"</span>; ybreaks <span class="ot">&lt;-</span> varbreaks</span>
<span id="cb9-138"><a href="#cb9-138" aria-hidden="true" tabindex="-1"></a>    static_lty <span class="ot">=</span> variance_lty; ltyguide <span class="ot">&lt;-</span> <span class="st">"none"</span></span>
<span id="cb9-139"><a href="#cb9-139" aria-hidden="true" tabindex="-1"></a>    data_to_plot <span class="sc">%&gt;%</span></span>
<span id="cb9-140"><a href="#cb9-140" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(context_len <span class="sc">%in%</span> ctx_lens) <span class="sc">%&gt;%</span></span>
<span id="cb9-141"><a href="#cb9-141" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plot_data</span>(<span class="at">controls =</span> data_to_plot_control <span class="sc">%&gt;%</span></span>
<span id="cb9-142"><a href="#cb9-142" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(context_len <span class="sc">%in%</span> ctx_lens),</span>
<span id="cb9-143"><a href="#cb9-143" aria-hidden="true" tabindex="-1"></a>                <span class="at">density_df =</span> <span class="cn">NULL</span>,</span>
<span id="cb9-144"><a href="#cb9-144" aria-hidden="true" tabindex="-1"></a>                <span class="at">ylab =</span> <span class="st">"log (sd RT) ±2*SE"</span>,</span>
<span id="cb9-145"><a href="#cb9-145" aria-hidden="true" tabindex="-1"></a>                <span class="at">static_lty =</span> static_lty,</span>
<span id="cb9-146"><a href="#cb9-146" aria-hidden="true" tabindex="-1"></a>                <span class="at">rows =</span></span>
<span id="cb9-147"><a href="#cb9-147" aria-hidden="true" tabindex="-1"></a>                  context_len <span class="co">#+ est_type</span></span>
<span id="cb9-148"><a href="#cb9-148" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span>   model,</span>
<span id="cb9-149"><a href="#cb9-149" aria-hidden="true" tabindex="-1"></a>                <span class="at">scales=</span><span class="st">"free"</span>, <span class="at">space=</span>space,</span>
<span id="cb9-150"><a href="#cb9-150" aria-hidden="true" tabindex="-1"></a>                <span class="at">switch=</span><span class="st">"y"</span>,</span>
<span id="cb9-151"><a href="#cb9-151" aria-hidden="true" tabindex="-1"></a>                <span class="co"># trans = \(x){exp(x)^2},</span></span>
<span id="cb9-152"><a href="#cb9-152" aria-hidden="true" tabindex="-1"></a>                ...) <span class="sc">+</span></span>
<span id="cb9-153"><a href="#cb9-153" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="co">#title = "GAM fits of the effect of surprisal on reading time",</span></span>
<span id="cb9-154"><a href="#cb9-154" aria-hidden="true" tabindex="-1"></a>           <span class="at">subtitle =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"Partial effect of surprisal on {which_descr}"</span>)) <span class="sc">+</span></span>
<span id="cb9-155"><a href="#cb9-155" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb9-156"><a href="#cb9-156" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement=</span><span class="st">'outside'</span>,  <span class="at">strip.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb9-157"><a href="#cb9-157" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">08</span>,.<span class="dv">7</span>),</span>
<span id="cb9-158"><a href="#cb9-158" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">size =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"white"</span>)) <span class="sc">+</span></span>
<span id="cb9-159"><a href="#cb9-159" aria-hidden="true" tabindex="-1"></a>        <span class="co"># guides(linetype = ltyguide) +</span></span>
<span id="cb9-160"><a href="#cb9-160" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> ybreaks, <span class="at">position =</span> <span class="st">"right"</span>)</span>
<span id="cb9-161"><a href="#cb9-161" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-162"><a href="#cb9-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-163"><a href="#cb9-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-164"><a href="#cb9-164" aria-hidden="true" tabindex="-1"></a>plot_easy_both_patch <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb9-165"><a href="#cb9-165" aria-hidden="true" tabindex="-1"></a>    data_to_plot, data_to_plot_control,</span>
<span id="cb9-166"><a href="#cb9-166" aria-hidden="true" tabindex="-1"></a>    <span class="at">order_models_by_PPL =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-167"><a href="#cb9-167" aria-hidden="true" tabindex="-1"></a>    <span class="at">ctx_lens =</span> context_lens, <span class="at">density_df =</span> surprisal_densities, ...) {</span>
<span id="cb9-168"><a href="#cb9-168" aria-hidden="true" tabindex="-1"></a>  p_mean <span class="ot">&lt;-</span> <span class="fu">plot_easy_mean_patch</span>(data_to_plot, data_to_plot_control,</span>
<span id="cb9-169"><a href="#cb9-169" aria-hidden="true" tabindex="-1"></a>      <span class="at">order_models_by_PPL =</span> order_models_by_PPL,</span>
<span id="cb9-170"><a href="#cb9-170" aria-hidden="true" tabindex="-1"></a>      <span class="at">ctx_lens =</span> ctx_lens, <span class="at">density_df =</span> density_df, ...) <span class="sc">+</span> </span>
<span id="cb9-171"><a href="#cb9-171" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb9-172"><a href="#cb9-172" aria-hidden="true" tabindex="-1"></a>  p_var <span class="ot">&lt;-</span> <span class="fu">plot_easy_var_patch</span>(data_to_plot, data_to_plot_control,</span>
<span id="cb9-173"><a href="#cb9-173" aria-hidden="true" tabindex="-1"></a>      <span class="at">order_models_by_PPL =</span> order_models_by_PPL,</span>
<span id="cb9-174"><a href="#cb9-174" aria-hidden="true" tabindex="-1"></a>      <span class="at">ctx_lens =</span> ctx_lens, <span class="at">density_df =</span> density_df, ...)</span>
<span id="cb9-175"><a href="#cb9-175" aria-hidden="true" tabindex="-1"></a>  p_mean <span class="sc">+</span> p_var <span class="sc">+</span></span>
<span id="cb9-176"><a href="#cb9-176" aria-hidden="true" tabindex="-1"></a>    patchwork<span class="sc">::</span><span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb9-177"><a href="#cb9-177" aria-hidden="true" tabindex="-1"></a>    patchwork<span class="sc">::</span><span class="fu">plot_annotation</span>(</span>
<span id="cb9-178"><a href="#cb9-178" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"GAM fits of the effect of surprisal on reading time"</span></span>
<span id="cb9-179"><a href="#cb9-179" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-180"><a href="#cb9-180" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>density_color <span class="ot">&lt;-</span> <span class="st">"grey"</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>linear_control_color <span class="ot">&lt;-</span> <span class="st">"black"</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>linear_control_lty <span class="ot">&lt;-</span> <span class="st">"13"</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>linear_control_lsize <span class="ot">&lt;-</span> .<span class="dv">25</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>variance_lty <span class="ot">&lt;-</span> <span class="st">"31"</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>additional_control_color <span class="ot">&lt;-</span> <span class="st">"grey"</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>additional_control_lty <span class="ot">&lt;-</span> <span class="st">"33"</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>additional_control_lsize <span class="ot">&lt;-</span> .<span class="dv">25</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_easy_mean_patch</span>(data_to_plot_var0_gauss_wprev, data_to_plot_lin0var_wprev,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">meanbreaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">25</span>, <span class="dv">650</span>, <span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">"RT (ms) ±2*SE"</span>,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Effect of surprisal on mean RT"</span>,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"GAMs with constant variance assumption"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="make_figures_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">### FIG FOR PAPER (3 contexts)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(figsdir, <span class="st">"gauss0var"</span>, context_pref, <span class="st">"_wprev"</span>, <span class="st">"_wlinear0var_both_patch.pdf"</span>),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="fl">10.5</span>, <span class="at">height =</span> <span class="fu">ifelse</span>(twocontexts, <span class="fl">3.5</span>, <span class="fl">4.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>additional_control_color <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>additional_control_lty <span class="ot">&lt;-</span> <span class="st">"33"</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>additional_control_lsize <span class="ot">&lt;-</span> .<span class="dv">25</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>plot_easy_mean_patch_3 <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>      data_to_plot, data_to_plot_control, data_to_plot_control2,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">order_models_by_PPL =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">ctx_lens =</span> context_lens, <span class="at">density_df =</span> surprisal_densities,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">meanbreaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">25</span>, <span class="dv">500</span>, <span class="dv">25</span>), ...){</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (order_models_by_PPL) {</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>      data_to_plot<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        data_to_plot<span class="sc">$</span>model, <span class="at">levels =</span> models_in_desc_PPL_order)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>      data_to_plot_control<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        data_to_plot_control<span class="sc">$</span>model, <span class="at">levels =</span> models_in_desc_PPL_order)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    which_descr <span class="ot">&lt;-</span> <span class="st">"mean RT"</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    data_to_plot <span class="ot">&lt;-</span> data_to_plot <span class="sc">%&gt;%</span> <span class="fu">filter</span>(est_type<span class="sc">==</span><span class="st">"mean"</span>)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    data_to_plot_control <span class="ot">&lt;-</span> data_to_plot_control <span class="sc">%&gt;%</span> <span class="fu">filter</span>(est_type<span class="sc">==</span><span class="st">"mean"</span>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    data_to_plot_control2 <span class="ot">&lt;-</span> data_to_plot_control2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(est_type<span class="sc">==</span><span class="st">"mean"</span>)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    space <span class="ot">&lt;-</span> <span class="st">"free"</span>; ybreaks <span class="ot">&lt;-</span> meanbreaks</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    static_lty <span class="ot">=</span> <span class="st">"solid"</span>; ltyguide <span class="ot">&lt;-</span> <span class="st">"none"</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    data_to_plot <span class="sc">%&gt;%</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(context_len <span class="sc">%in%</span> ctx_lens) <span class="sc">%&gt;%</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plot_data</span>(<span class="at">controls =</span> data_to_plot_control <span class="sc">%&gt;%</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(context_len <span class="sc">%in%</span> ctx_lens),</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>                <span class="at">additional_controls =</span> data_to_plot_control2 <span class="sc">%&gt;%</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(context_len <span class="sc">%in%</span> ctx_lens),</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>                <span class="at">density_df =</span> density_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(context_len <span class="sc">%in%</span> ctx_lens),</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>                <span class="at">static_lty =</span> static_lty,</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>                <span class="at">rows =</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>                  context_len  <span class="co">#+ est_type</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span>   model,</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>                <span class="at">scales=</span><span class="st">"free"</span>, <span class="at">space=</span>space,</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>                <span class="at">switch=</span><span class="st">"y"</span>,</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>                <span class="at">ylab =</span> <span class="st">"mean RT ±2*SE"</span>,</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>                ...) <span class="sc">+</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="co">#title = "GAM fits of the effect of surprisal on reading time",</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>           <span class="at">subtitle =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"Partial effect of surprisal on {which_descr}"</span>)) <span class="sc">+</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement=</span><span class="st">'outside'</span>,</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axis.title.x = element_blank(), axis.text.x = element_blank(),</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">08</span>,.<span class="dv">7</span>),</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">size =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"white"</span>)) <span class="sc">+</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> ybreaks, <span class="at">position =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">guides</span>(<span class="at">linetype =</span> ltyguide)</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_easy_mean_patch_3</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  data_to_plot_var0_gauss_w3prev,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  data_to_plot_lin0var_wprev,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  data_to_plot_var0_gauss_wprev <span class="sc">%&gt;%</span>  <span class="fu">filter</span>(est_shifted <span class="sc">&lt;=</span> <span class="dv">500</span>),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">meanbreaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">25</span>, <span class="dv">650</span>, <span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">"RT (ms) ±2*SE"</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Effect of surprisal on mean RT, GAMs with constant variance"</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"comparing using 3 words for spillover (solid) words to just 1 (dashed)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="make_figures_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">### FIG FOR PAPER (3 contexts)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(figsdir, <span class="st">"gauss0var"</span>, context_pref, <span class="st">"_wprev_vs_wprev3_lin0var.pdf"</span>),</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="fl">10.5</span>, <span class="at">height =</span> <span class="fu">ifelse</span>(twocontexts, <span class="fl">3.5</span>, <span class="fl">4.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Main plot figure for paper:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_easy_both_patch</span>(data_to_plot_smooth_wprevm, data_to_plot_linear_wprevm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="make_figures_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="do">### FIG FOR PAPER (2 and 3 contexts)</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(figsdir, <span class="st">"gaulss"</span>, context_pref, <span class="st">"_wprevm"</span>, <span class="st">"_wlinear_both_patch.pdf"</span>),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="fl">10.5</span>, <span class="at">height =</span> <span class="fu">ifelse</span>(twocontexts, <span class="dv">6</span>, <span class="fl">7.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="superlinearity" class="level2">
<h2 class="anchored" data-anchor-id="superlinearity">Superlinearity</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>make_half_linears_dataset <span class="ot">&lt;-</span> <span class="cf">function</span>(data_to_plot, <span class="at">breakpoint=</span><span class="fl">0.5</span>, <span class="at">se.mult=</span><span class="fl">1.96</span>) {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#" fit simple linear models to the smooth fits before and after the breakpoint</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#" breakpoint should be between 0 and 1 (proportion of max surprisal to break at)</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  data_to_plot <span class="sc">%&gt;%</span> </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(model, context_len) <span class="sc">%&gt;%</span> </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">secondhalf =</span> surprisal <span class="sc">&gt;</span> <span class="fu">max</span>(surprisal) <span class="sc">*</span> breakpoint) <span class="sc">%&gt;%</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(secondhalf, est_type, <span class="at">.add =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">do</span>(<span class="at">f =</span> broom<span class="sc">::</span><span class="fu">tidy</span>(<span class="fu">lm</span>(est <span class="sc">~</span> surprisal, <span class="at">weights =</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(se), <span class="at">data =</span> .))) <span class="sc">%&gt;%</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">unnest</span>(f) <span class="sc">%&gt;%</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">lower =</span> estimate <span class="sc">-</span> se.mult <span class="sc">*</span> std.error,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">upper =</span> estimate <span class="sc">+</span> se.mult <span class="sc">*</span> std.error) <span class="sc">%&gt;%</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"surprisal"</span>)  </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co"># half_linears3 &lt;- make_half_linears_dataset(data_to_plot_smooth_wprevm, breakpoint=1/3)</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>half_linears2 <span class="ot">&lt;-</span> <span class="fu">make_half_linears_dataset</span>(data_to_plot_smooth_wprevm, <span class="at">breakpoint=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co"># For the datasubset_lessN versions (just GPT3d for now)</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>half_linears2_less6 <span class="ot">&lt;-</span> <span class="fu">make_half_linears_dataset</span>(</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  data_to_plot_datasubsetless6_smooth_wprevm, <span class="at">breakpoint=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>half_linears2_less12 <span class="ot">&lt;-</span> <span class="fu">make_half_linears_dataset</span>(</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  data_to_plot_datasubsetless12_smooth_wprevm, <span class="at">breakpoint=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>make_halflinears_diffs_dataset <span class="ot">&lt;-</span> <span class="cf">function</span>(half_linears_dataset) {</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  half_linears_dataset <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model, context_len, est_type) <span class="sc">%&gt;%</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">do</span>(<span class="at">diff_slope_hi_v_low =</span> </span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>         <span class="fu">filter</span>(., secondhalf<span class="sc">==</span><span class="cn">TRUE</span>)<span class="sc">$</span>estimate <span class="sc">-</span> <span class="fu">filter</span>(., secondhalf<span class="sc">==</span><span class="cn">FALSE</span>)<span class="sc">$</span>estimate,</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">sum_std.error =</span> </span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>         <span class="fu">filter</span>(., secondhalf<span class="sc">==</span><span class="cn">TRUE</span>)<span class="sc">$</span>std.error <span class="sc">+</span> <span class="fu">filter</span>(., secondhalf<span class="sc">==</span><span class="cn">FALSE</span>)<span class="sc">$</span>std.error</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>       ) <span class="sc">%&gt;%</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">unnest</span>(<span class="fu">c</span>(diff_slope_hi_v_low, sum_std.error)) <span class="sc">%&gt;%</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">upper =</span> diff_slope_hi_v_low <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> sum_std.error,</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">lower =</span> diff_slope_hi_v_low <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> sum_std.error)</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>halflinear_diffs2 <span class="ot">&lt;-</span> <span class="fu">make_halflinears_diffs_dataset</span>(half_linears2)</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a><span class="co"># halflinear_diffs3 &lt;- make_halflinears_diffs_dataset(half_linears3)</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a><span class="do">## Save halflinear data</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a><span class="co"># halflinear_diffs2 %&gt;% readr::write_csv("natural-stories-surprisals/gaulss_halflinear_diffs2.csv")</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a><span class="co"># halflinear_diffs3 %&gt;% readr::write_csv("natural-stories-surprisals/gaulss_halflinear_diffs3.csv")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Read in halflinear data</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># halflinear_diffs2 &lt;- load_in_data("natural-stories-surprisals/gaulss_halflinear_diffs2.csv")</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># halflinear_diffs3 &lt;- load_in_data("natural-stories-surprisals/gaulss_halflinear_diffs3.csv")</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>halflinear_diffs2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(context_len <span class="sc">%in%</span> context_lens) <span class="sc">%&gt;%</span> </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> diff_slope_hi_v_low, <span class="at">shape =</span> est_type,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper, <span class="at">color =</span> context_len)) <span class="sc">+</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="dv">0</span>, <span class="at">color=</span><span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">width =</span> .<span class="dv">25</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(context_len <span class="sc">+</span>est_type<span class="sc">~</span> model, <span class="at">labeller =</span> my_labeller, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">"context amount"</span>, <span class="at">labels =</span> context_len_labs) <span class="sc">+</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"context amount"</span>, <span class="at">labels =</span> context_len_labs) <span class="sc">+</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_discrete</span>(<span class="at">name =</span> <span class="st">""</span>, <span class="at">labels =</span> est_type_labs) <span class="sc">+</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.08</span>, <span class="fl">0.7</span>),</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">size =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"white"</span>)) <span class="sc">+</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"model"</span>,</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"slope at high surprisal - slope at low surprisal"</span>,</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Superlinearity by LM"</span>,</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Difference in slope of smooth predictions for high vs. low surprisal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="make_figures_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave(</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   paste0(</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     figsdir, "", context_pref, "gaulss_halflinear_diffs3.pdf"),</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   width = 5, height = 4)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="cutoffs-most-surprising-words" class="level4">
<h4 class="anchored" data-anchor-id="cutoffs-most-surprising-words">Cutoffs most surprising words</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>data_to_plot_multicutoffs <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  data_to_plot_smooth_wprevm, <span class="co"># cutoff=NA for these rows</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  data_to_plot_datasubsetless6_smooth_wprevm,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  data_to_plot_datasubsetless12_smooth_wprevm</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cutoff =</span> forcats<span class="sc">::</span><span class="fu">fct_rev</span>(forcats<span class="sc">::</span><span class="fu">as_factor</span>(cutoff)))</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>compare_one_model_multi_cutoffs_surprisal<span class="ot">&lt;-</span><span class="cf">function</span>(</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    data_to_plot_multicutoffs, </span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">use_shifted_est =</span> T, <span class="at">trans =</span> I, <span class="at">se.mult =</span> <span class="fl">1.96</span>,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">ctx_lens =</span> context_lens, <span class="at">density_df =</span> surprisal_densities, </span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">"fitted effect</span><span class="sc">\n</span><span class="st">estimate (+ intercept) ±2*SE"</span>,...) {</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> data_to_plot_multicutoffs <span class="sc">%&gt;%</span> </span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(model<span class="sc">==</span><span class="st">"GPT3-davinci"</span>, context_len<span class="sc">==</span><span class="st">"max"</span>, est_type <span class="sc">==</span> <span class="st">"mean"</span>)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  l<span class="ot">&lt;-</span> <span class="fu">levels</span>(d<span class="sc">$</span>cutoff) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (use_shifted_est) d <span class="ot">&lt;-</span> <span class="fu">mutate</span>(d, <span class="at">est =</span> est_shifted)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> surprisal, <span class="at">y =</span> <span class="fu">trans</span>(est),</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">color=</span>cutoff, <span class="co">#linetype = !is.na(cutoff),</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">ymin =</span> <span class="fu">trans</span>(est <span class="sc">-</span> se.mult<span class="sc">*</span>se), <span class="at">ymax =</span> <span class="fu">trans</span>(est <span class="sc">+</span> se.mult<span class="sc">*</span>se)))</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>  max_surps <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(model, context_len, cutoff) <span class="sc">%&gt;%</span> </span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">max_surp=</span><span class="fu">max</span>(surprisal), <span class="at">.groups=</span><span class="st">"drop"</span>)</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>  density_df <span class="ot">&lt;-</span> density_df <span class="sc">%&gt;%</span> </span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">right_join</span>(max_surps, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"model"</span>, <span class="st">"context_len"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(surprisal <span class="sc">&lt;=</span> max_surp)</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>  density_ymin <span class="ot">&lt;-</span> <span class="cf">if</span> (use_shifted_est) <span class="dv">312</span> <span class="cf">else</span> <span class="sc">-</span><span class="dv">10</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>  density_df <span class="ot">&lt;-</span> <span class="fu">mutate</span>(density_df, <span class="at">density =</span> <span class="dv">120</span> <span class="sc">*</span> density <span class="sc">+</span> density_ymin)</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data =</span> density_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">est_type =</span> <span class="st">"mean"</span>),</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> <span class="cn">NULL</span>, <span class="at">ymax =</span> <span class="cn">NULL</span>, <span class="at">color =</span> cutoff,</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> density, <span class="at">x =</span> surprisal),</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">"solid"</span>, </span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha=</span>.<span class="dv">25</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="at">data =</span> density_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">est_type =</span> <span class="st">"mean"</span>), <span class="at">inherit.aes =</span> F,</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> surprisal, </span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lty =</span> <span class="cn">NULL</span>,</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> density_ymin, <span class="at">ymax =</span> density),</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> density_color, <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.35</span> <span class="sc">/</span> <span class="fu">length</span>(l))</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p <span class="sc">+</span> </span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ggplot2::annotate(</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   geom="text", x=l+0.1, y=312+10, </span></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   label=glue::glue("surprisal cutoff = {l}"), </span></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   color= "grey", size=3, vjust=1, hjust=0) +</span></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">annotate</span>(</span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">geom=</span><span class="st">"segment"</span>, <span class="at">x=</span>l, <span class="at">xend=</span>l, <span class="at">y=</span><span class="sc">-</span><span class="cn">Inf</span>, <span class="at">yend=</span><span class="dv">322</span>, <span class="at">color=</span><span class="st">"grey"</span>)</span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>  p <span class="sc">+</span></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">y=</span><span class="cn">NULL</span>, <span class="at">color =</span> <span class="cn">NULL</span>, <span class="at">fill =</span> cutoff), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># scale_fill_discrete(name = "cutoff",  breaks = c(NA, l), labels = c("none", l)) +</span></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># scale_color_discrete(name = "cutoff", breaks = c(NA, l), labels = c("none", l)) +</span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"cutoff"</span>, <span class="at">values=</span><span class="fu">rev</span>(scales<span class="sc">::</span><span class="fu">hue_pal</span>()(<span class="dv">14</span>)), </span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a>                   <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">18</span>,<span class="cn">NA</span>), </span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">18</span>,<span class="st">"none"</span>)) <span class="sc">+</span></span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"cutoff"</span>, <span class="at">values=</span><span class="fu">rev</span>(scales<span class="sc">::</span><span class="fu">hue_pal</span>()(<span class="dv">14</span>)), </span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>                   <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">18</span>,<span class="cn">NA</span>), </span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">18</span>,<span class="st">"none"</span>)) <span class="sc">+</span></span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linetype_manual</span>(<span class="at">name =</span> <span class="st">"whether cutoff"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="ot">=</span><span class="dv">1</span>, <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span><span class="ot">=</span><span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">linetype =</span> <span class="st">"none"</span>, <span class="at">size =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"surprisal (nats)"</span>, <span class="at">y =</span> ylab)</span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>p_gpt3_cutoffs_meaneffect <span class="ot">&lt;-</span> <span class="fu">compare_one_model_multi_cutoffs_surprisal</span>(data_to_plot_multicutoffs) <span class="sc">+</span></span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>( <span class="sc">~</span> model, <span class="at">labeller =</span> my_labeller, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">24</span>,.<span class="dv">68</span>),</span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">size =</span> <span class="dv">0</span>, <span class="at">fill =</span> <span class="fu">alpha</span>(<span class="st">"white"</span>, <span class="fl">0.5</span>), <span class="at">color =</span> <span class="fu">alpha</span>(<span class="st">"white"</span>, <span class="fl">0.5</span>))</span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"effect on mean RT ±2*SE"</span>,</span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle=</span><span class="st">"Effect of surprisal on RT"</span>, </span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># title="GAMs refit without highest surprisal items"</span></span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave(p_gpt3_cutoffs_meaneffect,</span></span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a><span class="co">#   filename = paste0(figsdir, "gpt3d_surprisal_cutoffs_effect_on_mean", ".pdf"),</span></span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a><span class="co">#   width = 3, height = 3.5)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="superlinearity-vs-perplexity" class="level3">
<h3 class="anchored" data-anchor-id="superlinearity-vs-perplexity">Superlinearity vs perplexity</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">full_join</span>(halflinear_diffs2, surprisal_means, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"model"</span>, <span class="st">"context_len"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(context_len <span class="sc">%in%</span> context_lens, est_type <span class="sc">==</span> <span class="st">"mean"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">diff =</span> diff_slope_hi_v_low, <span class="at">sem =</span> sum_std.error)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%&gt;%</span> <span class="fu">str_starts</span>(<span class="st">"GPT"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  note: `weight` aesthetic will be passed on to lm's `weights`` in geom_smooth/geom_line</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span>mean_surprisal, <span class="at">y =</span> diff, <span class="at">color =</span> context_len,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> upper, <span class="at">ymin =</span> lower, <span class="at">shape =</span> context_len,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">weight=</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(sem))) <span class="sc">+</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_grid(est_type ~ ., labeller = my_labeller, scales = "free_y") +</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ggpubr::stat_regline_equation(label.x.npc = .8, label.y.npc = .8, </span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               aes(label = after_stat(eq.label))) +</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  ggpubr<span class="sc">::</span><span class="fu">stat_regline_equation</span>(</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">label.x.npc =</span> .<span class="dv">6</span>, <span class="at">label.y.npc =</span> .<span class="dv">95</span>, </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color=</span><span class="cn">NULL</span>, <span class="at">shape =</span><span class="cn">NULL</span>, <span class="at">label =</span> <span class="fu">after_stat</span>(rr.label)), </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">color=</span><span class="st">"grey"</span>, <span class="at">size=</span><span class="dv">4</span>, <span class="at">show.legend  =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color=</span><span class="cn">NULL</span>,<span class="at">shape =</span><span class="cn">NULL</span>), </span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">'y~x'</span>, <span class="at">size =</span> <span class="dv">0</span>, <span class="at">alpha =</span> .<span class="dv">1</span>, <span class="at">color=</span><span class="st">"#f1f1f1"</span>) <span class="sc">+</span> <span class="co"># SE ribbon, no line</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color=</span><span class="cn">NULL</span>, <span class="at">shape =</span><span class="cn">NULL</span>), <span class="at">stat =</span> <span class="st">"smooth"</span>, </span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">'y~x'</span>, <span class="at">alpha =</span> .<span class="dv">66</span>, <span class="at">lty=</span><span class="st">"dotted"</span>, <span class="at">color=</span><span class="st">"grey"</span>) <span class="sc">+</span> <span class="co"># just line</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">data =</span> d, <span class="at">width =</span> .<span class="dv">03</span>) <span class="sc">+</span> </span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">str_starts</span>(model,<span class="st">"GPT"</span>)), <span class="at">size=</span><span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data =</span> d,</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> model_labs[model]),</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">max.overlaps =</span> <span class="cn">Inf</span>, <span class="at">min.segment.length =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">segment.alpha =</span> .<span class="dv">2</span>,</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">force_pull =</span> .<span class="dv">5</span>, <span class="at">hjust =</span> .<span class="dv">9</span>,  <span class="at">box.padding =</span> .<span class="dv">5</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"context amount"</span>, <span class="at">labels =</span> context_len_labs) <span class="sc">+</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"GPT"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="ot">=</span><span class="st">"grey"</span>, <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span><span class="ot">=</span><span class="st">"white"</span>)) <span class="sc">+</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">values=</span><span class="cf">if</span> (twocontexts) <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">23</span>) <span class="cf">else</span> <span class="fu">c</span>(<span class="dv">21</span>,<span class="dv">22</span>,<span class="dv">23</span>), </span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"context amount"</span>, <span class="at">labels =</span> context_len_labs) <span class="sc">+</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"LM quality (negative log perplexity)"</span>,</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"superlinearity"</span>,</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Superlinearity vs. LM quality"</span>) <span class="sc">+</span></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="make_figures_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="do">### FIG FOR PAPER</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    figsdir, context_pref,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gaulss_halflinear_diffs2_justFitGPTs_mean_v_mean_surprisal_lengthstogether.pdf"</span>),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a> <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="fl">4.25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="cutoffs-superlinearity" class="level4">
<h4 class="anchored" data-anchor-id="cutoffs-superlinearity">Cutoffs superlinearity</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>halflinear_diffs2_less6  <span class="ot">&lt;-</span> <span class="fu">make_halflinears_diffs_dataset</span>(half_linears2_less6)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>halflinear_diffs2_less12 <span class="ot">&lt;-</span> <span class="fu">make_halflinears_diffs_dataset</span>(half_linears2_less12)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>p_gpt3d_cutoffs_superlinearity <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  halflinear_diffs2 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">cutoff =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(model <span class="sc">==</span> <span class="st">"GPT3-davinci"</span>, context_len <span class="sc">==</span> <span class="st">"max"</span>),</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  halflinear_diffs2_less6 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">cutoff =</span> <span class="dv">6</span>),</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  halflinear_diffs2_less12 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">cutoff =</span> <span class="dv">12</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(est_type <span class="sc">==</span> <span class="st">"mean"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cutoff =</span> <span class="fu">factor</span>(cutoff)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(context_len <span class="sc">%in%</span> context_lens) <span class="sc">%&gt;%</span> </span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">diff =</span> diff_slope_hi_v_low, <span class="at">sem =</span> sum_std.error) <span class="sc">%&gt;%</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> cutoff, <span class="at">y =</span> diff, <span class="at">color =</span> cutoff, </span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> upper, <span class="at">ymin =</span> lower)) <span class="sc">+</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">width =</span> .<span class="dv">03</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>( <span class="sc">~</span> model, <span class="at">labeller =</span> my_labeller, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"cutoff"</span>, <span class="at">values=</span><span class="fu">rev</span>(scales<span class="sc">::</span><span class="fu">hue_pal</span>()(<span class="dv">14</span>)), </span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">18</span>,<span class="cn">NA</span>), </span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">18</span>,<span class="st">"none"</span>)) <span class="sc">+</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">name =</span> <span class="st">"cutoff"</span>, </span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>                   <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">18</span>,<span class="cn">NA</span>), </span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">18</span>,<span class="st">"none"</span>)) <span class="sc">+</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span> </span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># x = "Cutoff",</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"superlinearity</span><span class="sc">\n</span><span class="st">of effect on mean RT"</span>,</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Superlinearity"</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># title = "GAMs refit without highest surprisal items"</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave(p_gpt3d_cutoffs_superlinearity,</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a><span class="co">#   filename = paste0(figsdir, "gpt3d_surprisal_cutoffs", ".pdf"),</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   width = 3, height = 3.5)</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a><span class="fu">wrap_plots</span>(</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>  p_gpt3_cutoffs_meaneffect, </span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>  p_gpt3d_cutoffs_superlinearity, <span class="at">guides =</span> <span class="st">"collect"</span>, <span class="at">widths =</span> <span class="fu">c</span>(<span class="fl">1.2</span>,<span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">title=</span><span class="st">"GAMs refit without highest surprisal items"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="make_figures_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="do">### FIG FOR PAPER</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="fu">paste0</span>(figsdir, <span class="st">"gpt3d_surprisal_cutoffs"</span>, <span class="st">".pdf"</span>),</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="fl">3.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>
<section id="linear-model-coefficients" class="level2">
<h2 class="anchored" data-anchor-id="linear-model-coefficients">Linear model coefficients</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>summaries_linear <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"model-summaries-NEW-linear-wprevm.rds"</span>))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>linear_coefs<span class="ot">&lt;-</span>purrr<span class="sc">::</span><span class="fu">map_df</span>(</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>     summaries_linear, </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>     \(s) {s<span class="sc">$</span>p.table <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">term=</span><span class="fu">names</span>(s<span class="sc">$</span>p.pv))},</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">.id =</span> <span class="st">"model"</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>linear_coefs <span class="sc">%&gt;%</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_modelnames</span>() <span class="sc">%&gt;%</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(context_len <span class="sc">%in%</span> context_lens) <span class="sc">%&gt;%</span> </span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>model,<span class="at">y=</span>Estimate,<span class="co">#y=`Pr(&gt;|z|)`,</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">color=</span>context_len)) <span class="sc">+</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>term, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">labeller=</span>my_labeller) <span class="sc">+</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">30</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"context amount"</span>, <span class="at">labels =</span> context_len_labs) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="make_figures_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Whether to include both mean and variance</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>which_terms <span class="ot">&lt;-</span> <span class="st">"both"</span> <span class="co"># specify either "surprisal", "surprisal.1", or "both"</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>terms_included <span class="ot">&lt;-</span> <span class="cf">if</span> (which_terms<span class="sc">==</span><span class="st">"both"</span>) <span class="fu">c</span>(<span class="st">"surprisal"</span>, <span class="st">"surprisal.1"</span>) <span class="cf">else</span> which_terms</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>linear_coefs <span class="sc">%&gt;%</span> </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_modelnames</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> dplyr<span class="sc">::</span><span class="fu">recode</span>(model, <span class="sc">!!!</span>model_labs)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(context_len <span class="sc">%in%</span> context_lens) <span class="sc">%&gt;%</span> </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">%in%</span> terms_included) <span class="sc">%&gt;%</span> </span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>model,<span class="at">y=</span>Estimate,</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin=</span>Estimate<span class="fl">-1.96</span><span class="sc">*</span><span class="st">`</span><span class="at">Std. Error</span><span class="st">`</span>,</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax=</span>Estimate<span class="fl">+1.96</span><span class="sc">*</span><span class="st">`</span><span class="at">Std. Error</span><span class="st">`</span>,</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">color=</span>context_len)) <span class="sc">+</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape=</span>context_len)) <span class="sc">+</span> </span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">width =</span> .<span class="dv">25</span>, <span class="at">alpha=</span><span class="fl">0.75</span>) <span class="sc">+</span> </span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(term<span class="sc">~</span>., <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">labeller=</span>my_labeller) <span class="sc">+</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"context amount"</span>, <span class="at">labels =</span> context_len_labs) <span class="sc">+</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">values=</span><span class="cf">if</span> (twocontexts) <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>) <span class="cf">else</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">5</span>), <span class="at">name =</span> <span class="st">"context amount"</span>, </span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> context_len_labs) <span class="sc">+</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">30</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position=</span><span class="st">"top"</span>)  <span class="sc">+</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"LM"</span>, <span class="at">y =</span> <span class="st">"coefficient estimate"</span>,</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"Effect of surprisal"</span>,</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>                      <span class="st">" on RT and variance in RT"</span>), <span class="co">#&lt;- hardcoded for which_terms="both"</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle=</span><span class="st">"from linear control GAMs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="make_figures_files/figure-html/unnamed-chunk-13-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">### FIG FOR PAPER (2 contexts)</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(figsdir, context_pref, <span class="st">"gaulss_linear_coefs_"</span>, which_terms, <span class="st">".pdf"</span>),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">5</span>, <span class="at">height =</span> <span class="cf">if</span> (which_terms <span class="sc">==</span> <span class="st">"both"</span>) <span class="fl">4.5</span> <span class="cf">else</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="autocorrelation-plots" class="level2">
<h2 class="anchored" data-anchor-id="autocorrelation-plots">Autocorrelation plots</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load a model to inspect (P)ACF of</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>m_wprevmk6_gpt3d <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"GAM_models/GPT3-davinci.rds"</span>))</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the data on which the model was trained:</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>fitdata_perword <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"surps_lms.RTs.perword.rds"</span>))</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>fitdata <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"surps_lms.RTs.rds"</span>))</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co"># file prepare_data.R defines functions</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co"># - `prepare_data_with_perword`</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co"># - `sort_data_for_tokenization_type`</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"utils/prepare_data.R"</span>)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare data as it was prepared for model when trained</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>data_prepared_gpt3d <span class="ot">&lt;-</span> <span class="fu">prepare_data_with_perword</span>(</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> fitdata, <span class="at">data.perword =</span> fitdata_perword, </span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">modelname =</span> <span class="st">"GPT3-davinci"</span>, <span class="at">how_many_prevs =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Make function to (gg)plot ACF</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>get_clim <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">ci=</span><span class="fl">0.95</span>, <span class="at">ci.type=</span><span class="st">"white"</span>){</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' Gets confidence limit data from acf object `x`</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>ci.type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"ma"</span>)) <span class="fu">stop</span>(<span class="st">'`ci.type` must be "white" or "ma"'</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">class</span>(x) <span class="sc">!=</span> <span class="st">"acf"</span>) <span class="fu">stop</span>(<span class="st">'pass in object of class "acf"'</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  clim0 <span class="ot">&lt;-</span> <span class="fu">qnorm</span>((<span class="dv">1</span> <span class="sc">+</span> ci)<span class="sc">/</span><span class="dv">2</span>) <span class="sc">/</span> <span class="fu">sqrt</span>(x<span class="sc">$</span>n.used)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (ci.type <span class="sc">==</span> <span class="st">"ma"</span>) {</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    clim <span class="ot">&lt;-</span> clim0 <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="fu">cumsum</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span> <span class="sc">*</span> x<span class="sc">$</span>acf[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>))) </span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(clim[<span class="sc">-</span><span class="fu">length</span>(clim)])</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(clim0)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>ggplot_acf <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    x,</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci=</span><span class="fl">0.95</span>, <span class="at">ci.type=</span><span class="st">"white"</span>, <span class="at">ci.col =</span> <span class="st">"blue"</span>){</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' Replicates plot.acf() but using ggplot by default instead of base R plot</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' `x` must be an object of class "acf" such as that outputted by `acf()`</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' `ci.type` must be "white" or "ma"</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>ci.type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"ma"</span>)) <span class="fu">stop</span>(<span class="st">'`ci.type` must be "white" or "ma"'</span>)</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">class</span>(x) <span class="sc">!=</span> <span class="st">"acf"</span>) <span class="fu">stop</span>(<span class="st">'pass in object of class "acf"'</span>)</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>  with.ci <span class="ot">&lt;-</span> ci <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> x<span class="sc">$</span>type <span class="sc">!=</span> <span class="st">"covariance"</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>  with.ci.ma <span class="ot">&lt;-</span> with.ci <span class="sc">&amp;&amp;</span> ci.type <span class="sc">==</span> <span class="st">"ma"</span> <span class="sc">&amp;&amp;</span> x<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"correlation"</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(with.ci.ma <span class="sc">&amp;&amp;</span> x<span class="sc">$</span>lag[1L, 1L, 1L] <span class="sc">!=</span> 0L) {</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">"can use ci.type=</span><span class="sc">\"</span><span class="st">ma</span><span class="sc">\"</span><span class="st"> only if first lag is 0"</span>)</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>    with.ci.ma <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>  clim <span class="ot">&lt;-</span> <span class="fu">get_clim</span>(x, <span class="at">ci=</span>ci, <span class="at">ci.type=</span>ci.type)</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">lag =</span> x<span class="sc">$</span>lag, <span class="at">acf=</span>x<span class="sc">$</span>acf)</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>lag)) <span class="sc">+</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymax=</span>acf, <span class="at">ymin=</span><span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y=</span><span class="st">"ACF"</span>, <span class="at">x=</span><span class="st">"Lag"</span>)</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (with.ci) {</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (ci.type <span class="sc">==</span> <span class="st">"white"</span>) {</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>      p <span class="ot">&lt;-</span> p <span class="sc">+</span> </span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span><span class="sc">-</span>clim, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> ci.col) <span class="sc">+</span></span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span><span class="sc">+</span>clim, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> ci.col)</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (with.ci.ma <span class="sc">&amp;&amp;</span> ci.type <span class="sc">==</span> <span class="st">"ma"</span>) { <span class="co"># ci.type="ma" not allowed for pacf</span></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>      dfclim <span class="ot">&lt;-</span> df[<span class="sc">-</span><span class="dv">1</span>,]</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>      dfclim<span class="sc">$</span>clim <span class="ot">&lt;-</span> clim</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>      p <span class="ot">&lt;-</span> p <span class="sc">+</span> </span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="at">data =</span> dfclim, <span class="fu">aes</span>(<span class="at">y =</span> <span class="dv">0</span><span class="sc">-</span>clim), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> ci.col) <span class="sc">+</span></span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="at">data =</span> dfclim, <span class="fu">aes</span>(<span class="at">y =</span> <span class="dv">0</span><span class="sc">+</span>clim), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> ci.col)</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>acf_resid_gg <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    x, split_pred, dat, <span class="at">plot_sd=</span>F, <span class="at">sig=</span>F, <span class="at">series_length=</span><span class="cn">NULL</span>, ...){</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' x should be either a model, that is: class(x) = "bam" "gam" "glm" "lm" </span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#'             or a numeric vector (of residuals, say)</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' sig is the significance upper and lower lines (+- 1.96)</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' series_length is the length of the series needed for sig</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is</span>(x,<span class="st">"lm"</span>)){</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">resid</span>(x)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is</span>(x,<span class="st">"numeric"</span>)) {</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"Don't know what to do with input object of class {class(x)}"</span>))</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(dat))</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    dat <span class="ot">&lt;-</span><span class="fu">tibble</span>(<span class="at">x=</span>x,<span class="at">response=</span><span class="cn">NaN</span>)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  dat[<span class="sc">!</span><span class="fu">is.na</span>(dat<span class="sc">$</span>response),]<span class="sc">$</span>x <span class="ot">&lt;-</span> x</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  acf <span class="ot">&lt;-</span> itsadug<span class="sc">::</span><span class="fu">acf_plot</span>(dat<span class="sc">$</span>x, <span class="at">plot=</span>F, <span class="at">split_by =</span> split_pred, ...)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">acf=</span>acf,<span class="at">lag=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="fu">length</span>(acf)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>lag,<span class="at">y=</span>acf)) <span class="sc">+</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">width=</span><span class="fl">0.1</span>, <span class="at">alpha=</span><span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>()</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(plot_sd){</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">sd=</span>itsadug<span class="sc">::</span><span class="fu">acf_plot</span>(dat<span class="sc">$</span>x, <span class="at">fun=</span>sd, <span class="at">plot=</span>F, <span class="at">split_by =</span> split_pred, ...))</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>lag,<span class="at">y=</span>acf)) <span class="sc">+</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_col</span>(<span class="at">width=</span><span class="fl">0.4</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>acf<span class="fl">-1.96</span><span class="sc">*</span>sd,<span class="at">ymax=</span>acf<span class="fl">+1.96</span><span class="sc">*</span>sd), <span class="at">width=</span><span class="fl">0.3</span>, <span class="at">color=</span><span class="st">"red"</span>) </span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(sig){</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(series_length)) { <span class="fu">stop</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"You must specify series length"</span>)) }</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>    sig <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.05</span> <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="fu">sqrt</span>(series_length)</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span> <span class="sc">-</span> sig, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span> <span class="sc">+</span> sig, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"blue"</span>)</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<dl>
<dt>Data ordering</dt>
<dd>
When plotting GAM fits (with <code>plot.gam()</code> for example) it doesn’t matter what order the data is in but when plotting ACF of residuals the order of the data does matter. So be careful (note, for <code>itsadug::acf_resid</code>, with the right <code>split_pred</code> selected, it will work).
</dd>
</dl>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's get the residuals and then put them in the right order,</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># that is, sort by subject &gt; story_num &gt; word_num_in_story.</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>assertthat<span class="sc">::</span><span class="fu">are_equal</span>( <span class="co"># note: already removed NAs so nothing to worry about there</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  data_prepared_gpt3d <span class="sc">%&gt;%</span> nrow,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">resid</span>(m_wprevmk6_gpt3d) <span class="sc">%&gt;%</span> length) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>data_prepared_gpt3d_withresids <span class="ot">&lt;-</span> data_prepared_gpt3d</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>data_prepared_gpt3d_withresids<span class="sc">$</span>resids <span class="ot">&lt;-</span> <span class="fu">resid</span>(m_wprevmk6_gpt3d)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>data_resorted <span class="ot">&lt;-</span> <span class="fu">arrange</span>(</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  data_prepared_gpt3d_withresids, subject, story_num, word_num_in_story)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Thee dataframe <code>data_resorted</code> will now work for getting ACF of resids. Just one more thing: We just need to subset the data to remove the handful of observations from workers who only started stories, but didn’t get far (this messes up getting ACF plots for reasons I’m unsure of). Since it’s only a very small number of items, this won’t affect the autocorrelation results much.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>subset_workers<span class="ot">&lt;-</span><span class="cf">function</span>(<span class="at">nItems_threshold_productive =</span> <span class="dv">1000</span>, <span class="at">data=</span>fitdata){</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  how_many_stories_per_worker <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(WorkerId) <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">n_stories=</span><span class="fu">n_distinct</span>(story_num)) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n_stories))</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  how_many_items_per_worker <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(WorkerId) <span class="sc">%&gt;%</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>() <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">is_productive =</span> n <span class="sc">&gt;</span> nItems_threshold_productive)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  workers_info <span class="ot">&lt;-</span> <span class="fu">full_join</span>(</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    how_many_stories_per_worker, how_many_items_per_worker, <span class="at">by =</span> <span class="st">"WorkerId"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(is_productive), <span class="fu">desc</span>(n_stories), </span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>            (n<span class="sc">-</span><span class="fu">median</span>(how_many_items_per_worker<span class="sc">$</span>n))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(workers_info)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>workers_info <span class="ot">&lt;-</span> <span class="fu">subset_workers</span>(<span class="at">nItems_threshold_productive =</span> <span class="dv">1500</span>)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>excluded_workers_info <span class="ot">&lt;-</span> workers_info <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>is_productive <span class="sc">|</span> n_stories <span class="sc">&lt;=</span> <span class="dv">2</span>)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>selected_workers_info <span class="ot">&lt;-</span> workers_info <span class="sc">%&gt;%</span> <span class="fu">filter</span>(is_productive, n_stories <span class="sc">&gt;</span> <span class="dv">2</span>)</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Excluding workers with few or sparse observations,"</span>,</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"for calculating ACF.</span><span class="sc">\n</span><span class="st"> proportion of workers excluded = "</span>, </span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">length</span>(excluded_workers_info<span class="sc">$</span>n),<span class="st">"out of"</span>, <span class="fu">length</span>(workers_info<span class="sc">$</span>n),<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"proportion of items excluded = "</span>, </span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(excluded_workers_info<span class="sc">$</span>n)<span class="sc">/</span><span class="fu">sum</span>(workers_info<span class="sc">$</span>n),<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Excluding workers with few or sparse observations, for calculating ACF.
 proportion of workers excluded =  22 out of 180 
 proportion of items excluded =  0.01668801 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(selected_workers_info)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">WorkerId</th>
<th style="text-align: right;">n_stories</th>
<th style="text-align: right;">n</th>
<th style="text-align: left;">is_productive</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">A38UOBWJF4WFGG</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">8342</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A2TJHKHM8T2SV3</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10210</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A11AUVZ4MCA7VU</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10214</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">ACUXGYJAQUZAE</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10214</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A2JRWVPVWD1KAS</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10216</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A7LIT8S8LGRAH</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10237</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A2MVFSJBKHUPH9</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10238</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A1VXGA62J77RO</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10239</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A3S3YW6II31OZV</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10240</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A2U750ON775R3L</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10246</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AOTSROWZG1XS1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">8007</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">AJDL05304W8E</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">8830</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A3EQVDHHKZRC0K</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">9158</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">ALE5RDP8XZL3</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">9188</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A3NOO9K3CY1YU5</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8137</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">AEUGCBFJPU0MX</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8266</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A2MSCP411YP41Q</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8284</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">AKEZ83FQITFD8</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6157</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A2LFVSF501ZT5W</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5041</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A40F6EHXE5HXU</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5041</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A1DQ7T6BB0VJDP</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5042</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A2PURNW8W7L0LT</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5042</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A1INWCFGQI236V</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5039</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A1JGQHSSW8L24P</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5039</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A3RILJPBGAOWN4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5039</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A3U3DA0O35IORB</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5043</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A2UODR1DE3DXTT</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5044</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A36S7XIINCHR8R</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5044</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A3GYYRNHP635XM</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5044</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A2AEA24UF8Z47U</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5037</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A2XYF4PPQETJYX</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5037</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A3O1NDWT4BXNX4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5045</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A13YITU82HLBRK</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5036</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">ACPUTK2MNMYHB</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5036</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AHP7FGH4N2TX5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5046</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A29Y6BVD19FBAE</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5047</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A2VAMUTJ9WGI4P</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5047</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">AP0ABE3ZSEGPC</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5035</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A5U9HUMS31DIR</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5034</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">ABMVPQ5CQFHGS</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5048</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A2BJELRJ9N4NA5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5033</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A2XJRU950S5J87</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5033</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A1FJ2AUFVA4PIW</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5032</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">AMYL22GHCON9A</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5050</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A33V10XAI3IWXS</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5031</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A3P9YDDTO87QGZ</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5031</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A1M7SLIGEI3IH5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5030</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A3GLUDQZGEJL5G</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5029</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AWZ3AH7JH0DRO</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5029</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A3ULFB0PQ1471E</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5028</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AVG2BI8CS5YKX</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5028</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A36JU4ZU054BRK</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5026</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A11C7PRG75IWO0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5025</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A3CWWX1NWA00S3</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5022</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A1RCM1Y87J0FGW</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5068</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A1WNHQEMEHNCPT</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5008</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A2BNOEYZ3VRW2R</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5003</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">AM7UBKT777C3R</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4998</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A2I6WWFA5KE0MS</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4989</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">AA8O3Z9L0FSW1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5098</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AER86HM7LU5G</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5111</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A32WFJGJ0VUKOO</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4955</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A2L6GS9A2MMQK4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5131</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A1WURYN1U64Y1T</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4947</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A3NMC1E54BML7K</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5150</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">ARGHS9P7FVR3W</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5151</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AEX85SLEN727</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5152</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A2VCTDV17CKH2X</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5156</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A3BFHFBYDCCIGV</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4924</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A2BJ35SLVKCUL7</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5166</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A1RE0RBV10VAVC</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5168</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A3OQ1JKWS02NMF</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5171</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ARNTOT4L28BBP</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5172</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A3T8CCUYDNT61C</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5174</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A23PSX2ZO4F65Q</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5178</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A2EAIMII6MSIO5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5178</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A1SYR0UUMZM2VH</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5179</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A1W079WCHEQKX6</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5180</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A3M0KT6KUJEZD1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5182</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A2I2OHYPL49ZAI</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5184</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A2LFX0LP92GLCQ</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5184</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A2NJGU26SOMOKV</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5184</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A1IWL4WQTKN1PR</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5185</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">ACTW5YEWV9OR0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5185</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A15QI1G4FCMV5E</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5186</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A2TG01V56PAL65</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5186</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A2DGJ8T7C3HMCQ</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5187</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A36TOO4WWGEEPW</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5187</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A39GZHNGT87G5N</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5187</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A3UDP95JGEX3H1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5187</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A1JY8OZHGDL9GR</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5188</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A2AB80GWC0LU0P</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5188</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A2HS4FQ4DR4GIK</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5188</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A2XPQ8KYFKI6FD</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5188</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AOZ06WXWI630</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5188</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A127R5QI5OGBIK</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5189</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A35QV79054LGTU</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5189</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A3QJPB0NZU5PY1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5189</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A8L4UTQ8RXDFS</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5189</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A3SWH7DHWHP0BO</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5191</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A5FJBKJ8K5I6S</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5191</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">AWZ83IBW10B96</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5191</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A26LA7PUZG0N8S</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5192</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A2XKIJJPWTOQ5Z</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5192</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A117RW2F1MNBQ8</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5193</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A1H314LD953G5Q</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5193</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A1JBTEJN14MFFA</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5193</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A1U1QL617G5DU3</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5193</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ANL7UI5ES4L18</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5193</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">AZTDJC8RWO5C5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5193</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A11KMPAZSE5Q0Q</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5194</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A1LDS7FXQNGLEN</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5194</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AK7YVYGMIF6T0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5194</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">AK9FN3FCOY9Q2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5194</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A14N0AMVXOBZYH</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5195</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A1RWNYJA5X25YH</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5195</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A1WXZPUAXDE0DQ</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5195</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A21L2ZM379FG7</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5196</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A2GNS1SQLQNMR2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5196</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A2RPQGUWVZPX7U</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5196</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A3CT5E0WZJL8PG</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4783</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A25OW5OQG4B8FR</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4688</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A14WWG6NKBDWGP</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4416</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">AWMGC78CSF6YL</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3953</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A2FZ90AHSTSHXA</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3629</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A11GA4B4SEYK44</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4207</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A2OIFE4TAQ7AEI</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4134</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A2PE5UDQ5WG2R0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4119</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AY1ZVSTHEQDH8</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4118</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">ASOBUAZ0IQYSJ</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4111</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A1S8D4HVA9HI0X</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4110</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A3TK9CLBA65ZZE</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4110</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AOVB3KCIIJLRJ</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4110</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">ACYV5TUADOWEA</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4109</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A2O7F23PZP1T9B</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4103</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A21TTUZSQ5ZE6C</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4091</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A38NIARZOSEVUG</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4089</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A1FNEVG87BS5K0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4076</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A1J8TVICSRC70W</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4067</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A1SVVVJWT7H51V</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4064</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ACB0CSL0QMRGQ</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4061</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A37PQ1206C9RZP</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4056</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A253Q11TZPQPIZ</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4047</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A289P9QG98HRAZ</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4045</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A279TEENVAAZNB</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4042</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A29FWCDRAWIM8K</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4038</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A2V1ZN7OXOH7J4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4033</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A7MOPEHSUGVQ</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4028</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A2JKCS6UCAUARS</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3812</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">ANDPWG91K8OEX</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3799</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A5E076UK5CA9J</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3417</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A2068Z6G94OAGH</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3113</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A3S82OHUGFBR7L</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3110</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A1GAARR4GOOZCO</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3097</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A3EZCOCQU4QNCO</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3032</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A98XHW6B1VSSQ</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3027</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A3AA8NU3WAJ3ED</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2263</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">A1P8M5BKOTAA8I</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1510</td>
<td style="text-align: left;">TRUE</td>
</tr>
</tbody>
</table>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Unsorted</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>data_prepared_gpt3d_withresids_sub <span class="ot">&lt;-</span> data_prepared_gpt3d_withresids <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(WorkerId <span class="sc">%in%</span> selected_workers_info<span class="sc">$</span>WorkerId)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Sorted</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>data_resorted_subset <span class="ot">&lt;-</span> data_resorted <span class="sc">%&gt;%</span> </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(WorkerId <span class="sc">%in%</span> selected_workers_info<span class="sc">$</span>WorkerId)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Example comparing the necessity of sorting</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>data_prepared_gpt3d_withresids <span class="sc">%&gt;%</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(resids) <span class="sc">%&gt;%</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  itsadug<span class="sc">::</span><span class="fu">acf_plot</span>(</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">split_by =</span> <span class="fu">list</span>(</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>      data_prepared_gpt3d_withresids<span class="sc">$</span>WorkerId, </span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>      data_prepared_gpt3d_withresids<span class="sc">$</span>story_num),</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_lag =</span> <span class="dv">17</span>,</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">"ACF of GPT3-davinci GAM resids without necessary reodering"</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="make_figures_files/figure-html/plot_example-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>data_resorted_subset <span class="ot">&lt;-</span> data_resorted <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(WorkerId <span class="sc">%in%</span> selected_workers_info<span class="sc">$</span>WorkerId)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>data_resorted_subset <span class="sc">%&gt;%</span> </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(resids) <span class="sc">%&gt;%</span> </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  itsadug<span class="sc">::</span><span class="fu">acf_plot</span>(</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">split_by =</span> <span class="fu">list</span>(</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>      data_resorted_subset<span class="sc">$</span>WorkerId, </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>      data_resorted_subset<span class="sc">$</span>story_num),</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_lag =</span> <span class="dv">17</span>,</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">"ACF of GPT3-davinci GAM resids - correctly reordered"</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="make_figures_files/figure-html/plot_example-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<dl>
<dt>A partial autocorrelation function plotter</dt>
<dd>
In <code>my_pacf_plot.R</code> I modify the code from <code>itsadug::acf_plot()</code> to calculate PACF instead of ACF. That is, it will get mean <code>pacf</code> across splits instead of getting complete <code>acf</code>.
</dd>
</dl>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># defines function `my_pacf_plot`</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"utils/my_pacf_plot.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>plot_avg_ACF <span class="ot">&lt;-</span> <span class="cf">function</span>(all_ACF, <span class="at">with.sem =</span> F, <span class="at">ylim=</span><span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">1</span>), <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)){</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For plotting aggregated [p]acf with input `all_ACF &lt;- plot_[p]acf( _ , return_all=T)`</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mean with sem bars.</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  ci <span class="ot">&lt;-</span> <span class="fl">0.95</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  with.ci <span class="ot">&lt;-</span> T</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  ci.col <span class="ot">&lt;-</span> <span class="st">'blue'</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  plot_df <span class="ot">&lt;-</span> all_ACF<span class="sc">$</span>dataframe <span class="sc">%&gt;%</span> </span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(lag) <span class="sc">%&gt;%</span> </span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean =</span> <span class="fu">mean</span>(acf),</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">sd =</span> <span class="fu">sd</span>(acf),</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">sem =</span> sd <span class="sc">/</span> <span class="fu">sqrt</span>(n),</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">sem.upper =</span> mean <span class="sc">+</span> <span class="fu">qnorm</span>((<span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.95</span>)<span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> sem,</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">sem.lower =</span> mean <span class="sc">-</span> <span class="fu">qnorm</span>((<span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.95</span>)<span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> sem,</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_ci =</span> <span class="fu">mean</span>(ci), <span class="co"># with default ci.type= "white" these are all the same value</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(mean)</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>  clim <span class="ot">&lt;-</span> plot_df<span class="sc">$</span>mean_ci[[<span class="dv">1</span>]]</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> plot_df <span class="sc">%&gt;%</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lag, <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymax =</span> mean, <span class="at">ymin=</span><span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lims</span>(<span class="at">y =</span> <span class="fu">as.numeric</span>(ylim),</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="fu">as.numeric</span>(xlim))</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (with.ci) {</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span><span class="sc">-</span>clim, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> ci.col) <span class="sc">+</span></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span><span class="sc">+</span>clim, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> ci.col)</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (with.sem) {</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_linerange</span>(</span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">ymin =</span> sem.lower, <span class="at">ymax =</span> sem.upper), </span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">linewidth =</span> <span class="dv">3</span>, <span class="at">alpha=</span><span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"red"</span>) </span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(p)</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Comparison of plotting functions for sanity</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>data_resorted_subset_resids_ACF <span class="ot">&lt;-</span> itsadug<span class="sc">::</span><span class="fu">acf_plot</span>(</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  data_resorted_subset<span class="sc">$</span>resids,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">split_by =</span> <span class="fu">list</span>(</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    data_resorted_subset<span class="sc">$</span>subject,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    data_resorted_subset<span class="sc">$</span>story_num),</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot =</span> T,</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">return_all =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="make_figures_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>data_resorted_subset_resids_PACF <span class="ot">&lt;-</span> <span class="fu">my_pacf_plot</span>(</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  data_resorted_subset<span class="sc">$</span>resids,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">split_by =</span> <span class="fu">list</span>(</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    data_resorted_subset<span class="sc">$</span>subject,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    data_resorted_subset<span class="sc">$</span>story_num),</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot =</span> T,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">return_all =</span> T, <span class="at">main=</span><span class="st">"Partial ACF"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="make_figures_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For comparison</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_avg_ACF</span>(data_resorted_subset_resids_ACF) <span class="sc">+</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Mean ACF of residuals across stories, and subjects"</span>,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"GPT3-davinci"</span>,</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Lag"</span>, </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span><span class="st">"mean ACF"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="make_figures_files/figure-html/unnamed-chunk-16-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_avg_ACF</span>(data_resorted_subset_resids_PACF) <span class="sc">+</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Mean PACF of residuals across stories, and subjects"</span>,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"GPT3-davinci"</span>,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Lag"</span>, </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span><span class="st">"mean Partial ACF"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="make_figures_files/figure-html/unnamed-chunk-16-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot ACF mean and 95%CI</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_avg_ACF</span>(data_resorted_subset_resids_ACF, <span class="at">with.sem =</span> T) <span class="sc">+</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"ACF of residuals"</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Mean across stories, subjects; GPT3-davinci"</span>,</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Lag"</span>,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span><span class="st">"mean ACF"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="make_figures_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="do">### FIG FOR PAPER</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="fu">paste0</span>(figsdir, <span class="st">"gpt3d_ACF"</span>, <span class="st">".pdf"</span>),</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">4</span>, <span class="at">height =</span> <span class="dv">3</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_avg_ACF</span>(data_resorted_subset_resids_PACF, <span class="at">with.sem =</span> T) <span class="sc">+</span> </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"PACF of residuals"</span>,</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Mean across stories, subjects;  GPT3-davinci"</span>,</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Lag"</span>, </span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span><span class="st">"mean Partial ACF"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="make_figures_files/figure-html/unnamed-chunk-17-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="do">### FIG FOR PAPER</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="fu">paste0</span>(figsdir, <span class="st">"gpt3d_PACF"</span>, <span class="st">".pdf"</span>),</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">4</span>, <span class="at">height =</span> <span class="dv">3</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_avg_ACF</span>(data_resorted_subset_resids_PACF, <span class="at">with.sem =</span> T, <span class="at">ylim=</span><span class="fu">c</span>(<span class="cn">NA</span>,<span class="cn">NA</span>)) <span class="sc">+</span> </span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"PACF of residuals"</span>,</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Mean across stories, subjects;  GPT3-davinci"</span>,</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Lag"</span>, </span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span><span class="st">"mean Partial ACF"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="make_figures_files/figure-html/unnamed-chunk-17-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave(</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   filename = paste0(figsdir, "gpt3d_PACF_zoomed", ".pdf"),</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   width = 4, height = 3)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="schematic-diagram" class="level1">
<h1>Schematic diagram</h1>
<p>Make fake data for illustration, where true relationship is superlinear</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>myarrow <span class="ot">&lt;-</span> <span class="fu">arrow</span>(<span class="dv">10</span>, <span class="fu">unit</span>(<span class="dv">4</span>,<span class="st">"mm"</span>), <span class="at">type=</span> <span class="st">"closed"</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># wrapper for stats::rbinom to sample logical bernoulli random variates</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># should be identical to deprecated purrr::rbernoulli</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>rbern <span class="ot">&lt;-</span> <span class="cf">function</span>(n, <span class="at">p =</span> <span class="fl">0.5</span>) {</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.logical</span>(<span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> p))</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>gen_data <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">N=</span><span class="dv">5000</span>, <span class="at">seed =</span> <span class="dv">4</span>){</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  b0 <span class="ot">&lt;-</span> .<span class="dv">9</span>; b1 <span class="ot">&lt;-</span> <span class="sc">-</span>.<span class="dv">11</span>;</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>  lnk <span class="ot">&lt;-</span> <span class="st">"inverse"</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (lnk <span class="sc">==</span> <span class="st">"identity"</span>) {</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>    invlnk <span class="ot">&lt;-</span> <span class="cf">function</span>(eta) eta</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>    lnk_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(mu) mu</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (lnk <span class="sc">==</span> <span class="st">"inverse"</span>) {</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>    invlnk <span class="ot">&lt;-</span> <span class="cf">function</span>(eta) <span class="dv">1</span> <span class="sc">/</span> eta</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>    lnk_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(mu) <span class="dv">1</span> <span class="sc">/</span> mu</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (lnk <span class="sc">==</span> <span class="st">"log"</span>) {</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>    invlnk <span class="ot">&lt;-</span> <span class="cf">function</span>(eta) <span class="fu">exp</span>(eta)</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>    lnk_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(mu) <span class="fu">log</span>(mu)</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>  shape <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>  x<span class="ot">&lt;-</span><span class="fu">rlnorm</span>(N,<span class="at">meanlog=</span><span class="sc">-</span><span class="dv">1</span>,<span class="at">sdlog=</span><span class="fl">0.8</span>)</span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># x&lt;-runif(N, 0,8)</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># x&lt;-seq(0,8,8/(N-1))</span></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>  y_true <span class="ot">=</span> <span class="fu">invlnk</span>(b0 <span class="sc">+</span> b1 <span class="sc">*</span> x) <span class="co"># function of the linear expression</span></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># y_true = 1/(b0+b1*x)</span></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>  df<span class="ot">&lt;-</span><span class="fu">data.frame</span>(</span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>    x,</span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>    y_true,</span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">y.1 =</span> <span class="dv">300</span> <span class="sc">+</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">rgamma</span>(N, <span class="at">rate =</span> <span class="fl">1.30</span> <span class="sc">*</span> shape <span class="sc">/</span> y_true, <span class="at">shape =</span> shape),</span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">y.2 =</span> <span class="dv">300</span> <span class="sc">+</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">rgamma</span>(N, <span class="at">rate =</span> <span class="fl">1.70</span> <span class="sc">*</span> shape <span class="sc">/</span> y_true, <span class="at">shape =</span> shape),</span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">y.3 =</span> <span class="dv">300</span> <span class="sc">+</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">rgamma</span>(N, <span class="at">rate =</span> <span class="fl">1.08</span> <span class="sc">*</span> shape <span class="sc">/</span> y_true, <span class="at">shape =</span> shape),</span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">y.4 =</span> <span class="dv">300</span> <span class="sc">+</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">rgamma</span>(N, <span class="at">rate =</span> <span class="fl">1.09</span> <span class="sc">*</span> shape <span class="sc">/</span> y_true, <span class="at">shape =</span> shape),</span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">y.5 =</span> <span class="dv">300</span> <span class="sc">+</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">rgamma</span>(N, <span class="at">rate =</span> <span class="fl">1.10</span> <span class="sc">*</span> shape <span class="sc">/</span> y_true, <span class="at">shape =</span> shape)</span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(</span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">starts_with</span>(<span class="st">"y."</span>), </span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_to =</span> <span class="st">"subj"</span>, <span class="at">values_to =</span> <span class="st">"y_obs"</span>, <span class="at">names_prefix =</span> <span class="st">"y."</span>) <span class="sc">%&gt;%</span></span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">subj=</span><span class="fu">factor</span>(subj))</span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rm(x,y_true)</span></span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">gen_data</span>()</span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(x,y_obs,<span class="at">color=</span>subj), <span class="at">alpha=</span>.<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span><span class="dv">300</span><span class="sc">+</span><span class="dv">100</span><span class="sc">*</span>y_true),<span class="at">shape=</span><span class="dv">1</span>,<span class="at">size=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="make_figures_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Modify to (mostly) overestimate some surprisals</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>df_modified <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>y_true) <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>subj, <span class="at">values_from=</span>y_obs) <span class="sc">%&gt;%</span> </span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">selected=</span><span class="fu">rbern</span>(<span class="fu">nrow</span>(.), <span class="at">p=</span><span class="fl">0.004</span>),</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">x0 =</span> x,</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="fu">if_else</span>(selected, <span class="fu">max</span>(x0)<span class="sc">*</span><span class="fu">rbeta</span>(<span class="fu">nrow</span>(.),<span class="dv">1</span>,<span class="dv">1</span>),x0)) <span class="sc">%&gt;%</span> </span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span>,<span class="st">`</span><span class="at">2</span><span class="st">`</span>,<span class="st">`</span><span class="at">3</span><span class="st">`</span>,<span class="st">`</span><span class="at">4</span><span class="st">`</span>,<span class="st">`</span><span class="at">5</span><span class="st">`</span>), <span class="at">names_to =</span> <span class="st">"subj"</span>, <span class="at">values_to =</span> <span class="st">"y_obs"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subj =</span> <span class="fu">factor</span>(subj)) <span class="sc">%&gt;%</span> </span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(<span class="sc">~!</span><span class="fu">is.numeric</span>(.)),factor))</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>df_modified_longer <span class="ot">&lt;-</span> df_modified <span class="sc">%&gt;%</span> </span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>subj, <span class="at">values_from=</span>y_obs) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Modified surprisals</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Plotted against response</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>df_modified_longer <span class="sc">%&gt;%</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x0,<span class="at">y=</span>x0,<span class="at">alpha=</span>selected,<span class="at">shape=</span>selected)) <span class="sc">+</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data=</span>df_modified_longer <span class="sc">%&gt;%</span> <span class="fu">filter</span>(selected<span class="sc">==</span><span class="cn">TRUE</span>), </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">yend=</span>x0, <span class="at">xend=</span>x), </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> myarrow,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha=</span><span class="fl">0.5</span>, <span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="make_figures_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>df_modified <span class="sc">%&gt;%</span> </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x0,<span class="at">y=</span>y_obs,<span class="at">alpha=</span>selected, <span class="at">color=</span>subj)) <span class="sc">+</span> </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data=</span>df_modified <span class="sc">%&gt;%</span> <span class="fu">filter</span>(selected<span class="sc">==</span><span class="cn">TRUE</span>), </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">yend=</span>y_obs, <span class="at">xend=</span>x),</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> myarrow,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="make_figures_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
<section id="fit-gams" class="level3">
<h3 class="anchored" data-anchor-id="fit-gams">Fit GAMs</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># GAM formula</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> y_obs <span class="sc">~</span>  <span class="fu">s</span>(x, <span class="at">k=</span><span class="dv">6</span>) <span class="sc">+</span> <span class="fu">s</span>(x, subj, <span class="at">bs=</span><span class="st">"fs"</span>, <span class="at">m=</span><span class="dv">1</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>m  <span class="ot">&lt;-</span> mgcv<span class="sc">::</span><span class="fu">gam</span>(<span class="at">formula =</span> f, <span class="at">data=</span>df)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>m_ <span class="ot">&lt;-</span> mgcv<span class="sc">::</span><span class="fu">gam</span>(<span class="at">formula =</span> f, <span class="at">data=</span>df_modified)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="plot" class="level3">
<h3 class="anchored" data-anchor-id="plot">Plot</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Could plot with gratia</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co"># patchwork::wrap_plots(</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   gratia::draw(m, residuals = F, select = 1, rug=F),</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   gratia::draw(m_, residuals = F, select = 1, rug=F), nrow = 2)</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="do">## But just get ests out instead, so we can plot them together</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>ests <span class="ot">&lt;-</span> gratia<span class="sc">::</span><span class="fu">smooth_estimates</span>(m) <span class="sc">%&gt;%</span> </span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(smooth<span class="sc">==</span><span class="st">"s(x)"</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">est_shifted =</span> est <span class="sc">+</span> <span class="fu">coef</span>(m)[<span class="st">"(Intercept)"</span>])</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>ests_ <span class="ot">&lt;-</span> gratia<span class="sc">::</span><span class="fu">smooth_estimates</span>(m_) <span class="sc">%&gt;%</span> </span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(smooth<span class="sc">==</span><span class="st">"s(x)"</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">est_shifted =</span> est <span class="sc">+</span> <span class="fu">coef</span>(m)[<span class="st">"(Intercept)"</span>])</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"darkblue"</span>, <span class="st">"darkred"</span>)</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hex</span>(<span class="at">data =</span> df_modified, <span class="fu">aes</span>(x,<span class="at">y=</span>y_obs), <span class="at">size=</span><span class="dv">0</span>, <span class="at">bins=</span><span class="dv">200</span>, <span class="at">alpha=</span><span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low=</span><span class="st">"#DDDDDD"</span>,<span class="at">high=</span><span class="st">"black"</span>,<span class="at">guide =</span> <span class="st">"none"</span>)<span class="sc">+</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> ests, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>est_shifted),<span class="at">color=</span>col[<span class="dv">2</span>]) <span class="sc">+</span> </span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ests, </span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>est_shifted, <span class="at">ymin=</span>est_shifted<span class="sc">-</span>se<span class="sc">*</span><span class="fl">1.96</span>, <span class="at">ymax=</span>est_shifted<span class="sc">+</span>se<span class="sc">*</span><span class="fl">1.96</span>), </span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">fill=</span>col[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ests_, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>est_shifted), <span class="at">color =</span> col[<span class="dv">1</span>]) <span class="sc">+</span> </span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ests_, </span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">ymin=</span>est_shifted<span class="sc">-</span>se<span class="sc">*</span><span class="fl">1.96</span>, <span class="at">ymax=</span>est_shifted<span class="sc">+</span>se<span class="sc">*</span><span class="fl">1.96</span>), </span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">fill=</span>col[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_modified <span class="sc">%&gt;%</span> <span class="fu">filter</span>(selected<span class="sc">==</span>T), </span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y_obs),<span class="at">color=</span>col[<span class="dv">1</span>], <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_modified <span class="sc">%&gt;%</span> <span class="fu">filter</span>(selected<span class="sc">==</span>T), </span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x=</span>x0,<span class="at">y=</span>y_obs),<span class="at">color=</span>col[<span class="dv">2</span>], <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_modified <span class="sc">%&gt;%</span> <span class="fu">filter</span>(selected<span class="sc">==</span>T), </span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x0, <span class="at">xend=</span>x,<span class="at">y=</span>y_obs,<span class="at">yend=</span>y_obs), </span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.15</span>, <span class="at">color =</span> col[<span class="dv">3</span>],</span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow=</span><span class="fu">arrow</span>(<span class="at">angle=</span><span class="dv">15</span>, <span class="at">length=</span><span class="fu">unit</span>(<span class="dv">3</span>, <span class="st">"mm"</span>))) <span class="sc">+</span></span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Overestimating surprisal"</span>, </span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle=</span><span class="st">"schematic illustration"</span>, <span class="at">y=</span><span class="st">"RT"</span>,<span class="at">x=</span><span class="st">"surprisal"</span>) <span class="sc">+</span></span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="cn">NA</span>,<span class="dv">620</span>) <span class="sc">+</span></span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># xkcd::xkcdaxis(range(df_modified$x),c(300,620)) +</span></span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(), <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(), <span class="at">axis.line =</span> <span class="fu">element_line</span>(),</span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="make_figures_files/figure-html/plot-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(figsdir, <span class="st">"sketch.pdf"</span>),</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">5</span>, <span class="at">height =</span> <span class="fl">4.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="sampling-analysis" class="level1">
<h1>Sampling analysis</h1>
<div class="cell">
<details open="">
<summary>Options</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Whether to sample weights or use weights equidistributed on the inverse CDF</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>get_weights <span class="ot">&lt;-</span> <span class="st">"sample"</span> <span class="co"># or "equidistributed_inv_CDF"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting functions</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>prepare_to_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"variance"</span>), <span class="sc">~</span><span class="fu">log</span>(<span class="fu">sqrt</span>(.))</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>                  <span class="co">#, .names = "logsqrt{col}" # uncomment to not modify in place</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>                  )) <span class="sc">%&gt;%</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">cols =</span> <span class="fu">matches</span>(<span class="st">"empirical|theoretical"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">separate</span>(name, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"moment"</span>, <span class="st">"type"</span>), <span class="at">sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), forcats<span class="sc">::</span>as_factor)) <span class="sc">%&gt;%</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">surprisal =</span> <span class="sc">-</span><span class="fu">log</span>(normalized_weight)) <span class="sc">%&gt;%</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(type))</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>make_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>  df_prepared <span class="ot">&lt;-</span> <span class="fu">prepare_to_plot</span>(df)</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rename "empirical" -&gt; "simulated"</span></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>  df_prepared<span class="sc">$</span>type <span class="ot">&lt;-</span> df_prepared<span class="sc">$</span>type <span class="sc">%&gt;%</span></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">recode_factor</span>(<span class="at">empirical =</span> <span class="st">"simulated"</span>)</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>  df_prepared <span class="sc">%&gt;%</span></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> surprisal, <span class="at">y =</span> value,</span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> type, <span class="at">color =</span> type,</span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">shape =</span> type, <span class="at">size =</span> type, <span class="at">alpha =</span> type)) <span class="sc">+</span></span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(</span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">rows =</span> <span class="fu">vars</span>(moment), <span class="at">scale =</span> <span class="st">"free"</span>, <span class="at">switch =</span> <span class="st">"y"</span>,</span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">labeller =</span> <span class="fu">as_labeller</span>(</span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(<span class="at">mean =</span> <span class="st">"mean #samples"</span>, <span class="at">variance =</span> <span class="st">"log(sd #samples)"</span>))) <span class="sc">+</span></span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(</span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">values =</span> <span class="fu">c</span>(<span class="at">simulated =</span> <span class="st">"darkgray"</span>, <span class="at">theoretical =</span> <span class="st">"darkblue"</span>)) <span class="sc">+</span></span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_shape_manual</span>(</span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">values =</span> <span class="fu">c</span>(<span class="at">simulated =</span> <span class="dv">4</span>, <span class="at">theoretical =</span> <span class="dv">16</span>)) <span class="sc">+</span></span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_size_manual</span>(</span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">values =</span> <span class="fu">c</span>(<span class="at">simulated =</span> <span class="dv">3</span>, <span class="at">theoretical =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">simulated =</span> .<span class="dv">5</span>, <span class="at">theoretical =</span> .<span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="co">#legend.position = c(.2,.8),</span></span>
<span id="cb58-38"><a href="#cb58-38" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.background =</span> <span class="fu">element_rect</span>(</span>
<span id="cb58-39"><a href="#cb58-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">fill =</span> <span class="fu">alpha</span>(<span class="st">"white"</span>, <span class="fl">0.5</span>), <span class="at">color =</span> <span class="fu">alpha</span>(<span class="st">"white"</span>, <span class="fl">0.5</span>)),</span>
<span id="cb58-40"><a href="#cb58-40" aria-hidden="true" tabindex="-1"></a>          <span class="co"># legend.direction="horizontal",</span></span>
<span id="cb58-41"><a href="#cb58-41" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.placement =</span> <span class="st">"outside"</span>,</span>
<span id="cb58-42"><a href="#cb58-42" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb58-43"><a href="#cb58-43" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb58-44"><a href="#cb58-44" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>suffix <span class="ot">&lt;-</span> <span class="cf">if</span> (get_weights <span class="sc">==</span> <span class="st">"sample"</span>) <span class="st">""</span> <span class="cf">else</span> <span class="st">"_equidistant"</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>swor <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"sampling_simulated/plot_swor_runtime"</span>, suffix, <span class="st">"_df.csv"</span>),</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>swr <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"sampling_simulated/plot_swr_runtime"</span>, suffix, <span class="st">"_df.csv"</span>),</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>p_swor <span class="ot">&lt;-</span> <span class="fu">make_plot</span>(swor)</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>p_swr <span class="ot">&lt;-</span> <span class="fu">make_plot</span>(swr)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>p_swor <span class="sc">+</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Runtime of guessing without replacement"</span>,</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Pareto-distributed weights"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="make_figures_files/figure-html/generate_plots-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="fu">paste0</span>(figsdir, <span class="st">"pareto"</span>, suffix, <span class="st">"_swor.pdf"</span>),</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">4</span>, <span class="at">width =</span> <span class="dv">5</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>p_swr <span class="sc">+</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Runtime of guessing with replacement"</span>,</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Pareto-distributed weights"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="make_figures_files/figure-html/generate_plots-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="fu">paste0</span>(figsdir, <span class="st">"pareto"</span>, suffix, <span class="st">"_swr.pdf"</span>),</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">4</span>, <span class="at">width =</span> <span class="dv">5</span>)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="fu">wrap_plots</span>(</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    p_swr <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Guessing with replacement"</span>),</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    p_swor <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Guessing without replacement"</span>),</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">&amp;</span> <span class="co">#theme(legend.position = "right") &amp;</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Runtime mean and variance of guessing algorithms"</span>,</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Pareto-distributed weights"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="make_figures_files/figure-html/generate_plots-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="fu">paste0</span>(figsdir, <span class="st">"pareto"</span>, suffix, <span class="st">"_swr_swor"</span>, <span class="st">".pdf"</span>),</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">4</span>, <span class="at">width =</span> <span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    if (id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        return container.innerHTML
      } else {
        return note.innerHTML;
      }
    } else {
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      try { hash = new URL(url).hash; } catch {}
      const id = hash.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note !== null) {
        try {
          const html = processXRef(id, note);
          instance.setContent(html);
        } finally {
          instance.enable();
          instance.show();
        }
      } else {
        // See if we can fetch this
        fetch(url.split('#')[0])
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.getElementById(id);
          console.log(htmlDoc.body.innerHTML);
          if (note !== null) {
            const html = processXRef(id, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb63" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Plots"</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "For _The plausibility of sampling as an algorithmic theory of sentence processing_, Open Mind, 2023"</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Jacob Louis Hoover"</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2023-05-15</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf: </span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="co">    fontsize: 10pt</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="co">    monofont: Latin Modern Mono</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="co">    monofontoptions: </span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a><span class="co">      - Scale=0.75</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a><span class="fu"># GAM plots</span></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>::: {.callout-important icon="false" collapse="false"}</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a><span class="fu">### Dependencies</span></span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>external dependencies (R files, will be sourced)</span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a><span class="in">      ./utils/prepare_data.R</span></span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a><span class="in">      ./utils/my_pacf_plot.R</span></span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>data files</span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a><span class="in">      ./data/surprisal_densities.csv</span></span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a><span class="in">      ./data/surprisal_means.csv</span></span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a><span class="in">      ./data/GAM_predictions/data_to_plot_NEW_var0_gauss_wprev_N200.csv</span></span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a><span class="in">      ./data/GAM_predictions/data_to_plot_NEW_var0_gauss_w3prev_N200.csv</span></span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a><span class="in">      ./data/GAM_predictions/data_to_plot_NEW_lin0var_wprev_N200.csv</span></span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a><span class="in">      ./data/GAM_predictions/data_to_plot_NEW_linear_wprevm_N200.csv</span></span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a><span class="in">      ./data/GAM_predictions/data_to_plot_NEW_wprevm_N200.csv</span></span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a><span class="in">      ./data/GAM_predictions/data_to_plot_NEW_datasubsetless6_wprevm_N200.csv</span></span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a><span class="in">      ./data/GAM_predictions/data_to_plot_NEW_datasubsetless12_wprevm_N200.csv</span></span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a><span class="in">      ./data/model-summaries-NEW-linear-wprevm.rds</span></span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>model training data</span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-43"><a href="#cb63-43" aria-hidden="true" tabindex="-1"></a><span class="in">      ./data/surps_lms.RTs.perword.rds</span></span>
<span id="cb63-44"><a href="#cb63-44" aria-hidden="true" tabindex="-1"></a><span class="in">      ./data/surps_lms.RTs.rds</span></span>
<span id="cb63-45"><a href="#cb63-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-46"><a href="#cb63-46" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>model file</span>
<span id="cb63-47"><a href="#cb63-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-48"><a href="#cb63-48" aria-hidden="true" tabindex="-1"></a><span class="in">      ./data/GAM_models/GPT3-davinci.rds</span></span>
<span id="cb63-49"><a href="#cb63-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-50"><a href="#cb63-50" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb63-51"><a href="#cb63-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-52"><a href="#cb63-52" aria-hidden="true" tabindex="-1"></a><span class="in">```{r global_options}</span></span>
<span id="cb63-53"><a href="#cb63-53" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb63-54"><a href="#cb63-54" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: options</span></span>
<span id="cb63-55"><a href="#cb63-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-56"><a href="#cb63-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Where data lives (plot data from GAM fits, etc)</span></span>
<span id="cb63-57"><a href="#cb63-57" aria-hidden="true" tabindex="-1"></a>datadir <span class="ot">&lt;-</span> <span class="st">"./data/"</span></span>
<span id="cb63-58"><a href="#cb63-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-59"><a href="#cb63-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Where to put generated plots</span></span>
<span id="cb63-60"><a href="#cb63-60" aria-hidden="true" tabindex="-1"></a>figsdir <span class="ot">&lt;-</span> <span class="st">"./figures/"</span></span>
<span id="cb63-61"><a href="#cb63-61" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-62"><a href="#cb63-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-63"><a href="#cb63-63" aria-hidden="true" tabindex="-1"></a><span class="fu">## Setup </span></span>
<span id="cb63-64"><a href="#cb63-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-65"><a href="#cb63-65" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup}</span></span>
<span id="cb63-66"><a href="#cb63-66" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb63-67"><a href="#cb63-67" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb63-68"><a href="#cb63-68" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Setup</span></span>
<span id="cb63-69"><a href="#cb63-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-70"><a href="#cb63-70" aria-hidden="true" tabindex="-1"></a><span class="co"># knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())</span></span>
<span id="cb63-71"><a href="#cb63-71" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb63-72"><a href="#cb63-72" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb63-73"><a href="#cb63-73" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb63-74"><a href="#cb63-74" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb63-75"><a href="#cb63-75" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb63-76"><a href="#cb63-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-77"><a href="#cb63-77" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>())</span>
<span id="cb63-78"><a href="#cb63-78" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_update</span>(<span class="at">plot.title.position =</span> <span class="st">"plot"</span>)</span>
<span id="cb63-79"><a href="#cb63-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-80"><a href="#cb63-80" aria-hidden="true" tabindex="-1"></a><span class="do">## Names</span></span>
<span id="cb63-81"><a href="#cb63-81" aria-hidden="true" tabindex="-1"></a>context_len_labs <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb63-82"><a href="#cb63-82" aria-hidden="true" tabindex="-1"></a>  <span class="at">max =</span> <span class="st">"maximum"</span>,</span>
<span id="cb63-83"><a href="#cb63-83" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">80</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"80 words"</span>,</span>
<span id="cb63-84"><a href="#cb63-84" aria-hidden="true" tabindex="-1"></a>  <span class="at">bysent =</span> <span class="st">"within sent."</span></span>
<span id="cb63-85"><a href="#cb63-85" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-86"><a href="#cb63-86" aria-hidden="true" tabindex="-1"></a>est_type_labs <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb63-87"><a href="#cb63-87" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> <span class="st">"mean"</span>,</span>
<span id="cb63-88"><a href="#cb63-88" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> <span class="st">"variance"</span></span>
<span id="cb63-89"><a href="#cb63-89" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-90"><a href="#cb63-90" aria-hidden="true" tabindex="-1"></a>term_labs <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb63-91"><a href="#cb63-91" aria-hidden="true" tabindex="-1"></a>  <span class="at">surprisal =</span> <span class="st">"surprisal (on mean)"</span>,</span>
<span id="cb63-92"><a href="#cb63-92" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">surprisal.1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"surprisal (on log sd)"</span></span>
<span id="cb63-93"><a href="#cb63-93" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-94"><a href="#cb63-94" aria-hidden="true" tabindex="-1"></a>model_labs <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb63-95"><a href="#cb63-95" aria-hidden="true" tabindex="-1"></a>  <span class="at">boyce_ngram =</span> <span class="st">"n-gram"</span>,</span>
<span id="cb63-96"><a href="#cb63-96" aria-hidden="true" tabindex="-1"></a>  <span class="at">boyce_grnn =</span> <span class="st">"LSTM"</span>,</span>
<span id="cb63-97"><a href="#cb63-97" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TXL"</span> <span class="ot">=</span> <span class="st">"TXL"</span>,</span>
<span id="cb63-98"><a href="#cb63-98" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT2"</span> <span class="ot">=</span> <span class="st">"GPT2"</span>,</span>
<span id="cb63-99"><a href="#cb63-99" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT2-large"</span> <span class="ot">=</span> <span class="st">"GPT2-large"</span>,</span>
<span id="cb63-100"><a href="#cb63-100" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT2-xl"</span> <span class="ot">=</span> <span class="st">"GPT2-xl"</span>,</span>
<span id="cb63-101"><a href="#cb63-101" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT-Neo"</span> <span class="ot">=</span> <span class="st">"GPT-Neo"</span>,</span>
<span id="cb63-102"><a href="#cb63-102" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT-J"</span> <span class="ot">=</span> <span class="st">"GPT-J"</span>,</span>
<span id="cb63-103"><a href="#cb63-103" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT3-ada"</span> <span class="ot">=</span> <span class="st">"GPT3-ada"</span>,</span>
<span id="cb63-104"><a href="#cb63-104" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT3-curie"</span> <span class="ot">=</span> <span class="st">"GPT3-curie"</span>,</span>
<span id="cb63-105"><a href="#cb63-105" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT3-davinci"</span> <span class="ot">=</span> <span class="st">"GPT3-davinci"</span></span>
<span id="cb63-106"><a href="#cb63-106" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-107"><a href="#cb63-107" aria-hidden="true" tabindex="-1"></a>lm_names <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb63-108"><a href="#cb63-108" aria-hidden="true" tabindex="-1"></a>  <span class="st">"boyce_ngram"</span>, <span class="st">"boyce_grnn"</span>,</span>
<span id="cb63-109"><a href="#cb63-109" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TXL"</span>,</span>
<span id="cb63-110"><a href="#cb63-110" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT2"</span>,</span>
<span id="cb63-111"><a href="#cb63-111" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT2-large"</span>,</span>
<span id="cb63-112"><a href="#cb63-112" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT2-xl"</span>,</span>
<span id="cb63-113"><a href="#cb63-113" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT-Neo"</span>,</span>
<span id="cb63-114"><a href="#cb63-114" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT-J"</span>,</span>
<span id="cb63-115"><a href="#cb63-115" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT3-ada"</span>,</span>
<span id="cb63-116"><a href="#cb63-116" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT3-curie"</span>,</span>
<span id="cb63-117"><a href="#cb63-117" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GPT3-davinci"</span></span>
<span id="cb63-118"><a href="#cb63-118" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">set_names</span>(., .)</span>
<span id="cb63-119"><a href="#cb63-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-120"><a href="#cb63-120" aria-hidden="true" tabindex="-1"></a><span class="do">## Utils</span></span>
<span id="cb63-121"><a href="#cb63-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-122"><a href="#cb63-122" aria-hidden="true" tabindex="-1"></a>separate_modelnames <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">modelnames_colname =</span> model, <span class="at">names =</span> lm_names) {</span>
<span id="cb63-123"><a href="#cb63-123" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb63-124"><a href="#cb63-124" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">separate</span>({{modelnames_colname}},</span>
<span id="cb63-125"><a href="#cb63-125" aria-hidden="true" tabindex="-1"></a>             <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"model"</span>, <span class="st">"by"</span>), <span class="at">sep =</span> <span class="st">"_"</span>, <span class="at">extra =</span> <span class="st">"merge"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-126"><a href="#cb63-126" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">ifelse</span>(model <span class="sc">==</span> <span class="st">"boyce"</span>, <span class="fu">paste0</span>(<span class="st">"boyce_"</span>, by), model)) <span class="sc">%&gt;%</span></span>
<span id="cb63-127"><a href="#cb63-127" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">context_len =</span> <span class="fu">ifelse</span>(</span>
<span id="cb63-128"><a href="#cb63-128" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(by), <span class="st">"max"</span>, <span class="fu">ifelse</span>(stringr<span class="sc">::</span><span class="fu">str_starts</span>(model, <span class="st">"boyce"</span>), <span class="st">"bysent"</span>, by))</span>
<span id="cb63-129"><a href="#cb63-129" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>by) <span class="sc">%&gt;%</span></span>
<span id="cb63-130"><a href="#cb63-130" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">context_len =</span> forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(context_len, <span class="fu">c</span>(<span class="st">"max"</span>)),</span>
<span id="cb63-131"><a href="#cb63-131" aria-hidden="true" tabindex="-1"></a>           <span class="at">model =</span> forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(model, lm_names))</span>
<span id="cb63-132"><a href="#cb63-132" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-133"><a href="#cb63-133" aria-hidden="true" tabindex="-1"></a><span class="co"># for nicer plot labels</span></span>
<span id="cb63-134"><a href="#cb63-134" aria-hidden="true" tabindex="-1"></a>my_labeller <span class="ot">&lt;-</span> <span class="fu">labeller</span>(</span>
<span id="cb63-135"><a href="#cb63-135" aria-hidden="true" tabindex="-1"></a>  <span class="at">context_len =</span> context_len_labs,</span>
<span id="cb63-136"><a href="#cb63-136" aria-hidden="true" tabindex="-1"></a>  <span class="at">term =</span> term_labs,</span>
<span id="cb63-137"><a href="#cb63-137" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> model_labs,</span>
<span id="cb63-138"><a href="#cb63-138" aria-hidden="true" tabindex="-1"></a>  <span class="at">est_type=</span><span class="fu">c</span>(<span class="at">mean=</span><span class="st">"mean RT"</span>, <span class="at">var=</span>glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"log(sd RT)"</span>)))</span>
<span id="cb63-139"><a href="#cb63-139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-140"><a href="#cb63-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-143"><a href="#cb63-143" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb63-144"><a href="#cb63-144" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb63-145"><a href="#cb63-145" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Options#| </span></span>
<span id="cb63-146"><a href="#cb63-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-147"><a href="#cb63-147" aria-hidden="true" tabindex="-1"></a><span class="co"># Whether to only plot two context lengths or all three</span></span>
<span id="cb63-148"><a href="#cb63-148" aria-hidden="true" tabindex="-1"></a>twocontexts <span class="ot">&lt;-</span> <span class="cn">TRUE</span> <span class="co"># (re-run notebook after modifying)</span></span>
<span id="cb63-149"><a href="#cb63-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-150"><a href="#cb63-150" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (twocontexts) {</span>
<span id="cb63-151"><a href="#cb63-151" aria-hidden="true" tabindex="-1"></a>  context_lens <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"max"</span>, <span class="st">"bysent"</span>)</span>
<span id="cb63-152"><a href="#cb63-152" aria-hidden="true" tabindex="-1"></a>  context_pref <span class="ot">&lt;-</span> <span class="st">"2"</span></span>
<span id="cb63-153"><a href="#cb63-153" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb63-154"><a href="#cb63-154" aria-hidden="true" tabindex="-1"></a>  context_lens <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"max"</span>, <span class="st">"80"</span>, <span class="st">"bysent"</span>)</span>
<span id="cb63-155"><a href="#cb63-155" aria-hidden="true" tabindex="-1"></a>  context_pref <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb63-156"><a href="#cb63-156" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-157"><a href="#cb63-157" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-158"><a href="#cb63-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-159"><a href="#cb63-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-160"><a href="#cb63-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-161"><a href="#cb63-161" aria-hidden="true" tabindex="-1"></a><span class="fu">## GAM smooths</span></span>
<span id="cb63-162"><a href="#cb63-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-163"><a href="#cb63-163" aria-hidden="true" tabindex="-1"></a>Plotting the fits of GAM smooths for effect of surprisal on mean and variance in RT.</span>
<span id="cb63-164"><a href="#cb63-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-165"><a href="#cb63-165" aria-hidden="true" tabindex="-1"></a><span class="fu">### Load data</span></span>
<span id="cb63-166"><a href="#cb63-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-167"><a href="#cb63-167" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load_data_to_plot}</span></span>
<span id="cb63-168"><a href="#cb63-168" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb63-169"><a href="#cb63-169" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb63-170"><a href="#cb63-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-171"><a href="#cb63-171" aria-hidden="true" tabindex="-1"></a>load_in_data<span class="ot">&lt;-</span> <span class="cf">function</span>(f, <span class="at">with_est_types =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb63-172"><a href="#cb63-172" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(f,</span>
<span id="cb63-173"><a href="#cb63-173" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_names =</span> <span class="cn">TRUE</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-174"><a href="#cb63-174" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">context_len =</span> forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(context_len, <span class="fu">c</span>(<span class="st">"max"</span>)),</span>
<span id="cb63-175"><a href="#cb63-175" aria-hidden="true" tabindex="-1"></a>           <span class="at">model =</span> forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(model, lm_names))</span>
<span id="cb63-176"><a href="#cb63-176" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (with_est_types) d <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">est_type =</span> <span class="fu">factor</span>(est_type))</span>
<span id="cb63-177"><a href="#cb63-177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(d)</span>
<span id="cb63-178"><a href="#cb63-178" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-179"><a href="#cb63-179" aria-hidden="true" tabindex="-1"></a><span class="co"># get surprisal means and densities </span></span>
<span id="cb63-180"><a href="#cb63-180" aria-hidden="true" tabindex="-1"></a><span class="co"># (from natural-stories-surprisals/EDA_surps_SPRT.Rmd)</span></span>
<span id="cb63-181"><a href="#cb63-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-182"><a href="#cb63-182" aria-hidden="true" tabindex="-1"></a>surprisal_densities <span class="ot">&lt;-</span> <span class="fu">load_in_data</span>(</span>
<span id="cb63-183"><a href="#cb63-183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"surprisal_densities.csv"</span>), <span class="at">with_est_types =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb63-184"><a href="#cb63-184" aria-hidden="true" tabindex="-1"></a>  <span class="co"># there is some odd point at ~37 this makes an unnecessarily long tail</span></span>
<span id="cb63-185"><a href="#cb63-185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> lm_names, surprisal <span class="sc">&lt;</span> <span class="dv">25</span>) </span>
<span id="cb63-186"><a href="#cb63-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-187"><a href="#cb63-187" aria-hidden="true" tabindex="-1"></a>surprisal_means <span class="ot">&lt;-</span> <span class="fu">load_in_data</span>(</span>
<span id="cb63-188"><a href="#cb63-188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"surprisal_means.csv"</span>), <span class="at">with_est_types =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb63-189"><a href="#cb63-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> lm_names)</span>
<span id="cb63-190"><a href="#cb63-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-191"><a href="#cb63-191" aria-hidden="true" tabindex="-1"></a>models_in_desc_PPL_order <span class="ot">&lt;-</span> surprisal_means <span class="sc">%&gt;%</span> </span>
<span id="cb63-192"><a href="#cb63-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(context_len <span class="sc">==</span> <span class="st">"max"</span> <span class="sc">|</span> model <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_starts</span>(<span class="st">"boyce"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb63-193"><a href="#cb63-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_surprisal)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(model) <span class="sc">%&gt;%</span> as.vector</span>
<span id="cb63-194"><a href="#cb63-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-195"><a href="#cb63-195" aria-hidden="true" tabindex="-1"></a><span class="co"># GAMs fit for paper (using fitdata=surps_lms.RTs.rds, and correct lagging)</span></span>
<span id="cb63-196"><a href="#cb63-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-197"><a href="#cb63-197" aria-hidden="true" tabindex="-1"></a><span class="co"># smooth0var: nonlinear gaussian models with constant variance</span></span>
<span id="cb63-198"><a href="#cb63-198" aria-hidden="true" tabindex="-1"></a>data_to_plot_var0_gauss_wprev <span class="ot">&lt;-</span> <span class="fu">load_in_data</span>(</span>
<span id="cb63-199"><a href="#cb63-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"GAM_predictions/data_to_plot_NEW_var0_gauss_wprev_N200.csv"</span>))</span>
<span id="cb63-200"><a href="#cb63-200" aria-hidden="true" tabindex="-1"></a>data_to_plot_var0_gauss_w3prev <span class="ot">&lt;-</span> <span class="fu">load_in_data</span>(</span>
<span id="cb63-201"><a href="#cb63-201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"GAM_predictions/data_to_plot_NEW_var0_gauss_w3prev_N200.csv"</span>))</span>
<span id="cb63-202"><a href="#cb63-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-203"><a href="#cb63-203" aria-hidden="true" tabindex="-1"></a><span class="do">##### Linear control with constant variance, with previous, with family=gaulss()</span></span>
<span id="cb63-204"><a href="#cb63-204" aria-hidden="true" tabindex="-1"></a>data_to_plot_lin0var_wprev <span class="ot">&lt;-</span> <span class="fu">load_in_data</span>(</span>
<span id="cb63-205"><a href="#cb63-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"GAM_predictions/data_to_plot_NEW_lin0var_wprev_N200.csv"</span>))</span>
<span id="cb63-206"><a href="#cb63-206" aria-hidden="true" tabindex="-1"></a><span class="do">##### Linear control with constant variance, with previous, with family=gaulss()</span></span>
<span id="cb63-207"><a href="#cb63-207" aria-hidden="true" tabindex="-1"></a>data_to_plot_linear_wprevm <span class="ot">&lt;-</span> <span class="fu">load_in_data</span>(</span>
<span id="cb63-208"><a href="#cb63-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"GAM_predictions/data_to_plot_NEW_linear_wprevm_N200.csv"</span>))</span>
<span id="cb63-209"><a href="#cb63-209" aria-hidden="true" tabindex="-1"></a><span class="do">##### Main models: Smooth GAMs with previous surprisal predictors for mean only</span></span>
<span id="cb63-210"><a href="#cb63-210" aria-hidden="true" tabindex="-1"></a>data_to_plot_smooth_wprevm <span class="ot">&lt;-</span> <span class="fu">load_in_data</span>(</span>
<span id="cb63-211"><a href="#cb63-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"GAM_predictions/data_to_plot_NEW_wprevm_N200.csv"</span>))</span>
<span id="cb63-212"><a href="#cb63-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-213"><a href="#cb63-213" aria-hidden="true" tabindex="-1"></a><span class="do">#### As above (Smooth GAMs with previous surprisal for mean), </span></span>
<span id="cb63-214"><a href="#cb63-214" aria-hidden="true" tabindex="-1"></a><span class="do">#### but removing most surprising items</span></span>
<span id="cb63-215"><a href="#cb63-215" aria-hidden="true" tabindex="-1"></a><span class="co"># Note, only for GPT-3 Davinci full-context.</span></span>
<span id="cb63-216"><a href="#cb63-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-217"><a href="#cb63-217" aria-hidden="true" tabindex="-1"></a>data_to_plot_datasubsetless6_smooth_wprevm  <span class="ot">&lt;-</span> <span class="fu">load_in_data</span>(</span>
<span id="cb63-218"><a href="#cb63-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"GAM_predictions/data_to_plot_NEW_datasubsetless6_wprevm_N200.csv"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb63-219"><a href="#cb63-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cutoff =</span> <span class="dv">6</span>)</span>
<span id="cb63-220"><a href="#cb63-220" aria-hidden="true" tabindex="-1"></a>data_to_plot_datasubsetless12_smooth_wprevm <span class="ot">&lt;-</span> <span class="fu">load_in_data</span>(</span>
<span id="cb63-221"><a href="#cb63-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"GAM_predictions/data_to_plot_NEW_datasubsetless12_wprevm_N200.csv"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb63-222"><a href="#cb63-222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cutoff =</span> <span class="dv">12</span>)</span>
<span id="cb63-223"><a href="#cb63-223" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-224"><a href="#cb63-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-225"><a href="#cb63-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-226"><a href="#cb63-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-227"><a href="#cb63-227" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot smooths</span></span>
<span id="cb63-228"><a href="#cb63-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-229"><a href="#cb63-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-232"><a href="#cb63-232" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb63-233"><a href="#cb63-233" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb63-234"><a href="#cb63-234" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb63-235"><a href="#cb63-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-236"><a href="#cb63-236" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb63-237"><a href="#cb63-237" aria-hidden="true" tabindex="-1"></a>    data_to_plot, <span class="at">use_shifted_est=</span><span class="cn">TRUE</span>,</span>
<span id="cb63-238"><a href="#cb63-238" aria-hidden="true" tabindex="-1"></a>    <span class="at">se.mult=</span><span class="fl">1.96</span>, <span class="co"># use approx qnorm(1 - 0.05/2)</span></span>
<span id="cb63-239"><a href="#cb63-239" aria-hidden="true" tabindex="-1"></a>    <span class="at">trans =</span> I, <span class="co">#transform function to apply to the yvalues</span></span>
<span id="cb63-240"><a href="#cb63-240" aria-hidden="true" tabindex="-1"></a>    <span class="at">controls =</span> <span class="cn">NULL</span>,</span>
<span id="cb63-241"><a href="#cb63-241" aria-hidden="true" tabindex="-1"></a>    <span class="at">surp_units =</span> <span class="st">"nats"</span>,</span>
<span id="cb63-242"><a href="#cb63-242" aria-hidden="true" tabindex="-1"></a>    <span class="at">density_df =</span> surprisal_densities,</span>
<span id="cb63-243"><a href="#cb63-243" aria-hidden="true" tabindex="-1"></a>    <span class="at">static_lty =</span> <span class="cn">NULL</span>,</span>
<span id="cb63-244"><a href="#cb63-244" aria-hidden="true" tabindex="-1"></a>    <span class="at">additional_controls =</span> <span class="cn">NULL</span>,</span>
<span id="cb63-245"><a href="#cb63-245" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">"fitted effect</span><span class="sc">\n</span><span class="st">estimate (+ intercept) ±2*SE"</span>,</span>
<span id="cb63-246"><a href="#cb63-246" aria-hidden="true" tabindex="-1"></a>    ...) {</span>
<span id="cb63-247"><a href="#cb63-247" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (surp_units <span class="sc">==</span> <span class="st">"bits"</span>) {</span>
<span id="cb63-248"><a href="#cb63-248" aria-hidden="true" tabindex="-1"></a>    data_to_plot <span class="ot">&lt;-</span> data_to_plot <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">surprisal =</span> surprisal <span class="sc">/</span> <span class="fu">log</span>(<span class="dv">2</span>))</span>
<span id="cb63-249"><a href="#cb63-249" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(controls)) {</span>
<span id="cb63-250"><a href="#cb63-250" aria-hidden="true" tabindex="-1"></a>      controls <span class="ot">&lt;-</span> controls <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">surprisal =</span> surprisal <span class="sc">/</span> <span class="fu">log</span>(<span class="dv">2</span>))</span>
<span id="cb63-251"><a href="#cb63-251" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb63-252"><a href="#cb63-252" aria-hidden="true" tabindex="-1"></a>    xlab <span class="ot">&lt;-</span> <span class="st">"surprisal (bits)"</span>; xbreaks <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="dv">15</span>)</span>
<span id="cb63-253"><a href="#cb63-253" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (surp_units <span class="sc">==</span> <span class="st">"nats"</span>) {</span>
<span id="cb63-254"><a href="#cb63-254" aria-hidden="true" tabindex="-1"></a>    xlab <span class="ot">&lt;-</span> <span class="st">"surprisal (nats)"</span>; xbreaks <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">30</span>, <span class="dv">10</span>)</span>
<span id="cb63-255"><a href="#cb63-255" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-256"><a href="#cb63-256" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (use_shifted_est) data_to_plot <span class="ot">&lt;-</span> <span class="fu">mutate</span>(data_to_plot, <span class="at">est =</span> est_shifted)</span>
<span id="cb63-257"><a href="#cb63-257" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> data_to_plot <span class="sc">%&gt;%</span></span>
<span id="cb63-258"><a href="#cb63-258" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> surprisal, <span class="at">y =</span> <span class="fu">trans</span>(est),</span>
<span id="cb63-259"><a href="#cb63-259" aria-hidden="true" tabindex="-1"></a>               <span class="at">ymin =</span> <span class="fu">trans</span>(est <span class="sc">-</span> se.mult<span class="sc">*</span>se), <span class="at">ymax =</span> <span class="fu">trans</span>(est <span class="sc">+</span> se.mult<span class="sc">*</span>se),</span>
<span id="cb63-260"><a href="#cb63-260" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> context_len))</span>
<span id="cb63-261"><a href="#cb63-261" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(controls)) {</span>
<span id="cb63-262"><a href="#cb63-262" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add in linear data</span></span>
<span id="cb63-263"><a href="#cb63-263" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (use_shifted_est) controls <span class="ot">&lt;-</span> <span class="fu">mutate</span>(controls, <span class="at">est =</span> est_shifted)</span>
<span id="cb63-264"><a href="#cb63-264" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb63-265"><a href="#cb63-265" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_ribbon</span>(<span class="at">data =</span> controls, <span class="fu">aes</span>(<span class="at">y=</span><span class="cn">NULL</span>), </span>
<span id="cb63-266"><a href="#cb63-266" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> linear_control_color, <span class="at">size =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb63-267"><a href="#cb63-267" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">data =</span> controls, </span>
<span id="cb63-268"><a href="#cb63-268" aria-hidden="true" tabindex="-1"></a>                <span class="at">lty=</span> linear_control_lty, <span class="at">color =</span> linear_control_color, </span>
<span id="cb63-269"><a href="#cb63-269" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> linear_control_lsize, <span class="at">alpha=</span> <span class="fl">1.0</span>)</span>
<span id="cb63-270"><a href="#cb63-270" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-271"><a href="#cb63-271" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(additional_controls)) {</span>
<span id="cb63-272"><a href="#cb63-272" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add in other data</span></span>
<span id="cb63-273"><a href="#cb63-273" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (use_shifted_est) additional_controls <span class="ot">&lt;-</span> <span class="fu">mutate</span>(</span>
<span id="cb63-274"><a href="#cb63-274" aria-hidden="true" tabindex="-1"></a>      additional_controls, <span class="at">est =</span> est_shifted)</span>
<span id="cb63-275"><a href="#cb63-275" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb63-276"><a href="#cb63-276" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_ribbon</span>(<span class="at">data =</span> additional_controls, <span class="fu">aes</span>(<span class="at">y=</span><span class="cn">NULL</span>), </span>
<span id="cb63-277"><a href="#cb63-277" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># fill = additional_control_color, </span></span>
<span id="cb63-278"><a href="#cb63-278" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb63-279"><a href="#cb63-279" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">data =</span> additional_controls, <span class="fu">aes</span>(<span class="at">color =</span> context_len),</span>
<span id="cb63-280"><a href="#cb63-280" aria-hidden="true" tabindex="-1"></a>                <span class="at">lty =</span> additional_control_lty, <span class="co">#color = additional_control_color, </span></span>
<span id="cb63-281"><a href="#cb63-281" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> additional_control_lsize, <span class="at">alpha=</span> <span class="fl">1.0</span>)</span>
<span id="cb63-282"><a href="#cb63-282" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-283"><a href="#cb63-283" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(density_df)) {</span>
<span id="cb63-284"><a href="#cb63-284" aria-hidden="true" tabindex="-1"></a>    max_surps <span class="ot">=</span> data_to_plot <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model, context_len) <span class="sc">%&gt;%</span></span>
<span id="cb63-285"><a href="#cb63-285" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">max_surp=</span><span class="fu">max</span>(surprisal), <span class="at">.groups=</span><span class="st">"drop"</span>)</span>
<span id="cb63-286"><a href="#cb63-286" aria-hidden="true" tabindex="-1"></a>    density_df <span class="ot">&lt;-</span> density_df <span class="sc">%&gt;%</span> </span>
<span id="cb63-287"><a href="#cb63-287" aria-hidden="true" tabindex="-1"></a>      <span class="fu">full_join</span>(max_surps, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"model"</span>, <span class="st">"context_len"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb63-288"><a href="#cb63-288" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(surprisal <span class="sc">&lt;=</span> max_surp)</span>
<span id="cb63-289"><a href="#cb63-289" aria-hidden="true" tabindex="-1"></a>    density_ymin <span class="ot">&lt;-</span> <span class="cf">if</span> (use_shifted_est) <span class="dv">312</span> <span class="cf">else</span> <span class="sc">-</span><span class="dv">10</span></span>
<span id="cb63-290"><a href="#cb63-290" aria-hidden="true" tabindex="-1"></a>    density_df <span class="ot">&lt;-</span> <span class="fu">mutate</span>(density_df, <span class="at">density =</span> <span class="dv">120</span> <span class="sc">*</span> density <span class="sc">+</span> density_ymin)</span>
<span id="cb63-291"><a href="#cb63-291" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb63-292"><a href="#cb63-292" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(</span>
<span id="cb63-293"><a href="#cb63-293" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> density_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">est_type =</span> <span class="st">"mean"</span>), </span>
<span id="cb63-294"><a href="#cb63-294" aria-hidden="true" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">ymin =</span> <span class="cn">NULL</span>, <span class="at">ymax =</span> <span class="cn">NULL</span>, <span class="at">y =</span> density, <span class="at">x =</span> surprisal, <span class="at">linetype =</span> <span class="cn">NULL</span>), </span>
<span id="cb63-295"><a href="#cb63-295" aria-hidden="true" tabindex="-1"></a>        <span class="at">linetype =</span> <span class="st">"solid"</span>,</span>
<span id="cb63-296"><a href="#cb63-296" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> density_color, <span class="at">alpha=</span>.<span class="dv">35</span>)</span>
<span id="cb63-297"><a href="#cb63-297" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb63-298"><a href="#cb63-298" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_ribbon</span>(<span class="at">data =</span> density_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">est_type =</span> <span class="st">"mean"</span>),</span>
<span id="cb63-299"><a href="#cb63-299" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">x =</span> surprisal, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="co"># forget the y aesthetic</span></span>
<span id="cb63-300"><a href="#cb63-300" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> density_ymin, <span class="at">ymax =</span> density),</span>
<span id="cb63-301"><a href="#cb63-301" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> density_color, <span class="at">alpha =</span> <span class="fl">0.2</span>)</span>
<span id="cb63-302"><a href="#cb63-302" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-303"><a href="#cb63-303" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">y=</span><span class="cn">NULL</span>), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">size=</span><span class="dv">0</span>)</span>
<span id="cb63-304"><a href="#cb63-304" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(static_lty)) {</span>
<span id="cb63-305"><a href="#cb63-305" aria-hidden="true" tabindex="-1"></a>        p <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span>context_len), <span class="at">linetype =</span> static_lty)</span>
<span id="cb63-306"><a href="#cb63-306" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb63-307"><a href="#cb63-307" aria-hidden="true" tabindex="-1"></a>        p <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span>context_len, <span class="at">linetype =</span> est_type))</span>
<span id="cb63-308"><a href="#cb63-308" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb63-309"><a href="#cb63-309" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb63-310"><a href="#cb63-310" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">"context amount"</span>, <span class="at">labels =</span> context_len_labs) <span class="sc">+</span></span>
<span id="cb63-311"><a href="#cb63-311" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"context amount"</span>, <span class="at">labels =</span> context_len_labs) <span class="sc">+</span></span>
<span id="cb63-312"><a href="#cb63-312" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linetype_discrete</span>(<span class="at">name =</span> <span class="st">"effect"</span>, <span class="at">labels =</span> est_type_labs) <span class="sc">+</span></span>
<span id="cb63-313"><a href="#cb63-313" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(..., <span class="at">labeller =</span> my_labeller) <span class="sc">+</span></span>
<span id="cb63-314"><a href="#cb63-314" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> xbreaks) <span class="sc">+</span></span>
<span id="cb63-315"><a href="#cb63-315" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> xlab, <span class="at">y=</span>ylab)</span>
<span id="cb63-316"><a href="#cb63-316" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-317"><a href="#cb63-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-318"><a href="#cb63-318" aria-hidden="true" tabindex="-1"></a>plot_easy_mean_patch <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb63-319"><a href="#cb63-319" aria-hidden="true" tabindex="-1"></a>      data_to_plot, data_to_plot_control,</span>
<span id="cb63-320"><a href="#cb63-320" aria-hidden="true" tabindex="-1"></a>      <span class="at">order_models_by_PPL =</span> <span class="cn">TRUE</span>,</span>
<span id="cb63-321"><a href="#cb63-321" aria-hidden="true" tabindex="-1"></a>      <span class="at">ctx_lens =</span> context_lens, <span class="at">density_df =</span> surprisal_densities, </span>
<span id="cb63-322"><a href="#cb63-322" aria-hidden="true" tabindex="-1"></a>      <span class="at">meanbreaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">25</span>, <span class="dv">500</span>, <span class="dv">25</span>), ...){</span>
<span id="cb63-323"><a href="#cb63-323" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (order_models_by_PPL) {</span>
<span id="cb63-324"><a href="#cb63-324" aria-hidden="true" tabindex="-1"></a>      data_to_plot<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb63-325"><a href="#cb63-325" aria-hidden="true" tabindex="-1"></a>        data_to_plot<span class="sc">$</span>model, <span class="at">levels =</span> models_in_desc_PPL_order)</span>
<span id="cb63-326"><a href="#cb63-326" aria-hidden="true" tabindex="-1"></a>      data_to_plot_control<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="fu">factor</span>(data_to_plot_control<span class="sc">$</span>model, <span class="at">levels =</span> models_in_desc_PPL_order)</span>
<span id="cb63-327"><a href="#cb63-327" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb63-328"><a href="#cb63-328" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb63-329"><a href="#cb63-329" aria-hidden="true" tabindex="-1"></a>    which_descr <span class="ot">&lt;-</span> <span class="st">"mean RT"</span></span>
<span id="cb63-330"><a href="#cb63-330" aria-hidden="true" tabindex="-1"></a>    data_to_plot <span class="ot">&lt;-</span> data_to_plot <span class="sc">%&gt;%</span> <span class="fu">filter</span>(est_type<span class="sc">==</span><span class="st">"mean"</span>)</span>
<span id="cb63-331"><a href="#cb63-331" aria-hidden="true" tabindex="-1"></a>    data_to_plot_control <span class="ot">&lt;-</span> data_to_plot_control <span class="sc">%&gt;%</span> <span class="fu">filter</span>(est_type<span class="sc">==</span><span class="st">"mean"</span>)</span>
<span id="cb63-332"><a href="#cb63-332" aria-hidden="true" tabindex="-1"></a>    space <span class="ot">&lt;-</span> <span class="st">"free"</span>; ybreaks <span class="ot">&lt;-</span> meanbreaks</span>
<span id="cb63-333"><a href="#cb63-333" aria-hidden="true" tabindex="-1"></a>    static_lty <span class="ot">=</span> <span class="st">"solid"</span>; ltyguide <span class="ot">&lt;-</span> <span class="st">"none"</span></span>
<span id="cb63-334"><a href="#cb63-334" aria-hidden="true" tabindex="-1"></a>    data_to_plot <span class="sc">%&gt;%</span> </span>
<span id="cb63-335"><a href="#cb63-335" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(context_len <span class="sc">%in%</span> ctx_lens) <span class="sc">%&gt;%</span></span>
<span id="cb63-336"><a href="#cb63-336" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plot_data</span>(<span class="at">controls =</span> data_to_plot_control <span class="sc">%&gt;%</span></span>
<span id="cb63-337"><a href="#cb63-337" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(context_len <span class="sc">%in%</span> ctx_lens),</span>
<span id="cb63-338"><a href="#cb63-338" aria-hidden="true" tabindex="-1"></a>                <span class="at">density_df =</span> density_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(context_len <span class="sc">%in%</span> ctx_lens),</span>
<span id="cb63-339"><a href="#cb63-339" aria-hidden="true" tabindex="-1"></a>                <span class="at">static_lty =</span> static_lty,</span>
<span id="cb63-340"><a href="#cb63-340" aria-hidden="true" tabindex="-1"></a>                <span class="at">rows =</span></span>
<span id="cb63-341"><a href="#cb63-341" aria-hidden="true" tabindex="-1"></a>                  context_len  <span class="co">#+ est_type</span></span>
<span id="cb63-342"><a href="#cb63-342" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span>   model,</span>
<span id="cb63-343"><a href="#cb63-343" aria-hidden="true" tabindex="-1"></a>                <span class="at">scales=</span><span class="st">"free"</span>, <span class="at">space=</span>space,</span>
<span id="cb63-344"><a href="#cb63-344" aria-hidden="true" tabindex="-1"></a>                <span class="at">switch=</span><span class="st">"y"</span>,</span>
<span id="cb63-345"><a href="#cb63-345" aria-hidden="true" tabindex="-1"></a>                <span class="at">ylab =</span> <span class="st">"mean RT ±2*SE"</span>,</span>
<span id="cb63-346"><a href="#cb63-346" aria-hidden="true" tabindex="-1"></a>                ...) <span class="sc">+</span></span>
<span id="cb63-347"><a href="#cb63-347" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="co">#title = "GAM fits of the effect of surprisal on reading time",</span></span>
<span id="cb63-348"><a href="#cb63-348" aria-hidden="true" tabindex="-1"></a>           <span class="at">subtitle =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"Partial effect of surprisal on {which_descr}"</span>)) <span class="sc">+</span></span>
<span id="cb63-349"><a href="#cb63-349" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb63-350"><a href="#cb63-350" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement=</span><span class="st">'outside'</span>,</span>
<span id="cb63-351"><a href="#cb63-351" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axis.title.x = element_blank(), axis.text.x = element_blank(),</span></span>
<span id="cb63-352"><a href="#cb63-352" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">08</span>,.<span class="dv">7</span>),</span>
<span id="cb63-353"><a href="#cb63-353" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">size =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"white"</span>)) <span class="sc">+</span></span>
<span id="cb63-354"><a href="#cb63-354" aria-hidden="true" tabindex="-1"></a>        <span class="co"># guides(linetype = ltyguide) +</span></span>
<span id="cb63-355"><a href="#cb63-355" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> ybreaks, <span class="at">position =</span> <span class="st">"right"</span>)</span>
<span id="cb63-356"><a href="#cb63-356" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-357"><a href="#cb63-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-358"><a href="#cb63-358" aria-hidden="true" tabindex="-1"></a>plot_easy_var_patch <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb63-359"><a href="#cb63-359" aria-hidden="true" tabindex="-1"></a>      data_to_plot, data_to_plot_control,</span>
<span id="cb63-360"><a href="#cb63-360" aria-hidden="true" tabindex="-1"></a>      <span class="at">order_models_by_PPL =</span> <span class="cn">TRUE</span>,</span>
<span id="cb63-361"><a href="#cb63-361" aria-hidden="true" tabindex="-1"></a>      <span class="at">ctx_lens =</span> context_lens, <span class="at">density_df =</span> surprisal_densities, ...){</span>
<span id="cb63-362"><a href="#cb63-362" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (order_models_by_PPL) {</span>
<span id="cb63-363"><a href="#cb63-363" aria-hidden="true" tabindex="-1"></a>      data_to_plot<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb63-364"><a href="#cb63-364" aria-hidden="true" tabindex="-1"></a>        data_to_plot<span class="sc">$</span>model, <span class="at">levels =</span> models_in_desc_PPL_order)</span>
<span id="cb63-365"><a href="#cb63-365" aria-hidden="true" tabindex="-1"></a>      data_to_plot_control<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb63-366"><a href="#cb63-366" aria-hidden="true" tabindex="-1"></a>        data_to_plot_control<span class="sc">$</span>model, <span class="at">levels =</span> models_in_desc_PPL_order)</span>
<span id="cb63-367"><a href="#cb63-367" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb63-368"><a href="#cb63-368" aria-hidden="true" tabindex="-1"></a>    varbreaks <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {<span class="cf">if</span> (<span class="fu">max</span>(x)<span class="sc">&lt;</span><span class="fl">5.3</span>) <span class="fu">seq</span>(<span class="dv">4</span>,<span class="dv">6</span>,.<span class="dv">2</span>) <span class="cf">else</span> <span class="fu">seq</span>(<span class="dv">3</span>,<span class="dv">7</span>, .<span class="dv">5</span>)}</span>
<span id="cb63-369"><a href="#cb63-369" aria-hidden="true" tabindex="-1"></a>    which_descr <span class="ot">&lt;-</span> <span class="st">"log standard deviation in RT"</span></span>
<span id="cb63-370"><a href="#cb63-370" aria-hidden="true" tabindex="-1"></a>    data_to_plot <span class="ot">&lt;-</span> data_to_plot <span class="sc">%&gt;%</span> <span class="fu">filter</span>(est_type<span class="sc">==</span><span class="st">"var"</span>)</span>
<span id="cb63-371"><a href="#cb63-371" aria-hidden="true" tabindex="-1"></a>    data_to_plot_control <span class="ot">&lt;-</span> data_to_plot_control <span class="sc">%&gt;%</span> <span class="fu">filter</span>(est_type<span class="sc">==</span><span class="st">"var"</span>)</span>
<span id="cb63-372"><a href="#cb63-372" aria-hidden="true" tabindex="-1"></a>    space <span class="ot">&lt;-</span> <span class="st">"free"</span>; ybreaks <span class="ot">&lt;-</span> varbreaks</span>
<span id="cb63-373"><a href="#cb63-373" aria-hidden="true" tabindex="-1"></a>    static_lty <span class="ot">=</span> variance_lty; ltyguide <span class="ot">&lt;-</span> <span class="st">"none"</span></span>
<span id="cb63-374"><a href="#cb63-374" aria-hidden="true" tabindex="-1"></a>    data_to_plot <span class="sc">%&gt;%</span></span>
<span id="cb63-375"><a href="#cb63-375" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(context_len <span class="sc">%in%</span> ctx_lens) <span class="sc">%&gt;%</span></span>
<span id="cb63-376"><a href="#cb63-376" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plot_data</span>(<span class="at">controls =</span> data_to_plot_control <span class="sc">%&gt;%</span></span>
<span id="cb63-377"><a href="#cb63-377" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(context_len <span class="sc">%in%</span> ctx_lens),</span>
<span id="cb63-378"><a href="#cb63-378" aria-hidden="true" tabindex="-1"></a>                <span class="at">density_df =</span> <span class="cn">NULL</span>,</span>
<span id="cb63-379"><a href="#cb63-379" aria-hidden="true" tabindex="-1"></a>                <span class="at">ylab =</span> <span class="st">"log (sd RT) ±2*SE"</span>,</span>
<span id="cb63-380"><a href="#cb63-380" aria-hidden="true" tabindex="-1"></a>                <span class="at">static_lty =</span> static_lty,</span>
<span id="cb63-381"><a href="#cb63-381" aria-hidden="true" tabindex="-1"></a>                <span class="at">rows =</span></span>
<span id="cb63-382"><a href="#cb63-382" aria-hidden="true" tabindex="-1"></a>                  context_len <span class="co">#+ est_type</span></span>
<span id="cb63-383"><a href="#cb63-383" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span>   model,</span>
<span id="cb63-384"><a href="#cb63-384" aria-hidden="true" tabindex="-1"></a>                <span class="at">scales=</span><span class="st">"free"</span>, <span class="at">space=</span>space,</span>
<span id="cb63-385"><a href="#cb63-385" aria-hidden="true" tabindex="-1"></a>                <span class="at">switch=</span><span class="st">"y"</span>,</span>
<span id="cb63-386"><a href="#cb63-386" aria-hidden="true" tabindex="-1"></a>                <span class="co"># trans = \(x){exp(x)^2},</span></span>
<span id="cb63-387"><a href="#cb63-387" aria-hidden="true" tabindex="-1"></a>                ...) <span class="sc">+</span></span>
<span id="cb63-388"><a href="#cb63-388" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="co">#title = "GAM fits of the effect of surprisal on reading time",</span></span>
<span id="cb63-389"><a href="#cb63-389" aria-hidden="true" tabindex="-1"></a>           <span class="at">subtitle =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"Partial effect of surprisal on {which_descr}"</span>)) <span class="sc">+</span></span>
<span id="cb63-390"><a href="#cb63-390" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb63-391"><a href="#cb63-391" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement=</span><span class="st">'outside'</span>,  <span class="at">strip.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb63-392"><a href="#cb63-392" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">08</span>,.<span class="dv">7</span>),</span>
<span id="cb63-393"><a href="#cb63-393" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">size =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"white"</span>)) <span class="sc">+</span></span>
<span id="cb63-394"><a href="#cb63-394" aria-hidden="true" tabindex="-1"></a>        <span class="co"># guides(linetype = ltyguide) +</span></span>
<span id="cb63-395"><a href="#cb63-395" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> ybreaks, <span class="at">position =</span> <span class="st">"right"</span>)</span>
<span id="cb63-396"><a href="#cb63-396" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-397"><a href="#cb63-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-398"><a href="#cb63-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-399"><a href="#cb63-399" aria-hidden="true" tabindex="-1"></a>plot_easy_both_patch <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb63-400"><a href="#cb63-400" aria-hidden="true" tabindex="-1"></a>    data_to_plot, data_to_plot_control,</span>
<span id="cb63-401"><a href="#cb63-401" aria-hidden="true" tabindex="-1"></a>    <span class="at">order_models_by_PPL =</span> <span class="cn">TRUE</span>,</span>
<span id="cb63-402"><a href="#cb63-402" aria-hidden="true" tabindex="-1"></a>    <span class="at">ctx_lens =</span> context_lens, <span class="at">density_df =</span> surprisal_densities, ...) {</span>
<span id="cb63-403"><a href="#cb63-403" aria-hidden="true" tabindex="-1"></a>  p_mean <span class="ot">&lt;-</span> <span class="fu">plot_easy_mean_patch</span>(data_to_plot, data_to_plot_control,</span>
<span id="cb63-404"><a href="#cb63-404" aria-hidden="true" tabindex="-1"></a>      <span class="at">order_models_by_PPL =</span> order_models_by_PPL,</span>
<span id="cb63-405"><a href="#cb63-405" aria-hidden="true" tabindex="-1"></a>      <span class="at">ctx_lens =</span> ctx_lens, <span class="at">density_df =</span> density_df, ...) <span class="sc">+</span> </span>
<span id="cb63-406"><a href="#cb63-406" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb63-407"><a href="#cb63-407" aria-hidden="true" tabindex="-1"></a>  p_var <span class="ot">&lt;-</span> <span class="fu">plot_easy_var_patch</span>(data_to_plot, data_to_plot_control,</span>
<span id="cb63-408"><a href="#cb63-408" aria-hidden="true" tabindex="-1"></a>      <span class="at">order_models_by_PPL =</span> order_models_by_PPL,</span>
<span id="cb63-409"><a href="#cb63-409" aria-hidden="true" tabindex="-1"></a>      <span class="at">ctx_lens =</span> ctx_lens, <span class="at">density_df =</span> density_df, ...)</span>
<span id="cb63-410"><a href="#cb63-410" aria-hidden="true" tabindex="-1"></a>  p_mean <span class="sc">+</span> p_var <span class="sc">+</span></span>
<span id="cb63-411"><a href="#cb63-411" aria-hidden="true" tabindex="-1"></a>    patchwork<span class="sc">::</span><span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb63-412"><a href="#cb63-412" aria-hidden="true" tabindex="-1"></a>    patchwork<span class="sc">::</span><span class="fu">plot_annotation</span>(</span>
<span id="cb63-413"><a href="#cb63-413" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"GAM fits of the effect of surprisal on reading time"</span></span>
<span id="cb63-414"><a href="#cb63-414" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb63-415"><a href="#cb63-415" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-416"><a href="#cb63-416" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-417"><a href="#cb63-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-418"><a href="#cb63-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-421"><a href="#cb63-421" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb63-422"><a href="#cb63-422" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb63-423"><a href="#cb63-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-424"><a href="#cb63-424" aria-hidden="true" tabindex="-1"></a>density_color <span class="ot">&lt;-</span> <span class="st">"grey"</span></span>
<span id="cb63-425"><a href="#cb63-425" aria-hidden="true" tabindex="-1"></a>linear_control_color <span class="ot">&lt;-</span> <span class="st">"black"</span></span>
<span id="cb63-426"><a href="#cb63-426" aria-hidden="true" tabindex="-1"></a>linear_control_lty <span class="ot">&lt;-</span> <span class="st">"13"</span></span>
<span id="cb63-427"><a href="#cb63-427" aria-hidden="true" tabindex="-1"></a>linear_control_lsize <span class="ot">&lt;-</span> .<span class="dv">25</span></span>
<span id="cb63-428"><a href="#cb63-428" aria-hidden="true" tabindex="-1"></a>variance_lty <span class="ot">&lt;-</span> <span class="st">"31"</span></span>
<span id="cb63-429"><a href="#cb63-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-430"><a href="#cb63-430" aria-hidden="true" tabindex="-1"></a>additional_control_color <span class="ot">&lt;-</span> <span class="st">"grey"</span></span>
<span id="cb63-431"><a href="#cb63-431" aria-hidden="true" tabindex="-1"></a>additional_control_lty <span class="ot">&lt;-</span> <span class="st">"33"</span></span>
<span id="cb63-432"><a href="#cb63-432" aria-hidden="true" tabindex="-1"></a>additional_control_lsize <span class="ot">&lt;-</span> .<span class="dv">25</span></span>
<span id="cb63-433"><a href="#cb63-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-434"><a href="#cb63-434" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_easy_mean_patch</span>(data_to_plot_var0_gauss_wprev, data_to_plot_lin0var_wprev,</span>
<span id="cb63-435"><a href="#cb63-435" aria-hidden="true" tabindex="-1"></a>                     <span class="at">meanbreaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">25</span>, <span class="dv">650</span>, <span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb63-436"><a href="#cb63-436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">"RT (ms) ±2*SE"</span>,</span>
<span id="cb63-437"><a href="#cb63-437" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Effect of surprisal on mean RT"</span>,</span>
<span id="cb63-438"><a href="#cb63-438" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"GAMs with constant variance assumption"</span>)</span>
<span id="cb63-439"><a href="#cb63-439" aria-hidden="true" tabindex="-1"></a><span class="do">### FIG FOR PAPER (3 contexts)</span></span>
<span id="cb63-440"><a href="#cb63-440" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb63-441"><a href="#cb63-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(figsdir, <span class="st">"gauss0var"</span>, context_pref, <span class="st">"_wprev"</span>, <span class="st">"_wlinear0var_both_patch.pdf"</span>),</span>
<span id="cb63-442"><a href="#cb63-442" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="fl">10.5</span>, <span class="at">height =</span> <span class="fu">ifelse</span>(twocontexts, <span class="fl">3.5</span>, <span class="fl">4.5</span>))</span>
<span id="cb63-443"><a href="#cb63-443" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-444"><a href="#cb63-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-445"><a href="#cb63-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-448"><a href="#cb63-448" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb63-449"><a href="#cb63-449" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb63-450"><a href="#cb63-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-451"><a href="#cb63-451" aria-hidden="true" tabindex="-1"></a>additional_control_color <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb63-452"><a href="#cb63-452" aria-hidden="true" tabindex="-1"></a>additional_control_lty <span class="ot">&lt;-</span> <span class="st">"33"</span></span>
<span id="cb63-453"><a href="#cb63-453" aria-hidden="true" tabindex="-1"></a>additional_control_lsize <span class="ot">&lt;-</span> .<span class="dv">25</span></span>
<span id="cb63-454"><a href="#cb63-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-455"><a href="#cb63-455" aria-hidden="true" tabindex="-1"></a>plot_easy_mean_patch_3 <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb63-456"><a href="#cb63-456" aria-hidden="true" tabindex="-1"></a>      data_to_plot, data_to_plot_control, data_to_plot_control2,</span>
<span id="cb63-457"><a href="#cb63-457" aria-hidden="true" tabindex="-1"></a>      <span class="at">order_models_by_PPL =</span> <span class="cn">TRUE</span>,</span>
<span id="cb63-458"><a href="#cb63-458" aria-hidden="true" tabindex="-1"></a>      <span class="at">ctx_lens =</span> context_lens, <span class="at">density_df =</span> surprisal_densities,</span>
<span id="cb63-459"><a href="#cb63-459" aria-hidden="true" tabindex="-1"></a>      <span class="at">meanbreaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">25</span>, <span class="dv">500</span>, <span class="dv">25</span>), ...){</span>
<span id="cb63-460"><a href="#cb63-460" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (order_models_by_PPL) {</span>
<span id="cb63-461"><a href="#cb63-461" aria-hidden="true" tabindex="-1"></a>      data_to_plot<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb63-462"><a href="#cb63-462" aria-hidden="true" tabindex="-1"></a>        data_to_plot<span class="sc">$</span>model, <span class="at">levels =</span> models_in_desc_PPL_order)</span>
<span id="cb63-463"><a href="#cb63-463" aria-hidden="true" tabindex="-1"></a>      data_to_plot_control<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb63-464"><a href="#cb63-464" aria-hidden="true" tabindex="-1"></a>        data_to_plot_control<span class="sc">$</span>model, <span class="at">levels =</span> models_in_desc_PPL_order)</span>
<span id="cb63-465"><a href="#cb63-465" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb63-466"><a href="#cb63-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-467"><a href="#cb63-467" aria-hidden="true" tabindex="-1"></a>    which_descr <span class="ot">&lt;-</span> <span class="st">"mean RT"</span></span>
<span id="cb63-468"><a href="#cb63-468" aria-hidden="true" tabindex="-1"></a>    data_to_plot <span class="ot">&lt;-</span> data_to_plot <span class="sc">%&gt;%</span> <span class="fu">filter</span>(est_type<span class="sc">==</span><span class="st">"mean"</span>)</span>
<span id="cb63-469"><a href="#cb63-469" aria-hidden="true" tabindex="-1"></a>    data_to_plot_control <span class="ot">&lt;-</span> data_to_plot_control <span class="sc">%&gt;%</span> <span class="fu">filter</span>(est_type<span class="sc">==</span><span class="st">"mean"</span>)</span>
<span id="cb63-470"><a href="#cb63-470" aria-hidden="true" tabindex="-1"></a>    data_to_plot_control2 <span class="ot">&lt;-</span> data_to_plot_control2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(est_type<span class="sc">==</span><span class="st">"mean"</span>)</span>
<span id="cb63-471"><a href="#cb63-471" aria-hidden="true" tabindex="-1"></a>    space <span class="ot">&lt;-</span> <span class="st">"free"</span>; ybreaks <span class="ot">&lt;-</span> meanbreaks</span>
<span id="cb63-472"><a href="#cb63-472" aria-hidden="true" tabindex="-1"></a>    static_lty <span class="ot">=</span> <span class="st">"solid"</span>; ltyguide <span class="ot">&lt;-</span> <span class="st">"none"</span></span>
<span id="cb63-473"><a href="#cb63-473" aria-hidden="true" tabindex="-1"></a>    data_to_plot <span class="sc">%&gt;%</span></span>
<span id="cb63-474"><a href="#cb63-474" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(context_len <span class="sc">%in%</span> ctx_lens) <span class="sc">%&gt;%</span></span>
<span id="cb63-475"><a href="#cb63-475" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plot_data</span>(<span class="at">controls =</span> data_to_plot_control <span class="sc">%&gt;%</span></span>
<span id="cb63-476"><a href="#cb63-476" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(context_len <span class="sc">%in%</span> ctx_lens),</span>
<span id="cb63-477"><a href="#cb63-477" aria-hidden="true" tabindex="-1"></a>                <span class="at">additional_controls =</span> data_to_plot_control2 <span class="sc">%&gt;%</span></span>
<span id="cb63-478"><a href="#cb63-478" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(context_len <span class="sc">%in%</span> ctx_lens),</span>
<span id="cb63-479"><a href="#cb63-479" aria-hidden="true" tabindex="-1"></a>                <span class="at">density_df =</span> density_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(context_len <span class="sc">%in%</span> ctx_lens),</span>
<span id="cb63-480"><a href="#cb63-480" aria-hidden="true" tabindex="-1"></a>                <span class="at">static_lty =</span> static_lty,</span>
<span id="cb63-481"><a href="#cb63-481" aria-hidden="true" tabindex="-1"></a>                <span class="at">rows =</span></span>
<span id="cb63-482"><a href="#cb63-482" aria-hidden="true" tabindex="-1"></a>                  context_len  <span class="co">#+ est_type</span></span>
<span id="cb63-483"><a href="#cb63-483" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span>   model,</span>
<span id="cb63-484"><a href="#cb63-484" aria-hidden="true" tabindex="-1"></a>                <span class="at">scales=</span><span class="st">"free"</span>, <span class="at">space=</span>space,</span>
<span id="cb63-485"><a href="#cb63-485" aria-hidden="true" tabindex="-1"></a>                <span class="at">switch=</span><span class="st">"y"</span>,</span>
<span id="cb63-486"><a href="#cb63-486" aria-hidden="true" tabindex="-1"></a>                <span class="at">ylab =</span> <span class="st">"mean RT ±2*SE"</span>,</span>
<span id="cb63-487"><a href="#cb63-487" aria-hidden="true" tabindex="-1"></a>                ...) <span class="sc">+</span></span>
<span id="cb63-488"><a href="#cb63-488" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="co">#title = "GAM fits of the effect of surprisal on reading time",</span></span>
<span id="cb63-489"><a href="#cb63-489" aria-hidden="true" tabindex="-1"></a>           <span class="at">subtitle =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"Partial effect of surprisal on {which_descr}"</span>)) <span class="sc">+</span></span>
<span id="cb63-490"><a href="#cb63-490" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb63-491"><a href="#cb63-491" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement=</span><span class="st">'outside'</span>,</span>
<span id="cb63-492"><a href="#cb63-492" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axis.title.x = element_blank(), axis.text.x = element_blank(),</span></span>
<span id="cb63-493"><a href="#cb63-493" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">08</span>,.<span class="dv">7</span>),</span>
<span id="cb63-494"><a href="#cb63-494" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">size =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"white"</span>)) <span class="sc">+</span></span>
<span id="cb63-495"><a href="#cb63-495" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> ybreaks, <span class="at">position =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb63-496"><a href="#cb63-496" aria-hidden="true" tabindex="-1"></a>      <span class="fu">guides</span>(<span class="at">linetype =</span> ltyguide)</span>
<span id="cb63-497"><a href="#cb63-497" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-498"><a href="#cb63-498" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-499"><a href="#cb63-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-500"><a href="#cb63-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-503"><a href="#cb63-503" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb63-504"><a href="#cb63-504" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_easy_mean_patch_3</span>(</span>
<span id="cb63-505"><a href="#cb63-505" aria-hidden="true" tabindex="-1"></a>  data_to_plot_var0_gauss_w3prev,</span>
<span id="cb63-506"><a href="#cb63-506" aria-hidden="true" tabindex="-1"></a>  data_to_plot_lin0var_wprev,</span>
<span id="cb63-507"><a href="#cb63-507" aria-hidden="true" tabindex="-1"></a>  data_to_plot_var0_gauss_wprev <span class="sc">%&gt;%</span>  <span class="fu">filter</span>(est_shifted <span class="sc">&lt;=</span> <span class="dv">500</span>),</span>
<span id="cb63-508"><a href="#cb63-508" aria-hidden="true" tabindex="-1"></a>                     <span class="at">meanbreaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">25</span>, <span class="dv">650</span>, <span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb63-509"><a href="#cb63-509" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">"RT (ms) ±2*SE"</span>,</span>
<span id="cb63-510"><a href="#cb63-510" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Effect of surprisal on mean RT, GAMs with constant variance"</span>,</span>
<span id="cb63-511"><a href="#cb63-511" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"comparing using 3 words for spillover (solid) words to just 1 (dashed)"</span>)</span>
<span id="cb63-512"><a href="#cb63-512" aria-hidden="true" tabindex="-1"></a><span class="do">### FIG FOR PAPER (3 contexts)</span></span>
<span id="cb63-513"><a href="#cb63-513" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb63-514"><a href="#cb63-514" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(figsdir, <span class="st">"gauss0var"</span>, context_pref, <span class="st">"_wprev_vs_wprev3_lin0var.pdf"</span>),</span>
<span id="cb63-515"><a href="#cb63-515" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="fl">10.5</span>, <span class="at">height =</span> <span class="fu">ifelse</span>(twocontexts, <span class="fl">3.5</span>, <span class="fl">4.5</span>))</span>
<span id="cb63-516"><a href="#cb63-516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-517"><a href="#cb63-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-518"><a href="#cb63-518" aria-hidden="true" tabindex="-1"></a>Main plot figure for paper:</span>
<span id="cb63-519"><a href="#cb63-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-522"><a href="#cb63-522" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb63-523"><a href="#cb63-523" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_easy_both_patch</span>(data_to_plot_smooth_wprevm, data_to_plot_linear_wprevm)</span>
<span id="cb63-524"><a href="#cb63-524" aria-hidden="true" tabindex="-1"></a><span class="do">### FIG FOR PAPER (2 and 3 contexts)</span></span>
<span id="cb63-525"><a href="#cb63-525" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb63-526"><a href="#cb63-526" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(figsdir, <span class="st">"gaulss"</span>, context_pref, <span class="st">"_wprevm"</span>, <span class="st">"_wlinear_both_patch.pdf"</span>),</span>
<span id="cb63-527"><a href="#cb63-527" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="fl">10.5</span>, <span class="at">height =</span> <span class="fu">ifelse</span>(twocontexts, <span class="dv">6</span>, <span class="fl">7.5</span>))</span>
<span id="cb63-528"><a href="#cb63-528" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-529"><a href="#cb63-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-530"><a href="#cb63-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-531"><a href="#cb63-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-532"><a href="#cb63-532" aria-hidden="true" tabindex="-1"></a><span class="fu">## Superlinearity</span></span>
<span id="cb63-533"><a href="#cb63-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-536"><a href="#cb63-536" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb63-537"><a href="#cb63-537" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb63-538"><a href="#cb63-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-539"><a href="#cb63-539" aria-hidden="true" tabindex="-1"></a>make_half_linears_dataset <span class="ot">&lt;-</span> <span class="cf">function</span>(data_to_plot, <span class="at">breakpoint=</span><span class="fl">0.5</span>, <span class="at">se.mult=</span><span class="fl">1.96</span>) {</span>
<span id="cb63-540"><a href="#cb63-540" aria-hidden="true" tabindex="-1"></a>  <span class="co">#" fit simple linear models to the smooth fits before and after the breakpoint</span></span>
<span id="cb63-541"><a href="#cb63-541" aria-hidden="true" tabindex="-1"></a>  <span class="co">#" breakpoint should be between 0 and 1 (proportion of max surprisal to break at)</span></span>
<span id="cb63-542"><a href="#cb63-542" aria-hidden="true" tabindex="-1"></a>  data_to_plot <span class="sc">%&gt;%</span> </span>
<span id="cb63-543"><a href="#cb63-543" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(model, context_len) <span class="sc">%&gt;%</span> </span>
<span id="cb63-544"><a href="#cb63-544" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">secondhalf =</span> surprisal <span class="sc">&gt;</span> <span class="fu">max</span>(surprisal) <span class="sc">*</span> breakpoint) <span class="sc">%&gt;%</span></span>
<span id="cb63-545"><a href="#cb63-545" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(secondhalf, est_type, <span class="at">.add =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-546"><a href="#cb63-546" aria-hidden="true" tabindex="-1"></a>    <span class="fu">do</span>(<span class="at">f =</span> broom<span class="sc">::</span><span class="fu">tidy</span>(<span class="fu">lm</span>(est <span class="sc">~</span> surprisal, <span class="at">weights =</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(se), <span class="at">data =</span> .))) <span class="sc">%&gt;%</span></span>
<span id="cb63-547"><a href="#cb63-547" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">unnest</span>(f) <span class="sc">%&gt;%</span></span>
<span id="cb63-548"><a href="#cb63-548" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">lower =</span> estimate <span class="sc">-</span> se.mult <span class="sc">*</span> std.error,</span>
<span id="cb63-549"><a href="#cb63-549" aria-hidden="true" tabindex="-1"></a>           <span class="at">upper =</span> estimate <span class="sc">+</span> se.mult <span class="sc">*</span> std.error) <span class="sc">%&gt;%</span></span>
<span id="cb63-550"><a href="#cb63-550" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"surprisal"</span>)  </span>
<span id="cb63-551"><a href="#cb63-551" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-552"><a href="#cb63-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-553"><a href="#cb63-553" aria-hidden="true" tabindex="-1"></a><span class="co"># half_linears3 &lt;- make_half_linears_dataset(data_to_plot_smooth_wprevm, breakpoint=1/3)</span></span>
<span id="cb63-554"><a href="#cb63-554" aria-hidden="true" tabindex="-1"></a>half_linears2 <span class="ot">&lt;-</span> <span class="fu">make_half_linears_dataset</span>(data_to_plot_smooth_wprevm, <span class="at">breakpoint=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb63-555"><a href="#cb63-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-556"><a href="#cb63-556" aria-hidden="true" tabindex="-1"></a><span class="co"># For the datasubset_lessN versions (just GPT3d for now)</span></span>
<span id="cb63-557"><a href="#cb63-557" aria-hidden="true" tabindex="-1"></a>half_linears2_less6 <span class="ot">&lt;-</span> <span class="fu">make_half_linears_dataset</span>(</span>
<span id="cb63-558"><a href="#cb63-558" aria-hidden="true" tabindex="-1"></a>  data_to_plot_datasubsetless6_smooth_wprevm, <span class="at">breakpoint=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb63-559"><a href="#cb63-559" aria-hidden="true" tabindex="-1"></a>half_linears2_less12 <span class="ot">&lt;-</span> <span class="fu">make_half_linears_dataset</span>(</span>
<span id="cb63-560"><a href="#cb63-560" aria-hidden="true" tabindex="-1"></a>  data_to_plot_datasubsetless12_smooth_wprevm, <span class="at">breakpoint=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb63-561"><a href="#cb63-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-562"><a href="#cb63-562" aria-hidden="true" tabindex="-1"></a>make_halflinears_diffs_dataset <span class="ot">&lt;-</span> <span class="cf">function</span>(half_linears_dataset) {</span>
<span id="cb63-563"><a href="#cb63-563" aria-hidden="true" tabindex="-1"></a>  half_linears_dataset <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model, context_len, est_type) <span class="sc">%&gt;%</span></span>
<span id="cb63-564"><a href="#cb63-564" aria-hidden="true" tabindex="-1"></a>    <span class="fu">do</span>(<span class="at">diff_slope_hi_v_low =</span> </span>
<span id="cb63-565"><a href="#cb63-565" aria-hidden="true" tabindex="-1"></a>         <span class="fu">filter</span>(., secondhalf<span class="sc">==</span><span class="cn">TRUE</span>)<span class="sc">$</span>estimate <span class="sc">-</span> <span class="fu">filter</span>(., secondhalf<span class="sc">==</span><span class="cn">FALSE</span>)<span class="sc">$</span>estimate,</span>
<span id="cb63-566"><a href="#cb63-566" aria-hidden="true" tabindex="-1"></a>       <span class="at">sum_std.error =</span> </span>
<span id="cb63-567"><a href="#cb63-567" aria-hidden="true" tabindex="-1"></a>         <span class="fu">filter</span>(., secondhalf<span class="sc">==</span><span class="cn">TRUE</span>)<span class="sc">$</span>std.error <span class="sc">+</span> <span class="fu">filter</span>(., secondhalf<span class="sc">==</span><span class="cn">FALSE</span>)<span class="sc">$</span>std.error</span>
<span id="cb63-568"><a href="#cb63-568" aria-hidden="true" tabindex="-1"></a>       ) <span class="sc">%&gt;%</span></span>
<span id="cb63-569"><a href="#cb63-569" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">unnest</span>(<span class="fu">c</span>(diff_slope_hi_v_low, sum_std.error)) <span class="sc">%&gt;%</span></span>
<span id="cb63-570"><a href="#cb63-570" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">upper =</span> diff_slope_hi_v_low <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> sum_std.error,</span>
<span id="cb63-571"><a href="#cb63-571" aria-hidden="true" tabindex="-1"></a>           <span class="at">lower =</span> diff_slope_hi_v_low <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> sum_std.error)</span>
<span id="cb63-572"><a href="#cb63-572" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-573"><a href="#cb63-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-574"><a href="#cb63-574" aria-hidden="true" tabindex="-1"></a>halflinear_diffs2 <span class="ot">&lt;-</span> <span class="fu">make_halflinears_diffs_dataset</span>(half_linears2)</span>
<span id="cb63-575"><a href="#cb63-575" aria-hidden="true" tabindex="-1"></a><span class="co"># halflinear_diffs3 &lt;- make_halflinears_diffs_dataset(half_linears3)</span></span>
<span id="cb63-576"><a href="#cb63-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-577"><a href="#cb63-577" aria-hidden="true" tabindex="-1"></a><span class="do">## Save halflinear data</span></span>
<span id="cb63-578"><a href="#cb63-578" aria-hidden="true" tabindex="-1"></a><span class="co"># halflinear_diffs2 %&gt;% readr::write_csv("natural-stories-surprisals/gaulss_halflinear_diffs2.csv")</span></span>
<span id="cb63-579"><a href="#cb63-579" aria-hidden="true" tabindex="-1"></a><span class="co"># halflinear_diffs3 %&gt;% readr::write_csv("natural-stories-surprisals/gaulss_halflinear_diffs3.csv")</span></span>
<span id="cb63-580"><a href="#cb63-580" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-581"><a href="#cb63-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-582"><a href="#cb63-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-585"><a href="#cb63-585" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb63-586"><a href="#cb63-586" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb63-587"><a href="#cb63-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-588"><a href="#cb63-588" aria-hidden="true" tabindex="-1"></a><span class="do">## Read in halflinear data</span></span>
<span id="cb63-589"><a href="#cb63-589" aria-hidden="true" tabindex="-1"></a><span class="co"># halflinear_diffs2 &lt;- load_in_data("natural-stories-surprisals/gaulss_halflinear_diffs2.csv")</span></span>
<span id="cb63-590"><a href="#cb63-590" aria-hidden="true" tabindex="-1"></a><span class="co"># halflinear_diffs3 &lt;- load_in_data("natural-stories-surprisals/gaulss_halflinear_diffs3.csv")</span></span>
<span id="cb63-591"><a href="#cb63-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-592"><a href="#cb63-592" aria-hidden="true" tabindex="-1"></a>halflinear_diffs2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(context_len <span class="sc">%in%</span> context_lens) <span class="sc">%&gt;%</span> </span>
<span id="cb63-593"><a href="#cb63-593" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> diff_slope_hi_v_low, <span class="at">shape =</span> est_type,</span>
<span id="cb63-594"><a href="#cb63-594" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper, <span class="at">color =</span> context_len)) <span class="sc">+</span></span>
<span id="cb63-595"><a href="#cb63-595" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="dv">0</span>, <span class="at">color=</span><span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb63-596"><a href="#cb63-596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">width =</span> .<span class="dv">25</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb63-597"><a href="#cb63-597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(context_len <span class="sc">+</span>est_type<span class="sc">~</span> model, <span class="at">labeller =</span> my_labeller, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb63-598"><a href="#cb63-598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">"context amount"</span>, <span class="at">labels =</span> context_len_labs) <span class="sc">+</span></span>
<span id="cb63-599"><a href="#cb63-599" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"context amount"</span>, <span class="at">labels =</span> context_len_labs) <span class="sc">+</span></span>
<span id="cb63-600"><a href="#cb63-600" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_discrete</span>(<span class="at">name =</span> <span class="st">""</span>, <span class="at">labels =</span> est_type_labs) <span class="sc">+</span></span>
<span id="cb63-601"><a href="#cb63-601" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb63-602"><a href="#cb63-602" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.08</span>, <span class="fl">0.7</span>),</span>
<span id="cb63-603"><a href="#cb63-603" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb63-604"><a href="#cb63-604" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">size =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"white"</span>)) <span class="sc">+</span></span>
<span id="cb63-605"><a href="#cb63-605" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb63-606"><a href="#cb63-606" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"model"</span>,</span>
<span id="cb63-607"><a href="#cb63-607" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"slope at high surprisal - slope at low surprisal"</span>,</span>
<span id="cb63-608"><a href="#cb63-608" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Superlinearity by LM"</span>,</span>
<span id="cb63-609"><a href="#cb63-609" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Difference in slope of smooth predictions for high vs. low surprisal"</span>)</span>
<span id="cb63-610"><a href="#cb63-610" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave(</span></span>
<span id="cb63-611"><a href="#cb63-611" aria-hidden="true" tabindex="-1"></a><span class="co">#   paste0(</span></span>
<span id="cb63-612"><a href="#cb63-612" aria-hidden="true" tabindex="-1"></a><span class="co">#     figsdir, "", context_pref, "gaulss_halflinear_diffs3.pdf"),</span></span>
<span id="cb63-613"><a href="#cb63-613" aria-hidden="true" tabindex="-1"></a><span class="co">#   width = 5, height = 4)</span></span>
<span id="cb63-614"><a href="#cb63-614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-615"><a href="#cb63-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-616"><a href="#cb63-616" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Cutoffs most surprising words</span></span>
<span id="cb63-617"><a href="#cb63-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-620"><a href="#cb63-620" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb63-621"><a href="#cb63-621" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb63-622"><a href="#cb63-622" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb63-623"><a href="#cb63-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-624"><a href="#cb63-624" aria-hidden="true" tabindex="-1"></a>data_to_plot_multicutoffs <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb63-625"><a href="#cb63-625" aria-hidden="true" tabindex="-1"></a>  data_to_plot_smooth_wprevm, <span class="co"># cutoff=NA for these rows</span></span>
<span id="cb63-626"><a href="#cb63-626" aria-hidden="true" tabindex="-1"></a>  data_to_plot_datasubsetless6_smooth_wprevm,</span>
<span id="cb63-627"><a href="#cb63-627" aria-hidden="true" tabindex="-1"></a>  data_to_plot_datasubsetless12_smooth_wprevm</span>
<span id="cb63-628"><a href="#cb63-628" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb63-629"><a href="#cb63-629" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cutoff =</span> forcats<span class="sc">::</span><span class="fu">fct_rev</span>(forcats<span class="sc">::</span><span class="fu">as_factor</span>(cutoff)))</span>
<span id="cb63-630"><a href="#cb63-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-631"><a href="#cb63-631" aria-hidden="true" tabindex="-1"></a>compare_one_model_multi_cutoffs_surprisal<span class="ot">&lt;-</span><span class="cf">function</span>(</span>
<span id="cb63-632"><a href="#cb63-632" aria-hidden="true" tabindex="-1"></a>    data_to_plot_multicutoffs, </span>
<span id="cb63-633"><a href="#cb63-633" aria-hidden="true" tabindex="-1"></a>    <span class="at">use_shifted_est =</span> T, <span class="at">trans =</span> I, <span class="at">se.mult =</span> <span class="fl">1.96</span>,</span>
<span id="cb63-634"><a href="#cb63-634" aria-hidden="true" tabindex="-1"></a>    <span class="at">ctx_lens =</span> context_lens, <span class="at">density_df =</span> surprisal_densities, </span>
<span id="cb63-635"><a href="#cb63-635" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">"fitted effect</span><span class="sc">\n</span><span class="st">estimate (+ intercept) ±2*SE"</span>,...) {</span>
<span id="cb63-636"><a href="#cb63-636" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-637"><a href="#cb63-637" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> data_to_plot_multicutoffs <span class="sc">%&gt;%</span> </span>
<span id="cb63-638"><a href="#cb63-638" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(model<span class="sc">==</span><span class="st">"GPT3-davinci"</span>, context_len<span class="sc">==</span><span class="st">"max"</span>, est_type <span class="sc">==</span> <span class="st">"mean"</span>)</span>
<span id="cb63-639"><a href="#cb63-639" aria-hidden="true" tabindex="-1"></a>  l<span class="ot">&lt;-</span> <span class="fu">levels</span>(d<span class="sc">$</span>cutoff) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb63-640"><a href="#cb63-640" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (use_shifted_est) d <span class="ot">&lt;-</span> <span class="fu">mutate</span>(d, <span class="at">est =</span> est_shifted)</span>
<span id="cb63-641"><a href="#cb63-641" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb63-642"><a href="#cb63-642" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> surprisal, <span class="at">y =</span> <span class="fu">trans</span>(est),</span>
<span id="cb63-643"><a href="#cb63-643" aria-hidden="true" tabindex="-1"></a>               <span class="at">color=</span>cutoff, <span class="co">#linetype = !is.na(cutoff),</span></span>
<span id="cb63-644"><a href="#cb63-644" aria-hidden="true" tabindex="-1"></a>               <span class="at">ymin =</span> <span class="fu">trans</span>(est <span class="sc">-</span> se.mult<span class="sc">*</span>se), <span class="at">ymax =</span> <span class="fu">trans</span>(est <span class="sc">+</span> se.mult<span class="sc">*</span>se)))</span>
<span id="cb63-645"><a href="#cb63-645" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-646"><a href="#cb63-646" aria-hidden="true" tabindex="-1"></a>  max_surps <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb63-647"><a href="#cb63-647" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(model, context_len, cutoff) <span class="sc">%&gt;%</span> </span>
<span id="cb63-648"><a href="#cb63-648" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">max_surp=</span><span class="fu">max</span>(surprisal), <span class="at">.groups=</span><span class="st">"drop"</span>)</span>
<span id="cb63-649"><a href="#cb63-649" aria-hidden="true" tabindex="-1"></a>  density_df <span class="ot">&lt;-</span> density_df <span class="sc">%&gt;%</span> </span>
<span id="cb63-650"><a href="#cb63-650" aria-hidden="true" tabindex="-1"></a>    <span class="fu">right_join</span>(max_surps, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"model"</span>, <span class="st">"context_len"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb63-651"><a href="#cb63-651" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(surprisal <span class="sc">&lt;=</span> max_surp)</span>
<span id="cb63-652"><a href="#cb63-652" aria-hidden="true" tabindex="-1"></a>  density_ymin <span class="ot">&lt;-</span> <span class="cf">if</span> (use_shifted_est) <span class="dv">312</span> <span class="cf">else</span> <span class="sc">-</span><span class="dv">10</span></span>
<span id="cb63-653"><a href="#cb63-653" aria-hidden="true" tabindex="-1"></a>  density_df <span class="ot">&lt;-</span> <span class="fu">mutate</span>(density_df, <span class="at">density =</span> <span class="dv">120</span> <span class="sc">*</span> density <span class="sc">+</span> density_ymin)</span>
<span id="cb63-654"><a href="#cb63-654" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-655"><a href="#cb63-655" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb63-656"><a href="#cb63-656" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data =</span> density_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">est_type =</span> <span class="st">"mean"</span>),</span>
<span id="cb63-657"><a href="#cb63-657" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> <span class="cn">NULL</span>, <span class="at">ymax =</span> <span class="cn">NULL</span>, <span class="at">color =</span> cutoff,</span>
<span id="cb63-658"><a href="#cb63-658" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> density, <span class="at">x =</span> surprisal),</span>
<span id="cb63-659"><a href="#cb63-659" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">"solid"</span>, </span>
<span id="cb63-660"><a href="#cb63-660" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha=</span>.<span class="dv">25</span></span>
<span id="cb63-661"><a href="#cb63-661" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb63-662"><a href="#cb63-662" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb63-663"><a href="#cb63-663" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="at">data =</span> density_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">est_type =</span> <span class="st">"mean"</span>), <span class="at">inherit.aes =</span> F,</span>
<span id="cb63-664"><a href="#cb63-664" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> surprisal, </span>
<span id="cb63-665"><a href="#cb63-665" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lty =</span> <span class="cn">NULL</span>,</span>
<span id="cb63-666"><a href="#cb63-666" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> density_ymin, <span class="at">ymax =</span> density),</span>
<span id="cb63-667"><a href="#cb63-667" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> density_color, <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb63-668"><a href="#cb63-668" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.35</span> <span class="sc">/</span> <span class="fu">length</span>(l))</span>
<span id="cb63-669"><a href="#cb63-669" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-670"><a href="#cb63-670" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p <span class="sc">+</span> </span>
<span id="cb63-671"><a href="#cb63-671" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ggplot2::annotate(</span></span>
<span id="cb63-672"><a href="#cb63-672" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   geom="text", x=l+0.1, y=312+10, </span></span>
<span id="cb63-673"><a href="#cb63-673" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   label=glue::glue("surprisal cutoff = {l}"), </span></span>
<span id="cb63-674"><a href="#cb63-674" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   color= "grey", size=3, vjust=1, hjust=0) +</span></span>
<span id="cb63-675"><a href="#cb63-675" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">annotate</span>(</span>
<span id="cb63-676"><a href="#cb63-676" aria-hidden="true" tabindex="-1"></a>      <span class="at">geom=</span><span class="st">"segment"</span>, <span class="at">x=</span>l, <span class="at">xend=</span>l, <span class="at">y=</span><span class="sc">-</span><span class="cn">Inf</span>, <span class="at">yend=</span><span class="dv">322</span>, <span class="at">color=</span><span class="st">"grey"</span>)</span>
<span id="cb63-677"><a href="#cb63-677" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-678"><a href="#cb63-678" aria-hidden="true" tabindex="-1"></a>  p <span class="sc">+</span></span>
<span id="cb63-679"><a href="#cb63-679" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb63-680"><a href="#cb63-680" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">y=</span><span class="cn">NULL</span>, <span class="at">color =</span> <span class="cn">NULL</span>, <span class="at">fill =</span> cutoff), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb63-681"><a href="#cb63-681" aria-hidden="true" tabindex="-1"></a>    <span class="co"># scale_fill_discrete(name = "cutoff",  breaks = c(NA, l), labels = c("none", l)) +</span></span>
<span id="cb63-682"><a href="#cb63-682" aria-hidden="true" tabindex="-1"></a>    <span class="co"># scale_color_discrete(name = "cutoff", breaks = c(NA, l), labels = c("none", l)) +</span></span>
<span id="cb63-683"><a href="#cb63-683" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"cutoff"</span>, <span class="at">values=</span><span class="fu">rev</span>(scales<span class="sc">::</span><span class="fu">hue_pal</span>()(<span class="dv">14</span>)), </span>
<span id="cb63-684"><a href="#cb63-684" aria-hidden="true" tabindex="-1"></a>                   <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">18</span>,<span class="cn">NA</span>), </span>
<span id="cb63-685"><a href="#cb63-685" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">18</span>,<span class="st">"none"</span>)) <span class="sc">+</span></span>
<span id="cb63-686"><a href="#cb63-686" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"cutoff"</span>, <span class="at">values=</span><span class="fu">rev</span>(scales<span class="sc">::</span><span class="fu">hue_pal</span>()(<span class="dv">14</span>)), </span>
<span id="cb63-687"><a href="#cb63-687" aria-hidden="true" tabindex="-1"></a>                   <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">18</span>,<span class="cn">NA</span>), </span>
<span id="cb63-688"><a href="#cb63-688" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">18</span>,<span class="st">"none"</span>)) <span class="sc">+</span></span>
<span id="cb63-689"><a href="#cb63-689" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linetype_manual</span>(<span class="at">name =</span> <span class="st">"whether cutoff"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="ot">=</span><span class="dv">1</span>, <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span><span class="ot">=</span><span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb63-690"><a href="#cb63-690" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">linetype =</span> <span class="st">"none"</span>, <span class="at">size =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb63-691"><a href="#cb63-691" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"surprisal (nats)"</span>, <span class="at">y =</span> ylab)</span>
<span id="cb63-692"><a href="#cb63-692" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-693"><a href="#cb63-693" aria-hidden="true" tabindex="-1"></a>p_gpt3_cutoffs_meaneffect <span class="ot">&lt;-</span> <span class="fu">compare_one_model_multi_cutoffs_surprisal</span>(data_to_plot_multicutoffs) <span class="sc">+</span></span>
<span id="cb63-694"><a href="#cb63-694" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>( <span class="sc">~</span> model, <span class="at">labeller =</span> my_labeller, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb63-695"><a href="#cb63-695" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb63-696"><a href="#cb63-696" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">24</span>,.<span class="dv">68</span>),</span>
<span id="cb63-697"><a href="#cb63-697" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">size =</span> <span class="dv">0</span>, <span class="at">fill =</span> <span class="fu">alpha</span>(<span class="st">"white"</span>, <span class="fl">0.5</span>), <span class="at">color =</span> <span class="fu">alpha</span>(<span class="st">"white"</span>, <span class="fl">0.5</span>))</span>
<span id="cb63-698"><a href="#cb63-698" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb63-699"><a href="#cb63-699" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb63-700"><a href="#cb63-700" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"effect on mean RT ±2*SE"</span>,</span>
<span id="cb63-701"><a href="#cb63-701" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle=</span><span class="st">"Effect of surprisal on RT"</span>, </span>
<span id="cb63-702"><a href="#cb63-702" aria-hidden="true" tabindex="-1"></a>    <span class="co"># title="GAMs refit without highest surprisal items"</span></span>
<span id="cb63-703"><a href="#cb63-703" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb63-704"><a href="#cb63-704" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave(p_gpt3_cutoffs_meaneffect,</span></span>
<span id="cb63-705"><a href="#cb63-705" aria-hidden="true" tabindex="-1"></a><span class="co">#   filename = paste0(figsdir, "gpt3d_surprisal_cutoffs_effect_on_mean", ".pdf"),</span></span>
<span id="cb63-706"><a href="#cb63-706" aria-hidden="true" tabindex="-1"></a><span class="co">#   width = 3, height = 3.5)</span></span>
<span id="cb63-707"><a href="#cb63-707" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-708"><a href="#cb63-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-709"><a href="#cb63-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-710"><a href="#cb63-710" aria-hidden="true" tabindex="-1"></a><span class="fu">### Superlinearity vs perplexity</span></span>
<span id="cb63-711"><a href="#cb63-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-714"><a href="#cb63-714" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb63-715"><a href="#cb63-715" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb63-716"><a href="#cb63-716" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb63-717"><a href="#cb63-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-718"><a href="#cb63-718" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">full_join</span>(halflinear_diffs2, surprisal_means, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"model"</span>, <span class="st">"context_len"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb63-719"><a href="#cb63-719" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(context_len <span class="sc">%in%</span> context_lens, est_type <span class="sc">==</span> <span class="st">"mean"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb63-720"><a href="#cb63-720" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">diff =</span> diff_slope_hi_v_low, <span class="at">sem =</span> sum_std.error)</span>
<span id="cb63-721"><a href="#cb63-721" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb63-722"><a href="#cb63-722" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%&gt;%</span> <span class="fu">str_starts</span>(<span class="st">"GPT"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb63-723"><a href="#cb63-723" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  note: `weight` aesthetic will be passed on to lm's `weights`` in geom_smooth/geom_line</span></span>
<span id="cb63-724"><a href="#cb63-724" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span>mean_surprisal, <span class="at">y =</span> diff, <span class="at">color =</span> context_len,</span>
<span id="cb63-725"><a href="#cb63-725" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> upper, <span class="at">ymin =</span> lower, <span class="at">shape =</span> context_len,</span>
<span id="cb63-726"><a href="#cb63-726" aria-hidden="true" tabindex="-1"></a>             <span class="at">weight=</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(sem))) <span class="sc">+</span></span>
<span id="cb63-727"><a href="#cb63-727" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_grid(est_type ~ ., labeller = my_labeller, scales = "free_y") +</span></span>
<span id="cb63-728"><a href="#cb63-728" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ggpubr::stat_regline_equation(label.x.npc = .8, label.y.npc = .8, </span></span>
<span id="cb63-729"><a href="#cb63-729" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               aes(label = after_stat(eq.label))) +</span></span>
<span id="cb63-730"><a href="#cb63-730" aria-hidden="true" tabindex="-1"></a>  ggpubr<span class="sc">::</span><span class="fu">stat_regline_equation</span>(</span>
<span id="cb63-731"><a href="#cb63-731" aria-hidden="true" tabindex="-1"></a>    <span class="at">label.x.npc =</span> .<span class="dv">6</span>, <span class="at">label.y.npc =</span> .<span class="dv">95</span>, </span>
<span id="cb63-732"><a href="#cb63-732" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color=</span><span class="cn">NULL</span>, <span class="at">shape =</span><span class="cn">NULL</span>, <span class="at">label =</span> <span class="fu">after_stat</span>(rr.label)), </span>
<span id="cb63-733"><a href="#cb63-733" aria-hidden="true" tabindex="-1"></a>    <span class="at">color=</span><span class="st">"grey"</span>, <span class="at">size=</span><span class="dv">4</span>, <span class="at">show.legend  =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb63-734"><a href="#cb63-734" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb63-735"><a href="#cb63-735" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color=</span><span class="cn">NULL</span>,<span class="at">shape =</span><span class="cn">NULL</span>), </span>
<span id="cb63-736"><a href="#cb63-736" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">'y~x'</span>, <span class="at">size =</span> <span class="dv">0</span>, <span class="at">alpha =</span> .<span class="dv">1</span>, <span class="at">color=</span><span class="st">"#f1f1f1"</span>) <span class="sc">+</span> <span class="co"># SE ribbon, no line</span></span>
<span id="cb63-737"><a href="#cb63-737" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb63-738"><a href="#cb63-738" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color=</span><span class="cn">NULL</span>, <span class="at">shape =</span><span class="cn">NULL</span>), <span class="at">stat =</span> <span class="st">"smooth"</span>, </span>
<span id="cb63-739"><a href="#cb63-739" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">'y~x'</span>, <span class="at">alpha =</span> .<span class="dv">66</span>, <span class="at">lty=</span><span class="st">"dotted"</span>, <span class="at">color=</span><span class="st">"grey"</span>) <span class="sc">+</span> <span class="co"># just line</span></span>
<span id="cb63-740"><a href="#cb63-740" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">data =</span> d, <span class="at">width =</span> .<span class="dv">03</span>) <span class="sc">+</span> </span>
<span id="cb63-741"><a href="#cb63-741" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">str_starts</span>(model,<span class="st">"GPT"</span>)), <span class="at">size=</span><span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb63-742"><a href="#cb63-742" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data =</span> d,</span>
<span id="cb63-743"><a href="#cb63-743" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> model_labs[model]),</span>
<span id="cb63-744"><a href="#cb63-744" aria-hidden="true" tabindex="-1"></a>    <span class="at">max.overlaps =</span> <span class="cn">Inf</span>, <span class="at">min.segment.length =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">segment.alpha =</span> .<span class="dv">2</span>,</span>
<span id="cb63-745"><a href="#cb63-745" aria-hidden="true" tabindex="-1"></a>    <span class="at">force_pull =</span> .<span class="dv">5</span>, <span class="at">hjust =</span> .<span class="dv">9</span>,  <span class="at">box.padding =</span> .<span class="dv">5</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb63-746"><a href="#cb63-746" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb63-747"><a href="#cb63-747" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"context amount"</span>, <span class="at">labels =</span> context_len_labs) <span class="sc">+</span></span>
<span id="cb63-748"><a href="#cb63-748" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"GPT"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="ot">=</span><span class="st">"grey"</span>, <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span><span class="ot">=</span><span class="st">"white"</span>)) <span class="sc">+</span></span>
<span id="cb63-749"><a href="#cb63-749" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(</span>
<span id="cb63-750"><a href="#cb63-750" aria-hidden="true" tabindex="-1"></a>    <span class="at">values=</span><span class="cf">if</span> (twocontexts) <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">23</span>) <span class="cf">else</span> <span class="fu">c</span>(<span class="dv">21</span>,<span class="dv">22</span>,<span class="dv">23</span>), </span>
<span id="cb63-751"><a href="#cb63-751" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"context amount"</span>, <span class="at">labels =</span> context_len_labs) <span class="sc">+</span></span>
<span id="cb63-752"><a href="#cb63-752" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb63-753"><a href="#cb63-753" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"LM quality (negative log perplexity)"</span>,</span>
<span id="cb63-754"><a href="#cb63-754" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"superlinearity"</span>,</span>
<span id="cb63-755"><a href="#cb63-755" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Superlinearity vs. LM quality"</span>) <span class="sc">+</span></span>
<span id="cb63-756"><a href="#cb63-756" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>)</span>
<span id="cb63-757"><a href="#cb63-757" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-758"><a href="#cb63-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-759"><a href="#cb63-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-762"><a href="#cb63-762" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb63-763"><a href="#cb63-763" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb63-764"><a href="#cb63-764" aria-hidden="true" tabindex="-1"></a><span class="do">### FIG FOR PAPER</span></span>
<span id="cb63-765"><a href="#cb63-765" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb63-766"><a href="#cb63-766" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(</span>
<span id="cb63-767"><a href="#cb63-767" aria-hidden="true" tabindex="-1"></a>    figsdir, context_pref,</span>
<span id="cb63-768"><a href="#cb63-768" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gaulss_halflinear_diffs2_justFitGPTs_mean_v_mean_surprisal_lengthstogether.pdf"</span>),</span>
<span id="cb63-769"><a href="#cb63-769" aria-hidden="true" tabindex="-1"></a> <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="fl">4.25</span>)</span>
<span id="cb63-770"><a href="#cb63-770" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-771"><a href="#cb63-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-772"><a href="#cb63-772" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Cutoffs superlinearity</span></span>
<span id="cb63-773"><a href="#cb63-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-776"><a href="#cb63-776" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb63-777"><a href="#cb63-777" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb63-778"><a href="#cb63-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-779"><a href="#cb63-779" aria-hidden="true" tabindex="-1"></a>halflinear_diffs2_less6  <span class="ot">&lt;-</span> <span class="fu">make_halflinears_diffs_dataset</span>(half_linears2_less6)</span>
<span id="cb63-780"><a href="#cb63-780" aria-hidden="true" tabindex="-1"></a>halflinear_diffs2_less12 <span class="ot">&lt;-</span> <span class="fu">make_halflinears_diffs_dataset</span>(half_linears2_less12)</span>
<span id="cb63-781"><a href="#cb63-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-782"><a href="#cb63-782" aria-hidden="true" tabindex="-1"></a>p_gpt3d_cutoffs_superlinearity <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb63-783"><a href="#cb63-783" aria-hidden="true" tabindex="-1"></a>  halflinear_diffs2 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">cutoff =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb63-784"><a href="#cb63-784" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(model <span class="sc">==</span> <span class="st">"GPT3-davinci"</span>, context_len <span class="sc">==</span> <span class="st">"max"</span>),</span>
<span id="cb63-785"><a href="#cb63-785" aria-hidden="true" tabindex="-1"></a>  halflinear_diffs2_less6 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">cutoff =</span> <span class="dv">6</span>),</span>
<span id="cb63-786"><a href="#cb63-786" aria-hidden="true" tabindex="-1"></a>  halflinear_diffs2_less12 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">cutoff =</span> <span class="dv">12</span>)</span>
<span id="cb63-787"><a href="#cb63-787" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb63-788"><a href="#cb63-788" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(est_type <span class="sc">==</span> <span class="st">"mean"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb63-789"><a href="#cb63-789" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cutoff =</span> <span class="fu">factor</span>(cutoff)) <span class="sc">%&gt;%</span> </span>
<span id="cb63-790"><a href="#cb63-790" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(context_len <span class="sc">%in%</span> context_lens) <span class="sc">%&gt;%</span> </span>
<span id="cb63-791"><a href="#cb63-791" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">diff =</span> diff_slope_hi_v_low, <span class="at">sem =</span> sum_std.error) <span class="sc">%&gt;%</span></span>
<span id="cb63-792"><a href="#cb63-792" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> cutoff, <span class="at">y =</span> diff, <span class="at">color =</span> cutoff, </span>
<span id="cb63-793"><a href="#cb63-793" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> upper, <span class="at">ymin =</span> lower)) <span class="sc">+</span></span>
<span id="cb63-794"><a href="#cb63-794" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">width =</span> .<span class="dv">03</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb63-795"><a href="#cb63-795" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>( <span class="sc">~</span> model, <span class="at">labeller =</span> my_labeller, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb63-796"><a href="#cb63-796" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"cutoff"</span>, <span class="at">values=</span><span class="fu">rev</span>(scales<span class="sc">::</span><span class="fu">hue_pal</span>()(<span class="dv">14</span>)), </span>
<span id="cb63-797"><a href="#cb63-797" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">18</span>,<span class="cn">NA</span>), </span>
<span id="cb63-798"><a href="#cb63-798" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">18</span>,<span class="st">"none"</span>)) <span class="sc">+</span></span>
<span id="cb63-799"><a href="#cb63-799" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">name =</span> <span class="st">"cutoff"</span>, </span>
<span id="cb63-800"><a href="#cb63-800" aria-hidden="true" tabindex="-1"></a>                   <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">18</span>,<span class="cn">NA</span>), </span>
<span id="cb63-801"><a href="#cb63-801" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">18</span>,<span class="st">"none"</span>)) <span class="sc">+</span></span>
<span id="cb63-802"><a href="#cb63-802" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb63-803"><a href="#cb63-803" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span> </span>
<span id="cb63-804"><a href="#cb63-804" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb63-805"><a href="#cb63-805" aria-hidden="true" tabindex="-1"></a>    <span class="co"># x = "Cutoff",</span></span>
<span id="cb63-806"><a href="#cb63-806" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"superlinearity</span><span class="sc">\n</span><span class="st">of effect on mean RT"</span>,</span>
<span id="cb63-807"><a href="#cb63-807" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Superlinearity"</span></span>
<span id="cb63-808"><a href="#cb63-808" aria-hidden="true" tabindex="-1"></a>    <span class="co"># title = "GAMs refit without highest surprisal items"</span></span>
<span id="cb63-809"><a href="#cb63-809" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb63-810"><a href="#cb63-810" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb63-811"><a href="#cb63-811" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave(p_gpt3d_cutoffs_superlinearity,</span></span>
<span id="cb63-812"><a href="#cb63-812" aria-hidden="true" tabindex="-1"></a><span class="co">#   filename = paste0(figsdir, "gpt3d_surprisal_cutoffs", ".pdf"),</span></span>
<span id="cb63-813"><a href="#cb63-813" aria-hidden="true" tabindex="-1"></a><span class="co">#   width = 3, height = 3.5)</span></span>
<span id="cb63-814"><a href="#cb63-814" aria-hidden="true" tabindex="-1"></a><span class="fu">wrap_plots</span>(</span>
<span id="cb63-815"><a href="#cb63-815" aria-hidden="true" tabindex="-1"></a>  p_gpt3_cutoffs_meaneffect, </span>
<span id="cb63-816"><a href="#cb63-816" aria-hidden="true" tabindex="-1"></a>  p_gpt3d_cutoffs_superlinearity, <span class="at">guides =</span> <span class="st">"collect"</span>, <span class="at">widths =</span> <span class="fu">c</span>(<span class="fl">1.2</span>,<span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb63-817"><a href="#cb63-817" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb63-818"><a href="#cb63-818" aria-hidden="true" tabindex="-1"></a>    <span class="at">title=</span><span class="st">"GAMs refit without highest surprisal items"</span>)</span>
<span id="cb63-819"><a href="#cb63-819" aria-hidden="true" tabindex="-1"></a><span class="do">### FIG FOR PAPER</span></span>
<span id="cb63-820"><a href="#cb63-820" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb63-821"><a href="#cb63-821" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="fu">paste0</span>(figsdir, <span class="st">"gpt3d_surprisal_cutoffs"</span>, <span class="st">".pdf"</span>),</span>
<span id="cb63-822"><a href="#cb63-822" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="fl">3.5</span>)</span>
<span id="cb63-823"><a href="#cb63-823" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-824"><a href="#cb63-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-825"><a href="#cb63-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-826"><a href="#cb63-826" aria-hidden="true" tabindex="-1"></a><span class="fu">## Linear model coefficients</span></span>
<span id="cb63-827"><a href="#cb63-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-830"><a href="#cb63-830" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb63-831"><a href="#cb63-831" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb63-832"><a href="#cb63-832" aria-hidden="true" tabindex="-1"></a>summaries_linear <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(</span>
<span id="cb63-833"><a href="#cb63-833" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"model-summaries-NEW-linear-wprevm.rds"</span>))</span>
<span id="cb63-834"><a href="#cb63-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-835"><a href="#cb63-835" aria-hidden="true" tabindex="-1"></a>linear_coefs<span class="ot">&lt;-</span>purrr<span class="sc">::</span><span class="fu">map_df</span>(</span>
<span id="cb63-836"><a href="#cb63-836" aria-hidden="true" tabindex="-1"></a>     summaries_linear, </span>
<span id="cb63-837"><a href="#cb63-837" aria-hidden="true" tabindex="-1"></a>     \(s) {s<span class="sc">$</span>p.table <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">term=</span><span class="fu">names</span>(s<span class="sc">$</span>p.pv))},</span>
<span id="cb63-838"><a href="#cb63-838" aria-hidden="true" tabindex="-1"></a>     <span class="at">.id =</span> <span class="st">"model"</span>)</span>
<span id="cb63-839"><a href="#cb63-839" aria-hidden="true" tabindex="-1"></a>linear_coefs <span class="sc">%&gt;%</span></span>
<span id="cb63-840"><a href="#cb63-840" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_modelnames</span>() <span class="sc">%&gt;%</span></span>
<span id="cb63-841"><a href="#cb63-841" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(context_len <span class="sc">%in%</span> context_lens) <span class="sc">%&gt;%</span> </span>
<span id="cb63-842"><a href="#cb63-842" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>model,<span class="at">y=</span>Estimate,<span class="co">#y=`Pr(&gt;|z|)`,</span></span>
<span id="cb63-843"><a href="#cb63-843" aria-hidden="true" tabindex="-1"></a>             <span class="at">color=</span>context_len)) <span class="sc">+</span></span>
<span id="cb63-844"><a href="#cb63-844" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>term, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">labeller=</span>my_labeller) <span class="sc">+</span></span>
<span id="cb63-845"><a href="#cb63-845" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">30</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb63-846"><a href="#cb63-846" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"context amount"</span>, <span class="at">labels =</span> context_len_labs) </span>
<span id="cb63-847"><a href="#cb63-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-848"><a href="#cb63-848" aria-hidden="true" tabindex="-1"></a><span class="co"># Whether to include both mean and variance</span></span>
<span id="cb63-849"><a href="#cb63-849" aria-hidden="true" tabindex="-1"></a>which_terms <span class="ot">&lt;-</span> <span class="st">"both"</span> <span class="co"># specify either "surprisal", "surprisal.1", or "both"</span></span>
<span id="cb63-850"><a href="#cb63-850" aria-hidden="true" tabindex="-1"></a>terms_included <span class="ot">&lt;-</span> <span class="cf">if</span> (which_terms<span class="sc">==</span><span class="st">"both"</span>) <span class="fu">c</span>(<span class="st">"surprisal"</span>, <span class="st">"surprisal.1"</span>) <span class="cf">else</span> which_terms</span>
<span id="cb63-851"><a href="#cb63-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-852"><a href="#cb63-852" aria-hidden="true" tabindex="-1"></a>linear_coefs <span class="sc">%&gt;%</span> </span>
<span id="cb63-853"><a href="#cb63-853" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_modelnames</span>() <span class="sc">%&gt;%</span></span>
<span id="cb63-854"><a href="#cb63-854" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> dplyr<span class="sc">::</span><span class="fu">recode</span>(model, <span class="sc">!!!</span>model_labs)) <span class="sc">%&gt;%</span> </span>
<span id="cb63-855"><a href="#cb63-855" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(context_len <span class="sc">%in%</span> context_lens) <span class="sc">%&gt;%</span> </span>
<span id="cb63-856"><a href="#cb63-856" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">%in%</span> terms_included) <span class="sc">%&gt;%</span> </span>
<span id="cb63-857"><a href="#cb63-857" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>model,<span class="at">y=</span>Estimate,</span>
<span id="cb63-858"><a href="#cb63-858" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin=</span>Estimate<span class="fl">-1.96</span><span class="sc">*</span><span class="st">`</span><span class="at">Std. Error</span><span class="st">`</span>,</span>
<span id="cb63-859"><a href="#cb63-859" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax=</span>Estimate<span class="fl">+1.96</span><span class="sc">*</span><span class="st">`</span><span class="at">Std. Error</span><span class="st">`</span>,</span>
<span id="cb63-860"><a href="#cb63-860" aria-hidden="true" tabindex="-1"></a>             <span class="at">color=</span>context_len)) <span class="sc">+</span></span>
<span id="cb63-861"><a href="#cb63-861" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape=</span>context_len)) <span class="sc">+</span> </span>
<span id="cb63-862"><a href="#cb63-862" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">width =</span> .<span class="dv">25</span>, <span class="at">alpha=</span><span class="fl">0.75</span>) <span class="sc">+</span> </span>
<span id="cb63-863"><a href="#cb63-863" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(term<span class="sc">~</span>., <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">labeller=</span>my_labeller) <span class="sc">+</span></span>
<span id="cb63-864"><a href="#cb63-864" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"context amount"</span>, <span class="at">labels =</span> context_len_labs) <span class="sc">+</span></span>
<span id="cb63-865"><a href="#cb63-865" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(</span>
<span id="cb63-866"><a href="#cb63-866" aria-hidden="true" tabindex="-1"></a>    <span class="at">values=</span><span class="cf">if</span> (twocontexts) <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>) <span class="cf">else</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">5</span>), <span class="at">name =</span> <span class="st">"context amount"</span>, </span>
<span id="cb63-867"><a href="#cb63-867" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> context_len_labs) <span class="sc">+</span></span>
<span id="cb63-868"><a href="#cb63-868" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">30</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb63-869"><a href="#cb63-869" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position=</span><span class="st">"top"</span>)  <span class="sc">+</span></span>
<span id="cb63-870"><a href="#cb63-870" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"LM"</span>, <span class="at">y =</span> <span class="st">"coefficient estimate"</span>,</span>
<span id="cb63-871"><a href="#cb63-871" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"Effect of surprisal"</span>,</span>
<span id="cb63-872"><a href="#cb63-872" aria-hidden="true" tabindex="-1"></a>                      <span class="st">" on RT and variance in RT"</span>), <span class="co">#&lt;- hardcoded for which_terms="both"</span></span>
<span id="cb63-873"><a href="#cb63-873" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle=</span><span class="st">"from linear control GAMs"</span>)</span>
<span id="cb63-874"><a href="#cb63-874" aria-hidden="true" tabindex="-1"></a><span class="do">### FIG FOR PAPER (2 contexts)</span></span>
<span id="cb63-875"><a href="#cb63-875" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb63-876"><a href="#cb63-876" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(figsdir, context_pref, <span class="st">"gaulss_linear_coefs_"</span>, which_terms, <span class="st">".pdf"</span>),</span>
<span id="cb63-877"><a href="#cb63-877" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">5</span>, <span class="at">height =</span> <span class="cf">if</span> (which_terms <span class="sc">==</span> <span class="st">"both"</span>) <span class="fl">4.5</span> <span class="cf">else</span> <span class="dv">3</span>)</span>
<span id="cb63-878"><a href="#cb63-878" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-879"><a href="#cb63-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-880"><a href="#cb63-880" aria-hidden="true" tabindex="-1"></a><span class="fu">## Autocorrelation plots</span></span>
<span id="cb63-881"><a href="#cb63-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-884"><a href="#cb63-884" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb63-885"><a href="#cb63-885" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb63-886"><a href="#cb63-886" aria-hidden="true" tabindex="-1"></a><span class="co"># Load a model to inspect (P)ACF of</span></span>
<span id="cb63-887"><a href="#cb63-887" aria-hidden="true" tabindex="-1"></a>m_wprevmk6_gpt3d <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(</span>
<span id="cb63-888"><a href="#cb63-888" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"GAM_models/GPT3-davinci.rds"</span>))</span>
<span id="cb63-889"><a href="#cb63-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-890"><a href="#cb63-890" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the data on which the model was trained:</span></span>
<span id="cb63-891"><a href="#cb63-891" aria-hidden="true" tabindex="-1"></a>fitdata_perword <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(</span>
<span id="cb63-892"><a href="#cb63-892" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"surps_lms.RTs.perword.rds"</span>))</span>
<span id="cb63-893"><a href="#cb63-893" aria-hidden="true" tabindex="-1"></a>fitdata <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(</span>
<span id="cb63-894"><a href="#cb63-894" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"surps_lms.RTs.rds"</span>))</span>
<span id="cb63-895"><a href="#cb63-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-896"><a href="#cb63-896" aria-hidden="true" tabindex="-1"></a><span class="co"># file prepare_data.R defines functions</span></span>
<span id="cb63-897"><a href="#cb63-897" aria-hidden="true" tabindex="-1"></a><span class="co"># - `prepare_data_with_perword`</span></span>
<span id="cb63-898"><a href="#cb63-898" aria-hidden="true" tabindex="-1"></a><span class="co"># - `sort_data_for_tokenization_type`</span></span>
<span id="cb63-899"><a href="#cb63-899" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"utils/prepare_data.R"</span>)</span>
<span id="cb63-900"><a href="#cb63-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-901"><a href="#cb63-901" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare data as it was prepared for model when trained</span></span>
<span id="cb63-902"><a href="#cb63-902" aria-hidden="true" tabindex="-1"></a>data_prepared_gpt3d <span class="ot">&lt;-</span> <span class="fu">prepare_data_with_perword</span>(</span>
<span id="cb63-903"><a href="#cb63-903" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> fitdata, <span class="at">data.perword =</span> fitdata_perword, </span>
<span id="cb63-904"><a href="#cb63-904" aria-hidden="true" tabindex="-1"></a>  <span class="at">modelname =</span> <span class="st">"GPT3-davinci"</span>, <span class="at">how_many_prevs =</span> <span class="dv">1</span>)</span>
<span id="cb63-905"><a href="#cb63-905" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-906"><a href="#cb63-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-907"><a href="#cb63-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-908"><a href="#cb63-908" aria-hidden="true" tabindex="-1"></a>Make function to (gg)plot ACF</span>
<span id="cb63-911"><a href="#cb63-911" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb63-912"><a href="#cb63-912" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb63-913"><a href="#cb63-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-914"><a href="#cb63-914" aria-hidden="true" tabindex="-1"></a>get_clim <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">ci=</span><span class="fl">0.95</span>, <span class="at">ci.type=</span><span class="st">"white"</span>){</span>
<span id="cb63-915"><a href="#cb63-915" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' Gets confidence limit data from acf object `x`</span></span>
<span id="cb63-916"><a href="#cb63-916" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>ci.type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"ma"</span>)) <span class="fu">stop</span>(<span class="st">'`ci.type` must be "white" or "ma"'</span>)</span>
<span id="cb63-917"><a href="#cb63-917" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">class</span>(x) <span class="sc">!=</span> <span class="st">"acf"</span>) <span class="fu">stop</span>(<span class="st">'pass in object of class "acf"'</span>)</span>
<span id="cb63-918"><a href="#cb63-918" aria-hidden="true" tabindex="-1"></a>  clim0 <span class="ot">&lt;-</span> <span class="fu">qnorm</span>((<span class="dv">1</span> <span class="sc">+</span> ci)<span class="sc">/</span><span class="dv">2</span>) <span class="sc">/</span> <span class="fu">sqrt</span>(x<span class="sc">$</span>n.used)</span>
<span id="cb63-919"><a href="#cb63-919" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (ci.type <span class="sc">==</span> <span class="st">"ma"</span>) {</span>
<span id="cb63-920"><a href="#cb63-920" aria-hidden="true" tabindex="-1"></a>    clim <span class="ot">&lt;-</span> clim0 <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="fu">cumsum</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span> <span class="sc">*</span> x<span class="sc">$</span>acf[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>))) </span>
<span id="cb63-921"><a href="#cb63-921" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(clim[<span class="sc">-</span><span class="fu">length</span>(clim)])</span>
<span id="cb63-922"><a href="#cb63-922" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb63-923"><a href="#cb63-923" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(clim0)</span>
<span id="cb63-924"><a href="#cb63-924" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-925"><a href="#cb63-925" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-926"><a href="#cb63-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-927"><a href="#cb63-927" aria-hidden="true" tabindex="-1"></a>ggplot_acf <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb63-928"><a href="#cb63-928" aria-hidden="true" tabindex="-1"></a>    x,</span>
<span id="cb63-929"><a href="#cb63-929" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci=</span><span class="fl">0.95</span>, <span class="at">ci.type=</span><span class="st">"white"</span>, <span class="at">ci.col =</span> <span class="st">"blue"</span>){</span>
<span id="cb63-930"><a href="#cb63-930" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' Replicates plot.acf() but using ggplot by default instead of base R plot</span></span>
<span id="cb63-931"><a href="#cb63-931" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' `x` must be an object of class "acf" such as that outputted by `acf()`</span></span>
<span id="cb63-932"><a href="#cb63-932" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' `ci.type` must be "white" or "ma"</span></span>
<span id="cb63-933"><a href="#cb63-933" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>ci.type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"ma"</span>)) <span class="fu">stop</span>(<span class="st">'`ci.type` must be "white" or "ma"'</span>)</span>
<span id="cb63-934"><a href="#cb63-934" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">class</span>(x) <span class="sc">!=</span> <span class="st">"acf"</span>) <span class="fu">stop</span>(<span class="st">'pass in object of class "acf"'</span>)</span>
<span id="cb63-935"><a href="#cb63-935" aria-hidden="true" tabindex="-1"></a>  with.ci <span class="ot">&lt;-</span> ci <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> x<span class="sc">$</span>type <span class="sc">!=</span> <span class="st">"covariance"</span></span>
<span id="cb63-936"><a href="#cb63-936" aria-hidden="true" tabindex="-1"></a>  with.ci.ma <span class="ot">&lt;-</span> with.ci <span class="sc">&amp;&amp;</span> ci.type <span class="sc">==</span> <span class="st">"ma"</span> <span class="sc">&amp;&amp;</span> x<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"correlation"</span></span>
<span id="cb63-937"><a href="#cb63-937" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(with.ci.ma <span class="sc">&amp;&amp;</span> x<span class="sc">$</span>lag[1L, 1L, 1L] <span class="sc">!=</span> 0L) {</span>
<span id="cb63-938"><a href="#cb63-938" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">"can use ci.type=</span><span class="sc">\"</span><span class="st">ma</span><span class="sc">\"</span><span class="st"> only if first lag is 0"</span>)</span>
<span id="cb63-939"><a href="#cb63-939" aria-hidden="true" tabindex="-1"></a>    with.ci.ma <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb63-940"><a href="#cb63-940" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-941"><a href="#cb63-941" aria-hidden="true" tabindex="-1"></a>  clim <span class="ot">&lt;-</span> <span class="fu">get_clim</span>(x, <span class="at">ci=</span>ci, <span class="at">ci.type=</span>ci.type)</span>
<span id="cb63-942"><a href="#cb63-942" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">lag =</span> x<span class="sc">$</span>lag, <span class="at">acf=</span>x<span class="sc">$</span>acf)</span>
<span id="cb63-943"><a href="#cb63-943" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>lag)) <span class="sc">+</span></span>
<span id="cb63-944"><a href="#cb63-944" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymax=</span>acf, <span class="at">ymin=</span><span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb63-945"><a href="#cb63-945" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y=</span><span class="st">"ACF"</span>, <span class="at">x=</span><span class="st">"Lag"</span>)</span>
<span id="cb63-946"><a href="#cb63-946" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (with.ci) {</span>
<span id="cb63-947"><a href="#cb63-947" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (ci.type <span class="sc">==</span> <span class="st">"white"</span>) {</span>
<span id="cb63-948"><a href="#cb63-948" aria-hidden="true" tabindex="-1"></a>      p <span class="ot">&lt;-</span> p <span class="sc">+</span> </span>
<span id="cb63-949"><a href="#cb63-949" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span><span class="sc">-</span>clim, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> ci.col) <span class="sc">+</span></span>
<span id="cb63-950"><a href="#cb63-950" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span><span class="sc">+</span>clim, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> ci.col)</span>
<span id="cb63-951"><a href="#cb63-951" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (with.ci.ma <span class="sc">&amp;&amp;</span> ci.type <span class="sc">==</span> <span class="st">"ma"</span>) { <span class="co"># ci.type="ma" not allowed for pacf</span></span>
<span id="cb63-952"><a href="#cb63-952" aria-hidden="true" tabindex="-1"></a>      dfclim <span class="ot">&lt;-</span> df[<span class="sc">-</span><span class="dv">1</span>,]</span>
<span id="cb63-953"><a href="#cb63-953" aria-hidden="true" tabindex="-1"></a>      dfclim<span class="sc">$</span>clim <span class="ot">&lt;-</span> clim</span>
<span id="cb63-954"><a href="#cb63-954" aria-hidden="true" tabindex="-1"></a>      p <span class="ot">&lt;-</span> p <span class="sc">+</span> </span>
<span id="cb63-955"><a href="#cb63-955" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="at">data =</span> dfclim, <span class="fu">aes</span>(<span class="at">y =</span> <span class="dv">0</span><span class="sc">-</span>clim), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> ci.col) <span class="sc">+</span></span>
<span id="cb63-956"><a href="#cb63-956" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="at">data =</span> dfclim, <span class="fu">aes</span>(<span class="at">y =</span> <span class="dv">0</span><span class="sc">+</span>clim), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> ci.col)</span>
<span id="cb63-957"><a href="#cb63-957" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb63-958"><a href="#cb63-958" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-959"><a href="#cb63-959" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb63-960"><a href="#cb63-960" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-961"><a href="#cb63-961" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-962"><a href="#cb63-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-963"><a href="#cb63-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-964"><a href="#cb63-964" aria-hidden="true" tabindex="-1"></a><span class="in">```{r acf_resid_gg}</span></span>
<span id="cb63-965"><a href="#cb63-965" aria-hidden="true" tabindex="-1"></a>acf_resid_gg <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb63-966"><a href="#cb63-966" aria-hidden="true" tabindex="-1"></a>    x, split_pred, dat, <span class="at">plot_sd=</span>F, <span class="at">sig=</span>F, <span class="at">series_length=</span><span class="cn">NULL</span>, ...){</span>
<span id="cb63-967"><a href="#cb63-967" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' x should be either a model, that is: class(x) = "bam" "gam" "glm" "lm" </span></span>
<span id="cb63-968"><a href="#cb63-968" aria-hidden="true" tabindex="-1"></a>  <span class="co">#'             or a numeric vector (of residuals, say)</span></span>
<span id="cb63-969"><a href="#cb63-969" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' sig is the significance upper and lower lines (+- 1.96)</span></span>
<span id="cb63-970"><a href="#cb63-970" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' series_length is the length of the series needed for sig</span></span>
<span id="cb63-971"><a href="#cb63-971" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is</span>(x,<span class="st">"lm"</span>)){</span>
<span id="cb63-972"><a href="#cb63-972" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">resid</span>(x)</span>
<span id="cb63-973"><a href="#cb63-973" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb63-974"><a href="#cb63-974" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is</span>(x,<span class="st">"numeric"</span>)) {</span>
<span id="cb63-975"><a href="#cb63-975" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"Don't know what to do with input object of class {class(x)}"</span>))</span>
<span id="cb63-976"><a href="#cb63-976" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb63-977"><a href="#cb63-977" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-978"><a href="#cb63-978" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(dat))</span>
<span id="cb63-979"><a href="#cb63-979" aria-hidden="true" tabindex="-1"></a>    dat <span class="ot">&lt;-</span><span class="fu">tibble</span>(<span class="at">x=</span>x,<span class="at">response=</span><span class="cn">NaN</span>)</span>
<span id="cb63-980"><a href="#cb63-980" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb63-981"><a href="#cb63-981" aria-hidden="true" tabindex="-1"></a>  dat[<span class="sc">!</span><span class="fu">is.na</span>(dat<span class="sc">$</span>response),]<span class="sc">$</span>x <span class="ot">&lt;-</span> x</span>
<span id="cb63-982"><a href="#cb63-982" aria-hidden="true" tabindex="-1"></a>  acf <span class="ot">&lt;-</span> itsadug<span class="sc">::</span><span class="fu">acf_plot</span>(dat<span class="sc">$</span>x, <span class="at">plot=</span>F, <span class="at">split_by =</span> split_pred, ...)</span>
<span id="cb63-983"><a href="#cb63-983" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">acf=</span>acf,<span class="at">lag=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="fu">length</span>(acf)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb63-984"><a href="#cb63-984" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb63-985"><a href="#cb63-985" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>lag,<span class="at">y=</span>acf)) <span class="sc">+</span></span>
<span id="cb63-986"><a href="#cb63-986" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">width=</span><span class="fl">0.1</span>, <span class="at">alpha=</span><span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb63-987"><a href="#cb63-987" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>()</span>
<span id="cb63-988"><a href="#cb63-988" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(plot_sd){</span>
<span id="cb63-989"><a href="#cb63-989" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb63-990"><a href="#cb63-990" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">sd=</span>itsadug<span class="sc">::</span><span class="fu">acf_plot</span>(dat<span class="sc">$</span>x, <span class="at">fun=</span>sd, <span class="at">plot=</span>F, <span class="at">split_by =</span> split_pred, ...))</span>
<span id="cb63-991"><a href="#cb63-991" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb63-992"><a href="#cb63-992" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>lag,<span class="at">y=</span>acf)) <span class="sc">+</span></span>
<span id="cb63-993"><a href="#cb63-993" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_col</span>(<span class="at">width=</span><span class="fl">0.4</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb63-994"><a href="#cb63-994" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>acf<span class="fl">-1.96</span><span class="sc">*</span>sd,<span class="at">ymax=</span>acf<span class="fl">+1.96</span><span class="sc">*</span>sd), <span class="at">width=</span><span class="fl">0.3</span>, <span class="at">color=</span><span class="st">"red"</span>) </span>
<span id="cb63-995"><a href="#cb63-995" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-996"><a href="#cb63-996" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(sig){</span>
<span id="cb63-997"><a href="#cb63-997" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(series_length)) { <span class="fu">stop</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"You must specify series length"</span>)) }</span>
<span id="cb63-998"><a href="#cb63-998" aria-hidden="true" tabindex="-1"></a>    sig <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.05</span> <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="fu">sqrt</span>(series_length)</span>
<span id="cb63-999"><a href="#cb63-999" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb63-1000"><a href="#cb63-1000" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span> <span class="sc">-</span> sig, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb63-1001"><a href="#cb63-1001" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span> <span class="sc">+</span> sig, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"blue"</span>)</span>
<span id="cb63-1002"><a href="#cb63-1002" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-1003"><a href="#cb63-1003" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb63-1004"><a href="#cb63-1004" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-1005"><a href="#cb63-1005" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-1006"><a href="#cb63-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1007"><a href="#cb63-1007" aria-hidden="true" tabindex="-1"></a>Data ordering</span>
<span id="cb63-1008"><a href="#cb63-1008" aria-hidden="true" tabindex="-1"></a>: When plotting GAM fits (with <span class="in">`plot.gam()`</span> for example) it doesn't matter what order the data is in but when plotting ACF of residuals the order of the data does matter. So be careful (note, for <span class="in">`itsadug::acf_resid`</span>, with the right <span class="in">`split_pred`</span> selected, it will work).</span>
<span id="cb63-1009"><a href="#cb63-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1010"><a href="#cb63-1010" aria-hidden="true" tabindex="-1"></a><span class="in">```{r add_resids}</span></span>
<span id="cb63-1011"><a href="#cb63-1011" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's get the residuals and then put them in the right order,</span></span>
<span id="cb63-1012"><a href="#cb63-1012" aria-hidden="true" tabindex="-1"></a><span class="co"># that is, sort by subject &gt; story_num &gt; word_num_in_story.</span></span>
<span id="cb63-1013"><a href="#cb63-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1014"><a href="#cb63-1014" aria-hidden="true" tabindex="-1"></a>assertthat<span class="sc">::</span><span class="fu">are_equal</span>( <span class="co"># note: already removed NAs so nothing to worry about there</span></span>
<span id="cb63-1015"><a href="#cb63-1015" aria-hidden="true" tabindex="-1"></a>  data_prepared_gpt3d <span class="sc">%&gt;%</span> nrow,</span>
<span id="cb63-1016"><a href="#cb63-1016" aria-hidden="true" tabindex="-1"></a>  <span class="fu">resid</span>(m_wprevmk6_gpt3d) <span class="sc">%&gt;%</span> length) </span>
<span id="cb63-1017"><a href="#cb63-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1018"><a href="#cb63-1018" aria-hidden="true" tabindex="-1"></a>data_prepared_gpt3d_withresids <span class="ot">&lt;-</span> data_prepared_gpt3d</span>
<span id="cb63-1019"><a href="#cb63-1019" aria-hidden="true" tabindex="-1"></a>data_prepared_gpt3d_withresids<span class="sc">$</span>resids <span class="ot">&lt;-</span> <span class="fu">resid</span>(m_wprevmk6_gpt3d)</span>
<span id="cb63-1020"><a href="#cb63-1020" aria-hidden="true" tabindex="-1"></a>data_resorted <span class="ot">&lt;-</span> <span class="fu">arrange</span>(</span>
<span id="cb63-1021"><a href="#cb63-1021" aria-hidden="true" tabindex="-1"></a>  data_prepared_gpt3d_withresids, subject, story_num, word_num_in_story)</span>
<span id="cb63-1022"><a href="#cb63-1022" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-1023"><a href="#cb63-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1024"><a href="#cb63-1024" aria-hidden="true" tabindex="-1"></a>Thee dataframe <span class="in">`data_resorted`</span> will now work for getting ACF of resids.  Just one more thing: We just need to subset the data to remove the handful of observations from workers who only started stories, but didn't get far (this messes up getting ACF plots for reasons I'm unsure of). Since it's only a very small number of items, this won't affect the autocorrelation results much.</span>
<span id="cb63-1025"><a href="#cb63-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1026"><a href="#cb63-1026" aria-hidden="true" tabindex="-1"></a><span class="in">```{r subset_workers}</span></span>
<span id="cb63-1027"><a href="#cb63-1027" aria-hidden="true" tabindex="-1"></a>subset_workers<span class="ot">&lt;-</span><span class="cf">function</span>(<span class="at">nItems_threshold_productive =</span> <span class="dv">1000</span>, <span class="at">data=</span>fitdata){</span>
<span id="cb63-1028"><a href="#cb63-1028" aria-hidden="true" tabindex="-1"></a>  how_many_stories_per_worker <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(WorkerId) <span class="sc">%&gt;%</span></span>
<span id="cb63-1029"><a href="#cb63-1029" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">n_stories=</span><span class="fu">n_distinct</span>(story_num)) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n_stories))</span>
<span id="cb63-1030"><a href="#cb63-1030" aria-hidden="true" tabindex="-1"></a>  how_many_items_per_worker <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(WorkerId) <span class="sc">%&gt;%</span></span>
<span id="cb63-1031"><a href="#cb63-1031" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>() <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb63-1032"><a href="#cb63-1032" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">is_productive =</span> n <span class="sc">&gt;</span> nItems_threshold_productive)</span>
<span id="cb63-1033"><a href="#cb63-1033" aria-hidden="true" tabindex="-1"></a>  workers_info <span class="ot">&lt;-</span> <span class="fu">full_join</span>(</span>
<span id="cb63-1034"><a href="#cb63-1034" aria-hidden="true" tabindex="-1"></a>    how_many_stories_per_worker, how_many_items_per_worker, <span class="at">by =</span> <span class="st">"WorkerId"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-1035"><a href="#cb63-1035" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(is_productive), <span class="fu">desc</span>(n_stories), </span>
<span id="cb63-1036"><a href="#cb63-1036" aria-hidden="true" tabindex="-1"></a>            (n<span class="sc">-</span><span class="fu">median</span>(how_many_items_per_worker<span class="sc">$</span>n))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb63-1037"><a href="#cb63-1037" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(workers_info)</span>
<span id="cb63-1038"><a href="#cb63-1038" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-1039"><a href="#cb63-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1040"><a href="#cb63-1040" aria-hidden="true" tabindex="-1"></a>workers_info <span class="ot">&lt;-</span> <span class="fu">subset_workers</span>(<span class="at">nItems_threshold_productive =</span> <span class="dv">1500</span>)</span>
<span id="cb63-1041"><a href="#cb63-1041" aria-hidden="true" tabindex="-1"></a>excluded_workers_info <span class="ot">&lt;-</span> workers_info <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>is_productive <span class="sc">|</span> n_stories <span class="sc">&lt;=</span> <span class="dv">2</span>)</span>
<span id="cb63-1042"><a href="#cb63-1042" aria-hidden="true" tabindex="-1"></a>selected_workers_info <span class="ot">&lt;-</span> workers_info <span class="sc">%&gt;%</span> <span class="fu">filter</span>(is_productive, n_stories <span class="sc">&gt;</span> <span class="dv">2</span>)</span>
<span id="cb63-1043"><a href="#cb63-1043" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Excluding workers with few or sparse observations,"</span>,</span>
<span id="cb63-1044"><a href="#cb63-1044" aria-hidden="true" tabindex="-1"></a>    <span class="st">"for calculating ACF.</span><span class="sc">\n</span><span class="st"> proportion of workers excluded = "</span>, </span>
<span id="cb63-1045"><a href="#cb63-1045" aria-hidden="true" tabindex="-1"></a>    <span class="fu">length</span>(excluded_workers_info<span class="sc">$</span>n),<span class="st">"out of"</span>, <span class="fu">length</span>(workers_info<span class="sc">$</span>n),<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb63-1046"><a href="#cb63-1046" aria-hidden="true" tabindex="-1"></a>    <span class="st">"proportion of items excluded = "</span>, </span>
<span id="cb63-1047"><a href="#cb63-1047" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(excluded_workers_info<span class="sc">$</span>n)<span class="sc">/</span><span class="fu">sum</span>(workers_info<span class="sc">$</span>n),<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb63-1048"><a href="#cb63-1048" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(selected_workers_info)</span>
<span id="cb63-1049"><a href="#cb63-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1050"><a href="#cb63-1050" aria-hidden="true" tabindex="-1"></a><span class="co"># Unsorted</span></span>
<span id="cb63-1051"><a href="#cb63-1051" aria-hidden="true" tabindex="-1"></a>data_prepared_gpt3d_withresids_sub <span class="ot">&lt;-</span> data_prepared_gpt3d_withresids <span class="sc">%&gt;%</span></span>
<span id="cb63-1052"><a href="#cb63-1052" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(WorkerId <span class="sc">%in%</span> selected_workers_info<span class="sc">$</span>WorkerId)</span>
<span id="cb63-1053"><a href="#cb63-1053" aria-hidden="true" tabindex="-1"></a><span class="co"># Sorted</span></span>
<span id="cb63-1054"><a href="#cb63-1054" aria-hidden="true" tabindex="-1"></a>data_resorted_subset <span class="ot">&lt;-</span> data_resorted <span class="sc">%&gt;%</span> </span>
<span id="cb63-1055"><a href="#cb63-1055" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(WorkerId <span class="sc">%in%</span> selected_workers_info<span class="sc">$</span>WorkerId)</span>
<span id="cb63-1056"><a href="#cb63-1056" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-1057"><a href="#cb63-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1058"><a href="#cb63-1058" aria-hidden="true" tabindex="-1"></a>Example comparing the necessity of sorting</span>
<span id="cb63-1059"><a href="#cb63-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1060"><a href="#cb63-1060" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot_example}</span></span>
<span id="cb63-1061"><a href="#cb63-1061" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb63-1062"><a href="#cb63-1062" aria-hidden="true" tabindex="-1"></a>data_prepared_gpt3d_withresids <span class="sc">%&gt;%</span> </span>
<span id="cb63-1063"><a href="#cb63-1063" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(resids) <span class="sc">%&gt;%</span> </span>
<span id="cb63-1064"><a href="#cb63-1064" aria-hidden="true" tabindex="-1"></a>  itsadug<span class="sc">::</span><span class="fu">acf_plot</span>(</span>
<span id="cb63-1065"><a href="#cb63-1065" aria-hidden="true" tabindex="-1"></a>    <span class="at">split_by =</span> <span class="fu">list</span>(</span>
<span id="cb63-1066"><a href="#cb63-1066" aria-hidden="true" tabindex="-1"></a>      data_prepared_gpt3d_withresids<span class="sc">$</span>WorkerId, </span>
<span id="cb63-1067"><a href="#cb63-1067" aria-hidden="true" tabindex="-1"></a>      data_prepared_gpt3d_withresids<span class="sc">$</span>story_num),</span>
<span id="cb63-1068"><a href="#cb63-1068" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_lag =</span> <span class="dv">17</span>,</span>
<span id="cb63-1069"><a href="#cb63-1069" aria-hidden="true" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">"ACF of GPT3-davinci GAM resids without necessary reodering"</span></span>
<span id="cb63-1070"><a href="#cb63-1070" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb63-1071"><a href="#cb63-1071" aria-hidden="true" tabindex="-1"></a>data_resorted_subset <span class="ot">&lt;-</span> data_resorted <span class="sc">%&gt;%</span> </span>
<span id="cb63-1072"><a href="#cb63-1072" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(WorkerId <span class="sc">%in%</span> selected_workers_info<span class="sc">$</span>WorkerId)</span>
<span id="cb63-1073"><a href="#cb63-1073" aria-hidden="true" tabindex="-1"></a>data_resorted_subset <span class="sc">%&gt;%</span> </span>
<span id="cb63-1074"><a href="#cb63-1074" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(resids) <span class="sc">%&gt;%</span> </span>
<span id="cb63-1075"><a href="#cb63-1075" aria-hidden="true" tabindex="-1"></a>  itsadug<span class="sc">::</span><span class="fu">acf_plot</span>(</span>
<span id="cb63-1076"><a href="#cb63-1076" aria-hidden="true" tabindex="-1"></a>    <span class="at">split_by =</span> <span class="fu">list</span>(</span>
<span id="cb63-1077"><a href="#cb63-1077" aria-hidden="true" tabindex="-1"></a>      data_resorted_subset<span class="sc">$</span>WorkerId, </span>
<span id="cb63-1078"><a href="#cb63-1078" aria-hidden="true" tabindex="-1"></a>      data_resorted_subset<span class="sc">$</span>story_num),</span>
<span id="cb63-1079"><a href="#cb63-1079" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_lag =</span> <span class="dv">17</span>,</span>
<span id="cb63-1080"><a href="#cb63-1080" aria-hidden="true" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">"ACF of GPT3-davinci GAM resids - correctly reordered"</span></span>
<span id="cb63-1081"><a href="#cb63-1081" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb63-1082"><a href="#cb63-1082" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-1083"><a href="#cb63-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1084"><a href="#cb63-1084" aria-hidden="true" tabindex="-1"></a>A partial autocorrelation function plotter</span>
<span id="cb63-1085"><a href="#cb63-1085" aria-hidden="true" tabindex="-1"></a>: In <span class="in">`my_pacf_plot.R`</span> I modify the code from <span class="in">`itsadug::acf_plot()`</span> to calculate PACF instead of ACF. That is, it will get mean <span class="in">`pacf`</span> across splits instead of getting complete <span class="in">`acf`</span>. </span>
<span id="cb63-1086"><a href="#cb63-1086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1087"><a href="#cb63-1087" aria-hidden="true" tabindex="-1"></a><span class="in">```{r my_pacf_plot}</span></span>
<span id="cb63-1088"><a href="#cb63-1088" aria-hidden="true" tabindex="-1"></a><span class="co"># defines function `my_pacf_plot`</span></span>
<span id="cb63-1089"><a href="#cb63-1089" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"utils/my_pacf_plot.R"</span>)</span>
<span id="cb63-1090"><a href="#cb63-1090" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-1091"><a href="#cb63-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1092"><a href="#cb63-1092" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot_avg_ACF}</span></span>
<span id="cb63-1093"><a href="#cb63-1093" aria-hidden="true" tabindex="-1"></a>plot_avg_ACF <span class="ot">&lt;-</span> <span class="cf">function</span>(all_ACF, <span class="at">with.sem =</span> F, <span class="at">ylim=</span><span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">1</span>), <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)){</span>
<span id="cb63-1094"><a href="#cb63-1094" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For plotting aggregated [p]acf with input `all_ACF &lt;- plot_[p]acf( _ , return_all=T)`</span></span>
<span id="cb63-1095"><a href="#cb63-1095" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mean with sem bars.</span></span>
<span id="cb63-1096"><a href="#cb63-1096" aria-hidden="true" tabindex="-1"></a>  ci <span class="ot">&lt;-</span> <span class="fl">0.95</span></span>
<span id="cb63-1097"><a href="#cb63-1097" aria-hidden="true" tabindex="-1"></a>  with.ci <span class="ot">&lt;-</span> T</span>
<span id="cb63-1098"><a href="#cb63-1098" aria-hidden="true" tabindex="-1"></a>  ci.col <span class="ot">&lt;-</span> <span class="st">'blue'</span></span>
<span id="cb63-1099"><a href="#cb63-1099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1100"><a href="#cb63-1100" aria-hidden="true" tabindex="-1"></a>  plot_df <span class="ot">&lt;-</span> all_ACF<span class="sc">$</span>dataframe <span class="sc">%&gt;%</span> </span>
<span id="cb63-1101"><a href="#cb63-1101" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(lag) <span class="sc">%&gt;%</span> </span>
<span id="cb63-1102"><a href="#cb63-1102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb63-1103"><a href="#cb63-1103" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean =</span> <span class="fu">mean</span>(acf),</span>
<span id="cb63-1104"><a href="#cb63-1104" aria-hidden="true" tabindex="-1"></a>      <span class="at">sd =</span> <span class="fu">sd</span>(acf),</span>
<span id="cb63-1105"><a href="#cb63-1105" aria-hidden="true" tabindex="-1"></a>      <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb63-1106"><a href="#cb63-1106" aria-hidden="true" tabindex="-1"></a>      <span class="at">sem =</span> sd <span class="sc">/</span> <span class="fu">sqrt</span>(n),</span>
<span id="cb63-1107"><a href="#cb63-1107" aria-hidden="true" tabindex="-1"></a>      <span class="at">sem.upper =</span> mean <span class="sc">+</span> <span class="fu">qnorm</span>((<span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.95</span>)<span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> sem,</span>
<span id="cb63-1108"><a href="#cb63-1108" aria-hidden="true" tabindex="-1"></a>      <span class="at">sem.lower =</span> mean <span class="sc">-</span> <span class="fu">qnorm</span>((<span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.95</span>)<span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> sem,</span>
<span id="cb63-1109"><a href="#cb63-1109" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_ci =</span> <span class="fu">mean</span>(ci), <span class="co"># with default ci.type= "white" these are all the same value</span></span>
<span id="cb63-1110"><a href="#cb63-1110" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-1111"><a href="#cb63-1111" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(mean)</span>
<span id="cb63-1112"><a href="#cb63-1112" aria-hidden="true" tabindex="-1"></a>  clim <span class="ot">&lt;-</span> plot_df<span class="sc">$</span>mean_ci[[<span class="dv">1</span>]]</span>
<span id="cb63-1113"><a href="#cb63-1113" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> plot_df <span class="sc">%&gt;%</span></span>
<span id="cb63-1114"><a href="#cb63-1114" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lag, <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb63-1115"><a href="#cb63-1115" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymax =</span> mean, <span class="at">ymin=</span><span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb63-1116"><a href="#cb63-1116" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb63-1117"><a href="#cb63-1117" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lims</span>(<span class="at">y =</span> <span class="fu">as.numeric</span>(ylim),</span>
<span id="cb63-1118"><a href="#cb63-1118" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="fu">as.numeric</span>(xlim))</span>
<span id="cb63-1119"><a href="#cb63-1119" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (with.ci) {</span>
<span id="cb63-1120"><a href="#cb63-1120" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb63-1121"><a href="#cb63-1121" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span><span class="sc">-</span>clim, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> ci.col) <span class="sc">+</span></span>
<span id="cb63-1122"><a href="#cb63-1122" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span><span class="sc">+</span>clim, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> ci.col)</span>
<span id="cb63-1123"><a href="#cb63-1123" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-1124"><a href="#cb63-1124" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (with.sem) {</span>
<span id="cb63-1125"><a href="#cb63-1125" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb63-1126"><a href="#cb63-1126" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_linerange</span>(</span>
<span id="cb63-1127"><a href="#cb63-1127" aria-hidden="true" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">ymin =</span> sem.lower, <span class="at">ymax =</span> sem.upper), </span>
<span id="cb63-1128"><a href="#cb63-1128" aria-hidden="true" tabindex="-1"></a>        <span class="at">linewidth =</span> <span class="dv">3</span>, <span class="at">alpha=</span><span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"red"</span>) </span>
<span id="cb63-1129"><a href="#cb63-1129" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-1130"><a href="#cb63-1130" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(p)</span>
<span id="cb63-1131"><a href="#cb63-1131" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-1132"><a href="#cb63-1132" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-1133"><a href="#cb63-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1134"><a href="#cb63-1134" aria-hidden="true" tabindex="-1"></a>Comparison of plotting functions for sanity</span>
<span id="cb63-1137"><a href="#cb63-1137" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb63-1138"><a href="#cb63-1138" aria-hidden="true" tabindex="-1"></a>data_resorted_subset_resids_ACF <span class="ot">&lt;-</span> itsadug<span class="sc">::</span><span class="fu">acf_plot</span>(</span>
<span id="cb63-1139"><a href="#cb63-1139" aria-hidden="true" tabindex="-1"></a>  data_resorted_subset<span class="sc">$</span>resids,</span>
<span id="cb63-1140"><a href="#cb63-1140" aria-hidden="true" tabindex="-1"></a>  <span class="at">split_by =</span> <span class="fu">list</span>(</span>
<span id="cb63-1141"><a href="#cb63-1141" aria-hidden="true" tabindex="-1"></a>    data_resorted_subset<span class="sc">$</span>subject,</span>
<span id="cb63-1142"><a href="#cb63-1142" aria-hidden="true" tabindex="-1"></a>    data_resorted_subset<span class="sc">$</span>story_num),</span>
<span id="cb63-1143"><a href="#cb63-1143" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot =</span> T,</span>
<span id="cb63-1144"><a href="#cb63-1144" aria-hidden="true" tabindex="-1"></a>  <span class="at">return_all =</span> T)</span>
<span id="cb63-1145"><a href="#cb63-1145" aria-hidden="true" tabindex="-1"></a>data_resorted_subset_resids_PACF <span class="ot">&lt;-</span> <span class="fu">my_pacf_plot</span>(</span>
<span id="cb63-1146"><a href="#cb63-1146" aria-hidden="true" tabindex="-1"></a>  data_resorted_subset<span class="sc">$</span>resids,</span>
<span id="cb63-1147"><a href="#cb63-1147" aria-hidden="true" tabindex="-1"></a>  <span class="at">split_by =</span> <span class="fu">list</span>(</span>
<span id="cb63-1148"><a href="#cb63-1148" aria-hidden="true" tabindex="-1"></a>    data_resorted_subset<span class="sc">$</span>subject,</span>
<span id="cb63-1149"><a href="#cb63-1149" aria-hidden="true" tabindex="-1"></a>    data_resorted_subset<span class="sc">$</span>story_num),</span>
<span id="cb63-1150"><a href="#cb63-1150" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot =</span> T,</span>
<span id="cb63-1151"><a href="#cb63-1151" aria-hidden="true" tabindex="-1"></a>  <span class="at">return_all =</span> T, <span class="at">main=</span><span class="st">"Partial ACF"</span>)</span>
<span id="cb63-1152"><a href="#cb63-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1153"><a href="#cb63-1153" aria-hidden="true" tabindex="-1"></a><span class="co"># For comparison</span></span>
<span id="cb63-1154"><a href="#cb63-1154" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_avg_ACF</span>(data_resorted_subset_resids_ACF) <span class="sc">+</span> </span>
<span id="cb63-1155"><a href="#cb63-1155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb63-1156"><a href="#cb63-1156" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Mean ACF of residuals across stories, and subjects"</span>,</span>
<span id="cb63-1157"><a href="#cb63-1157" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"GPT3-davinci"</span>,</span>
<span id="cb63-1158"><a href="#cb63-1158" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Lag"</span>, </span>
<span id="cb63-1159"><a href="#cb63-1159" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span><span class="st">"mean ACF"</span>)</span>
<span id="cb63-1160"><a href="#cb63-1160" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_avg_ACF</span>(data_resorted_subset_resids_PACF) <span class="sc">+</span> </span>
<span id="cb63-1161"><a href="#cb63-1161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb63-1162"><a href="#cb63-1162" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Mean PACF of residuals across stories, and subjects"</span>,</span>
<span id="cb63-1163"><a href="#cb63-1163" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"GPT3-davinci"</span>,</span>
<span id="cb63-1164"><a href="#cb63-1164" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Lag"</span>, </span>
<span id="cb63-1165"><a href="#cb63-1165" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span><span class="st">"mean Partial ACF"</span>)</span>
<span id="cb63-1166"><a href="#cb63-1166" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-1167"><a href="#cb63-1167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1170"><a href="#cb63-1170" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb63-1171"><a href="#cb63-1171" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot ACF mean and 95%CI</span></span>
<span id="cb63-1172"><a href="#cb63-1172" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_avg_ACF</span>(data_resorted_subset_resids_ACF, <span class="at">with.sem =</span> T) <span class="sc">+</span> </span>
<span id="cb63-1173"><a href="#cb63-1173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb63-1174"><a href="#cb63-1174" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"ACF of residuals"</span>,</span>
<span id="cb63-1175"><a href="#cb63-1175" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Mean across stories, subjects; GPT3-davinci"</span>,</span>
<span id="cb63-1176"><a href="#cb63-1176" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Lag"</span>,</span>
<span id="cb63-1177"><a href="#cb63-1177" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span><span class="st">"mean ACF"</span>)</span>
<span id="cb63-1178"><a href="#cb63-1178" aria-hidden="true" tabindex="-1"></a><span class="do">### FIG FOR PAPER</span></span>
<span id="cb63-1179"><a href="#cb63-1179" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb63-1180"><a href="#cb63-1180" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="fu">paste0</span>(figsdir, <span class="st">"gpt3d_ACF"</span>, <span class="st">".pdf"</span>),</span>
<span id="cb63-1181"><a href="#cb63-1181" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">4</span>, <span class="at">height =</span> <span class="dv">3</span>)</span>
<span id="cb63-1182"><a href="#cb63-1182" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_avg_ACF</span>(data_resorted_subset_resids_PACF, <span class="at">with.sem =</span> T) <span class="sc">+</span> </span>
<span id="cb63-1183"><a href="#cb63-1183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb63-1184"><a href="#cb63-1184" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"PACF of residuals"</span>,</span>
<span id="cb63-1185"><a href="#cb63-1185" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Mean across stories, subjects;  GPT3-davinci"</span>,</span>
<span id="cb63-1186"><a href="#cb63-1186" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Lag"</span>, </span>
<span id="cb63-1187"><a href="#cb63-1187" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span><span class="st">"mean Partial ACF"</span>)</span>
<span id="cb63-1188"><a href="#cb63-1188" aria-hidden="true" tabindex="-1"></a><span class="do">### FIG FOR PAPER</span></span>
<span id="cb63-1189"><a href="#cb63-1189" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb63-1190"><a href="#cb63-1190" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="fu">paste0</span>(figsdir, <span class="st">"gpt3d_PACF"</span>, <span class="st">".pdf"</span>),</span>
<span id="cb63-1191"><a href="#cb63-1191" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">4</span>, <span class="at">height =</span> <span class="dv">3</span>)</span>
<span id="cb63-1192"><a href="#cb63-1192" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_avg_ACF</span>(data_resorted_subset_resids_PACF, <span class="at">with.sem =</span> T, <span class="at">ylim=</span><span class="fu">c</span>(<span class="cn">NA</span>,<span class="cn">NA</span>)) <span class="sc">+</span> </span>
<span id="cb63-1193"><a href="#cb63-1193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb63-1194"><a href="#cb63-1194" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"PACF of residuals"</span>,</span>
<span id="cb63-1195"><a href="#cb63-1195" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Mean across stories, subjects;  GPT3-davinci"</span>,</span>
<span id="cb63-1196"><a href="#cb63-1196" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Lag"</span>, </span>
<span id="cb63-1197"><a href="#cb63-1197" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span><span class="st">"mean Partial ACF"</span>)</span>
<span id="cb63-1198"><a href="#cb63-1198" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave(</span></span>
<span id="cb63-1199"><a href="#cb63-1199" aria-hidden="true" tabindex="-1"></a><span class="co">#   filename = paste0(figsdir, "gpt3d_PACF_zoomed", ".pdf"),</span></span>
<span id="cb63-1200"><a href="#cb63-1200" aria-hidden="true" tabindex="-1"></a><span class="co">#   width = 4, height = 3)</span></span>
<span id="cb63-1201"><a href="#cb63-1201" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-1202"><a href="#cb63-1202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1203"><a href="#cb63-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1204"><a href="#cb63-1204" aria-hidden="true" tabindex="-1"></a><span class="fu"># Schematic diagram</span></span>
<span id="cb63-1205"><a href="#cb63-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1206"><a href="#cb63-1206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1207"><a href="#cb63-1207" aria-hidden="true" tabindex="-1"></a>Make fake data for illustration, where true relationship is superlinear</span>
<span id="cb63-1208"><a href="#cb63-1208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1211"><a href="#cb63-1211" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb63-1212"><a href="#cb63-1212" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb63-1213"><a href="#cb63-1213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1214"><a href="#cb63-1214" aria-hidden="true" tabindex="-1"></a>myarrow <span class="ot">&lt;-</span> <span class="fu">arrow</span>(<span class="dv">10</span>, <span class="fu">unit</span>(<span class="dv">4</span>,<span class="st">"mm"</span>), <span class="at">type=</span> <span class="st">"closed"</span>)</span>
<span id="cb63-1215"><a href="#cb63-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1216"><a href="#cb63-1216" aria-hidden="true" tabindex="-1"></a><span class="co"># wrapper for stats::rbinom to sample logical bernoulli random variates</span></span>
<span id="cb63-1217"><a href="#cb63-1217" aria-hidden="true" tabindex="-1"></a><span class="co"># should be identical to deprecated purrr::rbernoulli</span></span>
<span id="cb63-1218"><a href="#cb63-1218" aria-hidden="true" tabindex="-1"></a>rbern <span class="ot">&lt;-</span> <span class="cf">function</span>(n, <span class="at">p =</span> <span class="fl">0.5</span>) {</span>
<span id="cb63-1219"><a href="#cb63-1219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.logical</span>(<span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> p))</span>
<span id="cb63-1220"><a href="#cb63-1220" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-1221"><a href="#cb63-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1222"><a href="#cb63-1222" aria-hidden="true" tabindex="-1"></a>gen_data <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">N=</span><span class="dv">5000</span>, <span class="at">seed =</span> <span class="dv">4</span>){</span>
<span id="cb63-1223"><a href="#cb63-1223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb63-1224"><a href="#cb63-1224" aria-hidden="true" tabindex="-1"></a>  b0 <span class="ot">&lt;-</span> .<span class="dv">9</span>; b1 <span class="ot">&lt;-</span> <span class="sc">-</span>.<span class="dv">11</span>;</span>
<span id="cb63-1225"><a href="#cb63-1225" aria-hidden="true" tabindex="-1"></a>  lnk <span class="ot">&lt;-</span> <span class="st">"inverse"</span></span>
<span id="cb63-1226"><a href="#cb63-1226" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (lnk <span class="sc">==</span> <span class="st">"identity"</span>) {</span>
<span id="cb63-1227"><a href="#cb63-1227" aria-hidden="true" tabindex="-1"></a>    invlnk <span class="ot">&lt;-</span> <span class="cf">function</span>(eta) eta</span>
<span id="cb63-1228"><a href="#cb63-1228" aria-hidden="true" tabindex="-1"></a>    lnk_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(mu) mu</span>
<span id="cb63-1229"><a href="#cb63-1229" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (lnk <span class="sc">==</span> <span class="st">"inverse"</span>) {</span>
<span id="cb63-1230"><a href="#cb63-1230" aria-hidden="true" tabindex="-1"></a>    invlnk <span class="ot">&lt;-</span> <span class="cf">function</span>(eta) <span class="dv">1</span> <span class="sc">/</span> eta</span>
<span id="cb63-1231"><a href="#cb63-1231" aria-hidden="true" tabindex="-1"></a>    lnk_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(mu) <span class="dv">1</span> <span class="sc">/</span> mu</span>
<span id="cb63-1232"><a href="#cb63-1232" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (lnk <span class="sc">==</span> <span class="st">"log"</span>) {</span>
<span id="cb63-1233"><a href="#cb63-1233" aria-hidden="true" tabindex="-1"></a>    invlnk <span class="ot">&lt;-</span> <span class="cf">function</span>(eta) <span class="fu">exp</span>(eta)</span>
<span id="cb63-1234"><a href="#cb63-1234" aria-hidden="true" tabindex="-1"></a>    lnk_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(mu) <span class="fu">log</span>(mu)</span>
<span id="cb63-1235"><a href="#cb63-1235" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-1236"><a href="#cb63-1236" aria-hidden="true" tabindex="-1"></a>  shape <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb63-1237"><a href="#cb63-1237" aria-hidden="true" tabindex="-1"></a>  x<span class="ot">&lt;-</span><span class="fu">rlnorm</span>(N,<span class="at">meanlog=</span><span class="sc">-</span><span class="dv">1</span>,<span class="at">sdlog=</span><span class="fl">0.8</span>)</span>
<span id="cb63-1238"><a href="#cb63-1238" aria-hidden="true" tabindex="-1"></a>  <span class="co"># x&lt;-runif(N, 0,8)</span></span>
<span id="cb63-1239"><a href="#cb63-1239" aria-hidden="true" tabindex="-1"></a>  <span class="co"># x&lt;-seq(0,8,8/(N-1))</span></span>
<span id="cb63-1240"><a href="#cb63-1240" aria-hidden="true" tabindex="-1"></a>  y_true <span class="ot">=</span> <span class="fu">invlnk</span>(b0 <span class="sc">+</span> b1 <span class="sc">*</span> x) <span class="co"># function of the linear expression</span></span>
<span id="cb63-1241"><a href="#cb63-1241" aria-hidden="true" tabindex="-1"></a>  <span class="co"># y_true = 1/(b0+b1*x)</span></span>
<span id="cb63-1242"><a href="#cb63-1242" aria-hidden="true" tabindex="-1"></a>  df<span class="ot">&lt;-</span><span class="fu">data.frame</span>(</span>
<span id="cb63-1243"><a href="#cb63-1243" aria-hidden="true" tabindex="-1"></a>    x,</span>
<span id="cb63-1244"><a href="#cb63-1244" aria-hidden="true" tabindex="-1"></a>    y_true,</span>
<span id="cb63-1245"><a href="#cb63-1245" aria-hidden="true" tabindex="-1"></a>    <span class="at">y.1 =</span> <span class="dv">300</span> <span class="sc">+</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">rgamma</span>(N, <span class="at">rate =</span> <span class="fl">1.30</span> <span class="sc">*</span> shape <span class="sc">/</span> y_true, <span class="at">shape =</span> shape),</span>
<span id="cb63-1246"><a href="#cb63-1246" aria-hidden="true" tabindex="-1"></a>    <span class="at">y.2 =</span> <span class="dv">300</span> <span class="sc">+</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">rgamma</span>(N, <span class="at">rate =</span> <span class="fl">1.70</span> <span class="sc">*</span> shape <span class="sc">/</span> y_true, <span class="at">shape =</span> shape),</span>
<span id="cb63-1247"><a href="#cb63-1247" aria-hidden="true" tabindex="-1"></a>    <span class="at">y.3 =</span> <span class="dv">300</span> <span class="sc">+</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">rgamma</span>(N, <span class="at">rate =</span> <span class="fl">1.08</span> <span class="sc">*</span> shape <span class="sc">/</span> y_true, <span class="at">shape =</span> shape),</span>
<span id="cb63-1248"><a href="#cb63-1248" aria-hidden="true" tabindex="-1"></a>    <span class="at">y.4 =</span> <span class="dv">300</span> <span class="sc">+</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">rgamma</span>(N, <span class="at">rate =</span> <span class="fl">1.09</span> <span class="sc">*</span> shape <span class="sc">/</span> y_true, <span class="at">shape =</span> shape),</span>
<span id="cb63-1249"><a href="#cb63-1249" aria-hidden="true" tabindex="-1"></a>    <span class="at">y.5 =</span> <span class="dv">300</span> <span class="sc">+</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">rgamma</span>(N, <span class="at">rate =</span> <span class="fl">1.10</span> <span class="sc">*</span> shape <span class="sc">/</span> y_true, <span class="at">shape =</span> shape)</span>
<span id="cb63-1250"><a href="#cb63-1250" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb63-1251"><a href="#cb63-1251" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(</span>
<span id="cb63-1252"><a href="#cb63-1252" aria-hidden="true" tabindex="-1"></a>      <span class="fu">starts_with</span>(<span class="st">"y."</span>), </span>
<span id="cb63-1253"><a href="#cb63-1253" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_to =</span> <span class="st">"subj"</span>, <span class="at">values_to =</span> <span class="st">"y_obs"</span>, <span class="at">names_prefix =</span> <span class="st">"y."</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-1254"><a href="#cb63-1254" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">subj=</span><span class="fu">factor</span>(subj))</span>
<span id="cb63-1255"><a href="#cb63-1255" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rm(x,y_true)</span></span>
<span id="cb63-1256"><a href="#cb63-1256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb63-1257"><a href="#cb63-1257" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-1258"><a href="#cb63-1258" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">gen_data</span>()</span>
<span id="cb63-1259"><a href="#cb63-1259" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(x,y_obs,<span class="at">color=</span>subj), <span class="at">alpha=</span>.<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb63-1260"><a href="#cb63-1260" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span><span class="dv">300</span><span class="sc">+</span><span class="dv">100</span><span class="sc">*</span>y_true),<span class="at">shape=</span><span class="dv">1</span>,<span class="at">size=</span><span class="dv">2</span>)</span>
<span id="cb63-1261"><a href="#cb63-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1262"><a href="#cb63-1262" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-1263"><a href="#cb63-1263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1266"><a href="#cb63-1266" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb63-1267"><a href="#cb63-1267" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb63-1268"><a href="#cb63-1268" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb63-1269"><a href="#cb63-1269" aria-hidden="true" tabindex="-1"></a><span class="co"># Unused. Less realistic version, where x values are modified randomly per subj</span></span>
<span id="cb63-1270"><a href="#cb63-1270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1271"><a href="#cb63-1271" aria-hidden="true" tabindex="-1"></a>df_10000 <span class="ot">&lt;-</span> <span class="fu">gen_data</span>(<span class="at">N =</span> <span class="dv">10000</span>, <span class="at">seed =</span> <span class="dv">4</span>)</span>
<span id="cb63-1272"><a href="#cb63-1272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1273"><a href="#cb63-1273" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb63-1274"><a href="#cb63-1274" aria-hidden="true" tabindex="-1"></a>df_modified_NOTBYSUBJ <span class="ot">&lt;-</span> df_10000 <span class="sc">%&gt;%</span></span>
<span id="cb63-1275"><a href="#cb63-1275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">selected=</span><span class="fu">rbern</span>(<span class="fu">nrow</span>(df_10000), <span class="at">p=</span><span class="fl">0.002</span>),</span>
<span id="cb63-1276"><a href="#cb63-1276" aria-hidden="true" tabindex="-1"></a>         <span class="at">x0 =</span> x,</span>
<span id="cb63-1277"><a href="#cb63-1277" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="fu">if_else</span>(selected, </span>
<span id="cb63-1278"><a href="#cb63-1278" aria-hidden="true" tabindex="-1"></a>                     x <span class="sc">+</span> <span class="fu">runif</span>(<span class="fu">nrow</span>(df_10000), <span class="at">min=</span>x<span class="sc">/</span><span class="dv">4</span>,<span class="at">max=</span><span class="fl">5.5</span><span class="sc">-</span>x),</span>
<span id="cb63-1279"><a href="#cb63-1279" aria-hidden="true" tabindex="-1"></a>                     x))</span>
<span id="cb63-1280"><a href="#cb63-1280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1281"><a href="#cb63-1281" aria-hidden="true" tabindex="-1"></a>df_modified_NOTBYSUBJ <span class="sc">%&gt;%</span> </span>
<span id="cb63-1282"><a href="#cb63-1282" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x0,<span class="at">y=</span>x0,<span class="at">alpha=</span>selected, <span class="at">shape=</span>selected)) <span class="sc">+</span> </span>
<span id="cb63-1283"><a href="#cb63-1283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data=</span>df_modified_NOTBYSUBJ <span class="sc">%&gt;%</span> <span class="fu">filter</span>(selected<span class="sc">==</span><span class="cn">TRUE</span>), </span>
<span id="cb63-1284"><a href="#cb63-1284" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">yend=</span>x0, <span class="at">xend=</span>x), </span>
<span id="cb63-1285"><a href="#cb63-1285" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> myarrow,</span>
<span id="cb63-1286"><a href="#cb63-1286" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha=</span><span class="fl">0.5</span>, <span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb63-1287"><a href="#cb63-1287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x))</span>
<span id="cb63-1288"><a href="#cb63-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1289"><a href="#cb63-1289" aria-hidden="true" tabindex="-1"></a>df_modified_NOTBYSUBJ <span class="sc">%&gt;%</span> </span>
<span id="cb63-1290"><a href="#cb63-1290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x0,<span class="at">y=</span>y_obs,<span class="at">alpha=</span>selected, <span class="at">color=</span>subj)) <span class="sc">+</span> </span>
<span id="cb63-1291"><a href="#cb63-1291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data=</span>df_modified_NOTBYSUBJ <span class="sc">%&gt;%</span> <span class="fu">filter</span>(selected<span class="sc">==</span><span class="cn">TRUE</span>), </span>
<span id="cb63-1292"><a href="#cb63-1292" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">yend=</span>y_obs, <span class="at">xend=</span>x),</span>
<span id="cb63-1293"><a href="#cb63-1293" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> myarrow,</span>
<span id="cb63-1294"><a href="#cb63-1294" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb63-1295"><a href="#cb63-1295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x))</span>
<span id="cb63-1296"><a href="#cb63-1296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-1297"><a href="#cb63-1297" aria-hidden="true" tabindex="-1"></a>Modify to (mostly) overestimate some surprisals</span>
<span id="cb63-1298"><a href="#cb63-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1299"><a href="#cb63-1299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1302"><a href="#cb63-1302" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb63-1303"><a href="#cb63-1303" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb63-1304"><a href="#cb63-1304" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb63-1305"><a href="#cb63-1305" aria-hidden="true" tabindex="-1"></a>df_modified <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>y_true) <span class="sc">%&gt;%</span></span>
<span id="cb63-1306"><a href="#cb63-1306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>subj, <span class="at">values_from=</span>y_obs) <span class="sc">%&gt;%</span> </span>
<span id="cb63-1307"><a href="#cb63-1307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">selected=</span><span class="fu">rbern</span>(<span class="fu">nrow</span>(.), <span class="at">p=</span><span class="fl">0.004</span>),</span>
<span id="cb63-1308"><a href="#cb63-1308" aria-hidden="true" tabindex="-1"></a>         <span class="at">x0 =</span> x,</span>
<span id="cb63-1309"><a href="#cb63-1309" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="fu">if_else</span>(selected, <span class="fu">max</span>(x0)<span class="sc">*</span><span class="fu">rbeta</span>(<span class="fu">nrow</span>(.),<span class="dv">1</span>,<span class="dv">1</span>),x0)) <span class="sc">%&gt;%</span> </span>
<span id="cb63-1310"><a href="#cb63-1310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span>,<span class="st">`</span><span class="at">2</span><span class="st">`</span>,<span class="st">`</span><span class="at">3</span><span class="st">`</span>,<span class="st">`</span><span class="at">4</span><span class="st">`</span>,<span class="st">`</span><span class="at">5</span><span class="st">`</span>), <span class="at">names_to =</span> <span class="st">"subj"</span>, <span class="at">values_to =</span> <span class="st">"y_obs"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb63-1311"><a href="#cb63-1311" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subj =</span> <span class="fu">factor</span>(subj)) <span class="sc">%&gt;%</span> </span>
<span id="cb63-1312"><a href="#cb63-1312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(<span class="sc">~!</span><span class="fu">is.numeric</span>(.)),factor))</span>
<span id="cb63-1313"><a href="#cb63-1313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1314"><a href="#cb63-1314" aria-hidden="true" tabindex="-1"></a>df_modified_longer <span class="ot">&lt;-</span> df_modified <span class="sc">%&gt;%</span> </span>
<span id="cb63-1315"><a href="#cb63-1315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>subj, <span class="at">values_from=</span>y_obs) </span>
<span id="cb63-1316"><a href="#cb63-1316" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-1317"><a href="#cb63-1317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1318"><a href="#cb63-1318" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb63-1319"><a href="#cb63-1319" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modified surprisals</span></span>
<span id="cb63-1322"><a href="#cb63-1322" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb63-1323"><a href="#cb63-1323" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb63-1324"><a href="#cb63-1324" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb63-1325"><a href="#cb63-1325" aria-hidden="true" tabindex="-1"></a>df_modified_longer <span class="sc">%&gt;%</span> </span>
<span id="cb63-1326"><a href="#cb63-1326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x0,<span class="at">y=</span>x0,<span class="at">alpha=</span>selected,<span class="at">shape=</span>selected)) <span class="sc">+</span> </span>
<span id="cb63-1327"><a href="#cb63-1327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data=</span>df_modified_longer <span class="sc">%&gt;%</span> <span class="fu">filter</span>(selected<span class="sc">==</span><span class="cn">TRUE</span>), </span>
<span id="cb63-1328"><a href="#cb63-1328" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">yend=</span>x0, <span class="at">xend=</span>x), </span>
<span id="cb63-1329"><a href="#cb63-1329" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> myarrow,</span>
<span id="cb63-1330"><a href="#cb63-1330" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha=</span><span class="fl">0.5</span>, <span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb63-1331"><a href="#cb63-1331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x))</span>
<span id="cb63-1332"><a href="#cb63-1332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1333"><a href="#cb63-1333" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-1334"><a href="#cb63-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1335"><a href="#cb63-1335" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plotted against response</span></span>
<span id="cb63-1338"><a href="#cb63-1338" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb63-1339"><a href="#cb63-1339" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb63-1340"><a href="#cb63-1340" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb63-1341"><a href="#cb63-1341" aria-hidden="true" tabindex="-1"></a>df_modified <span class="sc">%&gt;%</span> </span>
<span id="cb63-1342"><a href="#cb63-1342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x0,<span class="at">y=</span>y_obs,<span class="at">alpha=</span>selected, <span class="at">color=</span>subj)) <span class="sc">+</span> </span>
<span id="cb63-1343"><a href="#cb63-1343" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data=</span>df_modified <span class="sc">%&gt;%</span> <span class="fu">filter</span>(selected<span class="sc">==</span><span class="cn">TRUE</span>), </span>
<span id="cb63-1344"><a href="#cb63-1344" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">yend=</span>y_obs, <span class="at">xend=</span>x),</span>
<span id="cb63-1345"><a href="#cb63-1345" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> myarrow,</span>
<span id="cb63-1346"><a href="#cb63-1346" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb63-1347"><a href="#cb63-1347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x))</span>
<span id="cb63-1348"><a href="#cb63-1348" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-1349"><a href="#cb63-1349" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb63-1350"><a href="#cb63-1350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1351"><a href="#cb63-1351" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fit GAMs</span></span>
<span id="cb63-1352"><a href="#cb63-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1355"><a href="#cb63-1355" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb63-1356"><a href="#cb63-1356" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb63-1357"><a href="#cb63-1357" aria-hidden="true" tabindex="-1"></a><span class="co"># GAM formula</span></span>
<span id="cb63-1358"><a href="#cb63-1358" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> y_obs <span class="sc">~</span>  <span class="fu">s</span>(x, <span class="at">k=</span><span class="dv">6</span>) <span class="sc">+</span> <span class="fu">s</span>(x, subj, <span class="at">bs=</span><span class="st">"fs"</span>, <span class="at">m=</span><span class="dv">1</span>)</span>
<span id="cb63-1359"><a href="#cb63-1359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1360"><a href="#cb63-1360" aria-hidden="true" tabindex="-1"></a>m  <span class="ot">&lt;-</span> mgcv<span class="sc">::</span><span class="fu">gam</span>(<span class="at">formula =</span> f, <span class="at">data=</span>df)</span>
<span id="cb63-1361"><a href="#cb63-1361" aria-hidden="true" tabindex="-1"></a>m_ <span class="ot">&lt;-</span> mgcv<span class="sc">::</span><span class="fu">gam</span>(<span class="at">formula =</span> f, <span class="at">data=</span>df_modified)</span>
<span id="cb63-1362"><a href="#cb63-1362" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-1363"><a href="#cb63-1363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1364"><a href="#cb63-1364" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot</span></span>
<span id="cb63-1365"><a href="#cb63-1365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1366"><a href="#cb63-1366" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot}</span></span>
<span id="cb63-1367"><a href="#cb63-1367" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb63-1368"><a href="#cb63-1368" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb63-1369"><a href="#cb63-1369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1370"><a href="#cb63-1370" aria-hidden="true" tabindex="-1"></a><span class="do">## Could plot with gratia</span></span>
<span id="cb63-1371"><a href="#cb63-1371" aria-hidden="true" tabindex="-1"></a><span class="co"># patchwork::wrap_plots(</span></span>
<span id="cb63-1372"><a href="#cb63-1372" aria-hidden="true" tabindex="-1"></a><span class="co">#   gratia::draw(m, residuals = F, select = 1, rug=F),</span></span>
<span id="cb63-1373"><a href="#cb63-1373" aria-hidden="true" tabindex="-1"></a><span class="co">#   gratia::draw(m_, residuals = F, select = 1, rug=F), nrow = 2)</span></span>
<span id="cb63-1374"><a href="#cb63-1374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1375"><a href="#cb63-1375" aria-hidden="true" tabindex="-1"></a><span class="do">## But just get ests out instead, so we can plot them together</span></span>
<span id="cb63-1376"><a href="#cb63-1376" aria-hidden="true" tabindex="-1"></a>ests <span class="ot">&lt;-</span> gratia<span class="sc">::</span><span class="fu">smooth_estimates</span>(m) <span class="sc">%&gt;%</span> </span>
<span id="cb63-1377"><a href="#cb63-1377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(smooth<span class="sc">==</span><span class="st">"s(x)"</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">est_shifted =</span> est <span class="sc">+</span> <span class="fu">coef</span>(m)[<span class="st">"(Intercept)"</span>])</span>
<span id="cb63-1378"><a href="#cb63-1378" aria-hidden="true" tabindex="-1"></a>ests_ <span class="ot">&lt;-</span> gratia<span class="sc">::</span><span class="fu">smooth_estimates</span>(m_) <span class="sc">%&gt;%</span> </span>
<span id="cb63-1379"><a href="#cb63-1379" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(smooth<span class="sc">==</span><span class="st">"s(x)"</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">est_shifted =</span> est <span class="sc">+</span> <span class="fu">coef</span>(m)[<span class="st">"(Intercept)"</span>])</span>
<span id="cb63-1380"><a href="#cb63-1380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1381"><a href="#cb63-1381" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb63-1382"><a href="#cb63-1382" aria-hidden="true" tabindex="-1"></a>col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"darkblue"</span>, <span class="st">"darkred"</span>)</span>
<span id="cb63-1383"><a href="#cb63-1383" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb63-1384"><a href="#cb63-1384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hex</span>(<span class="at">data =</span> df_modified, <span class="fu">aes</span>(x,<span class="at">y=</span>y_obs), <span class="at">size=</span><span class="dv">0</span>, <span class="at">bins=</span><span class="dv">200</span>, <span class="at">alpha=</span><span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb63-1385"><a href="#cb63-1385" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low=</span><span class="st">"#DDDDDD"</span>,<span class="at">high=</span><span class="st">"black"</span>,<span class="at">guide =</span> <span class="st">"none"</span>)<span class="sc">+</span></span>
<span id="cb63-1386"><a href="#cb63-1386" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> ests, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>est_shifted),<span class="at">color=</span>col[<span class="dv">2</span>]) <span class="sc">+</span> </span>
<span id="cb63-1387"><a href="#cb63-1387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(</span>
<span id="cb63-1388"><a href="#cb63-1388" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ests, </span>
<span id="cb63-1389"><a href="#cb63-1389" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>est_shifted, <span class="at">ymin=</span>est_shifted<span class="sc">-</span>se<span class="sc">*</span><span class="fl">1.96</span>, <span class="at">ymax=</span>est_shifted<span class="sc">+</span>se<span class="sc">*</span><span class="fl">1.96</span>), </span>
<span id="cb63-1390"><a href="#cb63-1390" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">fill=</span>col[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb63-1391"><a href="#cb63-1391" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb63-1392"><a href="#cb63-1392" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ests_, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>est_shifted), <span class="at">color =</span> col[<span class="dv">1</span>]) <span class="sc">+</span> </span>
<span id="cb63-1393"><a href="#cb63-1393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(</span>
<span id="cb63-1394"><a href="#cb63-1394" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ests_, </span>
<span id="cb63-1395"><a href="#cb63-1395" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">ymin=</span>est_shifted<span class="sc">-</span>se<span class="sc">*</span><span class="fl">1.96</span>, <span class="at">ymax=</span>est_shifted<span class="sc">+</span>se<span class="sc">*</span><span class="fl">1.96</span>), </span>
<span id="cb63-1396"><a href="#cb63-1396" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">fill=</span>col[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb63-1397"><a href="#cb63-1397" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb63-1398"><a href="#cb63-1398" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_modified <span class="sc">%&gt;%</span> <span class="fu">filter</span>(selected<span class="sc">==</span>T), </span>
<span id="cb63-1399"><a href="#cb63-1399" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y_obs),<span class="at">color=</span>col[<span class="dv">1</span>], <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb63-1400"><a href="#cb63-1400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb63-1401"><a href="#cb63-1401" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_modified <span class="sc">%&gt;%</span> <span class="fu">filter</span>(selected<span class="sc">==</span>T), </span>
<span id="cb63-1402"><a href="#cb63-1402" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x=</span>x0,<span class="at">y=</span>y_obs),<span class="at">color=</span>col[<span class="dv">2</span>], <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb63-1403"><a href="#cb63-1403" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb63-1404"><a href="#cb63-1404" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_modified <span class="sc">%&gt;%</span> <span class="fu">filter</span>(selected<span class="sc">==</span>T), </span>
<span id="cb63-1405"><a href="#cb63-1405" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x0, <span class="at">xend=</span>x,<span class="at">y=</span>y_obs,<span class="at">yend=</span>y_obs), </span>
<span id="cb63-1406"><a href="#cb63-1406" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.15</span>, <span class="at">color =</span> col[<span class="dv">3</span>],</span>
<span id="cb63-1407"><a href="#cb63-1407" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow=</span><span class="fu">arrow</span>(<span class="at">angle=</span><span class="dv">15</span>, <span class="at">length=</span><span class="fu">unit</span>(<span class="dv">3</span>, <span class="st">"mm"</span>))) <span class="sc">+</span></span>
<span id="cb63-1408"><a href="#cb63-1408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Overestimating surprisal"</span>, </span>
<span id="cb63-1409"><a href="#cb63-1409" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle=</span><span class="st">"schematic illustration"</span>, <span class="at">y=</span><span class="st">"RT"</span>,<span class="at">x=</span><span class="st">"surprisal"</span>) <span class="sc">+</span></span>
<span id="cb63-1410"><a href="#cb63-1410" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="cn">NA</span>,<span class="dv">620</span>) <span class="sc">+</span></span>
<span id="cb63-1411"><a href="#cb63-1411" aria-hidden="true" tabindex="-1"></a>  <span class="co"># xkcd::xkcdaxis(range(df_modified$x),c(300,620)) +</span></span>
<span id="cb63-1412"><a href="#cb63-1412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(), <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb63-1413"><a href="#cb63-1413" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(), <span class="at">axis.line =</span> <span class="fu">element_line</span>(),</span>
<span id="cb63-1414"><a href="#cb63-1414" aria-hidden="true" tabindex="-1"></a>        <span class="at">text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>))</span>
<span id="cb63-1415"><a href="#cb63-1415" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb63-1416"><a href="#cb63-1416" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(figsdir, <span class="st">"sketch.pdf"</span>),</span>
<span id="cb63-1417"><a href="#cb63-1417" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">5</span>, <span class="at">height =</span> <span class="fl">4.5</span>)</span>
<span id="cb63-1418"><a href="#cb63-1418" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-1419"><a href="#cb63-1419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1420"><a href="#cb63-1420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1421"><a href="#cb63-1421" aria-hidden="true" tabindex="-1"></a><span class="fu"># Sampling analysis</span></span>
<span id="cb63-1422"><a href="#cb63-1422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1423"><a href="#cb63-1423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1424"><a href="#cb63-1424" aria-hidden="true" tabindex="-1"></a><span class="in">```{r options}</span></span>
<span id="cb63-1425"><a href="#cb63-1425" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb63-1426"><a href="#cb63-1426" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Options</span></span>
<span id="cb63-1427"><a href="#cb63-1427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1428"><a href="#cb63-1428" aria-hidden="true" tabindex="-1"></a><span class="co"># Whether to sample weights or use weights equidistributed on the inverse CDF</span></span>
<span id="cb63-1429"><a href="#cb63-1429" aria-hidden="true" tabindex="-1"></a>get_weights <span class="ot">&lt;-</span> <span class="st">"sample"</span> <span class="co"># or "equidistributed_inv_CDF"</span></span>
<span id="cb63-1430"><a href="#cb63-1430" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-1431"><a href="#cb63-1431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1432"><a href="#cb63-1432" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plotting_functions}</span></span>
<span id="cb63-1433"><a href="#cb63-1433" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting functions</span></span>
<span id="cb63-1434"><a href="#cb63-1434" aria-hidden="true" tabindex="-1"></a>prepare_to_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb63-1435"><a href="#cb63-1435" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb63-1436"><a href="#cb63-1436" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"variance"</span>), <span class="sc">~</span><span class="fu">log</span>(<span class="fu">sqrt</span>(.))</span>
<span id="cb63-1437"><a href="#cb63-1437" aria-hidden="true" tabindex="-1"></a>                  <span class="co">#, .names = "logsqrt{col}" # uncomment to not modify in place</span></span>
<span id="cb63-1438"><a href="#cb63-1438" aria-hidden="true" tabindex="-1"></a>                  )) <span class="sc">%&gt;%</span></span>
<span id="cb63-1439"><a href="#cb63-1439" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb63-1440"><a href="#cb63-1440" aria-hidden="true" tabindex="-1"></a>      <span class="at">cols =</span> <span class="fu">matches</span>(<span class="st">"empirical|theoretical"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb63-1441"><a href="#cb63-1441" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">separate</span>(name, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"moment"</span>, <span class="st">"type"</span>), <span class="at">sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-1442"><a href="#cb63-1442" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), forcats<span class="sc">::</span>as_factor)) <span class="sc">%&gt;%</span></span>
<span id="cb63-1443"><a href="#cb63-1443" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">surprisal =</span> <span class="sc">-</span><span class="fu">log</span>(normalized_weight)) <span class="sc">%&gt;%</span></span>
<span id="cb63-1444"><a href="#cb63-1444" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(type))</span>
<span id="cb63-1445"><a href="#cb63-1445" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-1446"><a href="#cb63-1446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1447"><a href="#cb63-1447" aria-hidden="true" tabindex="-1"></a>make_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb63-1448"><a href="#cb63-1448" aria-hidden="true" tabindex="-1"></a>  df_prepared <span class="ot">&lt;-</span> <span class="fu">prepare_to_plot</span>(df)</span>
<span id="cb63-1449"><a href="#cb63-1449" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rename "empirical" -&gt; "simulated"</span></span>
<span id="cb63-1450"><a href="#cb63-1450" aria-hidden="true" tabindex="-1"></a>  df_prepared<span class="sc">$</span>type <span class="ot">&lt;-</span> df_prepared<span class="sc">$</span>type <span class="sc">%&gt;%</span></span>
<span id="cb63-1451"><a href="#cb63-1451" aria-hidden="true" tabindex="-1"></a>    <span class="fu">recode_factor</span>(<span class="at">empirical =</span> <span class="st">"simulated"</span>)</span>
<span id="cb63-1452"><a href="#cb63-1452" aria-hidden="true" tabindex="-1"></a>  df_prepared <span class="sc">%&gt;%</span></span>
<span id="cb63-1453"><a href="#cb63-1453" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb63-1454"><a href="#cb63-1454" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> surprisal, <span class="at">y =</span> value,</span>
<span id="cb63-1455"><a href="#cb63-1455" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> type, <span class="at">color =</span> type,</span>
<span id="cb63-1456"><a href="#cb63-1456" aria-hidden="true" tabindex="-1"></a>      <span class="at">shape =</span> type, <span class="at">size =</span> type, <span class="at">alpha =</span> type)) <span class="sc">+</span></span>
<span id="cb63-1457"><a href="#cb63-1457" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb63-1458"><a href="#cb63-1458" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(</span>
<span id="cb63-1459"><a href="#cb63-1459" aria-hidden="true" tabindex="-1"></a>      <span class="at">rows =</span> <span class="fu">vars</span>(moment), <span class="at">scale =</span> <span class="st">"free"</span>, <span class="at">switch =</span> <span class="st">"y"</span>,</span>
<span id="cb63-1460"><a href="#cb63-1460" aria-hidden="true" tabindex="-1"></a>      <span class="at">labeller =</span> <span class="fu">as_labeller</span>(</span>
<span id="cb63-1461"><a href="#cb63-1461" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(<span class="at">mean =</span> <span class="st">"mean #samples"</span>, <span class="at">variance =</span> <span class="st">"log(sd #samples)"</span>))) <span class="sc">+</span></span>
<span id="cb63-1462"><a href="#cb63-1462" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(</span>
<span id="cb63-1463"><a href="#cb63-1463" aria-hidden="true" tabindex="-1"></a>      <span class="at">values =</span> <span class="fu">c</span>(<span class="at">simulated =</span> <span class="st">"darkgray"</span>, <span class="at">theoretical =</span> <span class="st">"darkblue"</span>)) <span class="sc">+</span></span>
<span id="cb63-1464"><a href="#cb63-1464" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_shape_manual</span>(</span>
<span id="cb63-1465"><a href="#cb63-1465" aria-hidden="true" tabindex="-1"></a>      <span class="at">values =</span> <span class="fu">c</span>(<span class="at">simulated =</span> <span class="dv">4</span>, <span class="at">theoretical =</span> <span class="dv">16</span>)) <span class="sc">+</span></span>
<span id="cb63-1466"><a href="#cb63-1466" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_size_manual</span>(</span>
<span id="cb63-1467"><a href="#cb63-1467" aria-hidden="true" tabindex="-1"></a>      <span class="at">values =</span> <span class="fu">c</span>(<span class="at">simulated =</span> <span class="dv">3</span>, <span class="at">theoretical =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb63-1468"><a href="#cb63-1468" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">simulated =</span> .<span class="dv">5</span>, <span class="at">theoretical =</span> .<span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb63-1469"><a href="#cb63-1469" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="co">#legend.position = c(.2,.8),</span></span>
<span id="cb63-1470"><a href="#cb63-1470" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.background =</span> <span class="fu">element_rect</span>(</span>
<span id="cb63-1471"><a href="#cb63-1471" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">fill =</span> <span class="fu">alpha</span>(<span class="st">"white"</span>, <span class="fl">0.5</span>), <span class="at">color =</span> <span class="fu">alpha</span>(<span class="st">"white"</span>, <span class="fl">0.5</span>)),</span>
<span id="cb63-1472"><a href="#cb63-1472" aria-hidden="true" tabindex="-1"></a>          <span class="co"># legend.direction="horizontal",</span></span>
<span id="cb63-1473"><a href="#cb63-1473" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.placement =</span> <span class="st">"outside"</span>,</span>
<span id="cb63-1474"><a href="#cb63-1474" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb63-1475"><a href="#cb63-1475" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb63-1476"><a href="#cb63-1476" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-1477"><a href="#cb63-1477" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-1478"><a href="#cb63-1478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1479"><a href="#cb63-1479" aria-hidden="true" tabindex="-1"></a><span class="in">```{r generate_plots}</span></span>
<span id="cb63-1480"><a href="#cb63-1480" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb63-1481"><a href="#cb63-1481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1482"><a href="#cb63-1482" aria-hidden="true" tabindex="-1"></a>suffix <span class="ot">&lt;-</span> <span class="cf">if</span> (get_weights <span class="sc">==</span> <span class="st">"sample"</span>) <span class="st">""</span> <span class="cf">else</span> <span class="st">"_equidistant"</span></span>
<span id="cb63-1483"><a href="#cb63-1483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1484"><a href="#cb63-1484" aria-hidden="true" tabindex="-1"></a>swor <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(</span>
<span id="cb63-1485"><a href="#cb63-1485" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"sampling_simulated/plot_swor_runtime"</span>, suffix, <span class="st">"_df.csv"</span>),</span>
<span id="cb63-1486"><a href="#cb63-1486" aria-hidden="true" tabindex="-1"></a>  <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb63-1487"><a href="#cb63-1487" aria-hidden="true" tabindex="-1"></a>swr <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(</span>
<span id="cb63-1488"><a href="#cb63-1488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(datadir, <span class="st">"sampling_simulated/plot_swr_runtime"</span>, suffix, <span class="st">"_df.csv"</span>),</span>
<span id="cb63-1489"><a href="#cb63-1489" aria-hidden="true" tabindex="-1"></a>  <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb63-1490"><a href="#cb63-1490" aria-hidden="true" tabindex="-1"></a>p_swor <span class="ot">&lt;-</span> <span class="fu">make_plot</span>(swor)</span>
<span id="cb63-1491"><a href="#cb63-1491" aria-hidden="true" tabindex="-1"></a>p_swr <span class="ot">&lt;-</span> <span class="fu">make_plot</span>(swr)</span>
<span id="cb63-1492"><a href="#cb63-1492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1493"><a href="#cb63-1493" aria-hidden="true" tabindex="-1"></a>p_swor <span class="sc">+</span></span>
<span id="cb63-1494"><a href="#cb63-1494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Runtime of guessing without replacement"</span>,</span>
<span id="cb63-1495"><a href="#cb63-1495" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Pareto-distributed weights"</span>)</span>
<span id="cb63-1496"><a href="#cb63-1496" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb63-1497"><a href="#cb63-1497" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="fu">paste0</span>(figsdir, <span class="st">"pareto"</span>, suffix, <span class="st">"_swor.pdf"</span>),</span>
<span id="cb63-1498"><a href="#cb63-1498" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">4</span>, <span class="at">width =</span> <span class="dv">5</span>)</span>
<span id="cb63-1499"><a href="#cb63-1499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1500"><a href="#cb63-1500" aria-hidden="true" tabindex="-1"></a>p_swr <span class="sc">+</span></span>
<span id="cb63-1501"><a href="#cb63-1501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Runtime of guessing with replacement"</span>,</span>
<span id="cb63-1502"><a href="#cb63-1502" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Pareto-distributed weights"</span>)</span>
<span id="cb63-1503"><a href="#cb63-1503" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb63-1504"><a href="#cb63-1504" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="fu">paste0</span>(figsdir, <span class="st">"pareto"</span>, suffix, <span class="st">"_swr.pdf"</span>),</span>
<span id="cb63-1505"><a href="#cb63-1505" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">4</span>, <span class="at">width =</span> <span class="dv">5</span>)</span>
<span id="cb63-1506"><a href="#cb63-1506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1507"><a href="#cb63-1507" aria-hidden="true" tabindex="-1"></a><span class="fu">wrap_plots</span>(</span>
<span id="cb63-1508"><a href="#cb63-1508" aria-hidden="true" tabindex="-1"></a>    p_swr <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Guessing with replacement"</span>),</span>
<span id="cb63-1509"><a href="#cb63-1509" aria-hidden="true" tabindex="-1"></a>    p_swor <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Guessing without replacement"</span>),</span>
<span id="cb63-1510"><a href="#cb63-1510" aria-hidden="true" tabindex="-1"></a>    <span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">&amp;</span> <span class="co">#theme(legend.position = "right") &amp;</span></span>
<span id="cb63-1511"><a href="#cb63-1511" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb63-1512"><a href="#cb63-1512" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Runtime mean and variance of guessing algorithms"</span>,</span>
<span id="cb63-1513"><a href="#cb63-1513" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Pareto-distributed weights"</span>)</span>
<span id="cb63-1514"><a href="#cb63-1514" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb63-1515"><a href="#cb63-1515" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="fu">paste0</span>(figsdir, <span class="st">"pareto"</span>, suffix, <span class="st">"_swr_swor"</span>, <span class="st">".pdf"</span>),</span>
<span id="cb63-1516"><a href="#cb63-1516" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">4</span>, <span class="at">width =</span> <span class="dv">7</span>)</span>
<span id="cb63-1517"><a href="#cb63-1517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1518"><a href="#cb63-1518" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>